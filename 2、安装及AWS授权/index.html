<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>2、安装及AWS授权 - Terraform at AWS Guide</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "2\u3001\u5b89\u88c5\u53caAWS\u6388\u6743";
        var mkdocs_page_input_path = "2\u3001\u5b89\u88c5\u53caAWS\u6388\u6743.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Terraform at AWS Guide
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Terraform at AWS Guide</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>2、安装及AWS授权</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="terraform-cli">一、Terraform CLI 工具的安装<a class="headerlink" href="#terraform-cli" title="Permanent link">&para;</a></h1>
<h2 id="_1">知识点<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<ul>
<li>Terraform CLI 工具的安装 - @macOS @Linux</li>
</ul>
<h2 id="_2">官网<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>https://www.terraform.io/downloads</p>
<h2 id="_3">操作步骤<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<h3 id="_4">从官网下载安装<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<p>https://releases.hashicorp.com/terraform/</p>
<p>这里选择：<code>terraform_1.3.8_darwin_amd64.zip</code></p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>unzip<span class="w"> </span>terraform_x.xx.x_darwin_amd64.zip
$<span class="w"> </span>mv<span class="w"> </span>terraform<span class="w"> </span>/usr/local/bin
</code></pre></div>

<h3 id="macos-terraform-cli">在 macOS 上安装 Terraform CLI 命令行工具<a class="headerlink" href="#macos-terraform-cli" title="Permanent link">&para;</a></h3>
<p>https://learn.hashicorp.com/tutorials/terraform/install-cli?in=terraform/aws-get-started</p>
<div class="codehilite"><pre><span></span><code><span class="c1">#######################################</span>
<span class="c1"># 使用 Homebrew 安装 Terraform CLI</span>
$<span class="w"> </span>brew<span class="w"> </span>tap<span class="w"> </span>hashicorp/tap<span class="w">                                </span><span class="c1"># 注册hashicorp信息库</span>
$<span class="w"> </span>brew<span class="w"> </span>install<span class="w"> </span>hashicorp/tap/terraform<span class="w">  </span><span class="c1"># 安装terraform</span>
<span class="c1"># 确认安装</span>
$<span class="w"> </span>terraform<span class="w"> </span>-help
$<span class="w"> </span>terraform<span class="w"> </span>version
<span class="c1"># 各种子命令确认</span>
$<span class="w"> </span>terraform<span class="w"> </span>-help<span class="w"> </span>init<span class="w">                                  </span><span class="c1"># 初始化</span>
$<span class="w"> </span>terraform<span class="w"> </span>-help<span class="w"> </span>validate<span class="w">                          </span><span class="c1"># 验证Terraform配置文件的语法是否正确</span>
$<span class="w"> </span>terraform<span class="w"> </span>-help<span class="w"> </span>plan<span class="w">                                  </span><span class="c1"># </span>
$<span class="w"> </span>terraform<span class="w"> </span>-help<span class="w"> </span>apply
$<span class="w"> </span>terraform<span class="w"> </span>-help<span class="w"> </span>destroy

<span class="c1">#######################################</span>
<span class="c1"># Homebrew 本体更新</span>
$<span class="w"> </span>brew<span class="w"> </span>update
<span class="c1"># 更新 Terraform CLI</span>
$<span class="w"> </span>brew<span class="w"> </span>upgrade<span class="w"> </span>hashicorp/tap/terraform

<span class="c1">#######################################</span>
<span class="c1"># Tab 自动完成(可选安装, 有安全隐患, 可跳过)</span>
<span class="c1">## Bash 的场合</span>
<span class="c1"># $ touch ~/.bashrc</span>
<span class="c1">## Zsh  的场合</span>
$<span class="w"> </span>touch<span class="w"> </span>~/.zshrc
<span class="c1"># 安装 Terraform 自动完成包</span>
$<span class="w"> </span>terraform<span class="w"> </span>-install-autocomplete
</code></pre></div>

<p><a href="https://brew.sh/">macos系统的Homebrew包管理工具官网</a></p>
<h3 id="linux-terraform-cli">在 Linux 上安装 Terraform CLI 命令行工具<a class="headerlink" href="#linux-terraform-cli" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># 安装 yum 管理工具 - yum-config-manager</span>
$<span class="w"> </span>sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>yum-utils
<span class="c1"># 注册 HashiCorp 信息库</span>
$<span class="w"> </span>sudo<span class="w"> </span>yum-config-manager<span class="w"> </span>--add-repo<span class="w"> </span>https://rpm.releases.hashicorp.com/AmazonLinux/hashicorp.repo
<span class="c1"># 安装 terraform</span>
$<span class="w"> </span>sudo<span class="w"> </span>yum<span class="w"> </span>-y<span class="w"> </span>install<span class="w"> </span>terraform
<span class="c1"># 确认安装</span>
$<span class="w"> </span>terraform<span class="w"> </span>-help
$<span class="w"> </span>terraform<span class="w"> </span>version
</code></pre></div>

<h1 id="aws-cli">二、AWS CLI 命令行工具安装及设置<a class="headerlink" href="#aws-cli" title="Permanent link">&para;</a></h1>
<h2 id="_5">实战演习/说明讲解<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h2>
<ul>
<li>安装 AWS CLI 命令行工具</li>
<li>设置授权（方式一） - 本地授权</li>
<li>设置授权（方式二） - EC2 角色授权</li>
</ul>
<h2 id="_6">操作步骤<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h2>
<h3 id="aws-cli_1">安装 AWS CLI 命令行工具<a class="headerlink" href="#aws-cli_1" title="Permanent link">&para;</a></h3>
<p>https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/install-cliv2.html</p>
<ul>
<li>Docker</li>
<li>Linux</li>
<li>macOS</li>
<li>Windows</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="c1"># 版本确认</span>
$<span class="w"> </span>aws<span class="w"> </span>--version
<span class="c1"># 确认本地授权文件</span>
$<span class="w"> </span>cat<span class="w"> </span>~/.aws/credentials
</code></pre></div>

<h3 id="-">设置授权（方式一） - 本地授权<a class="headerlink" href="#-" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>登陆AWS console，进入“IAM”页面，点击 “用户” ，添加“用户”并设置勾选访问类型“编程访问”</p>
</li>
<li>
<p>设置相应权限</p>
</li>
<li>
<p>创建用户，并保存访问密钥对（注意只显示一次）</p>
</li>
<li>
<p>授权CLI身份</p>
</li>
</ul>
<p>```bash
  # 授权CLI身份(指定profile方式 - AWS Best Practices)
  $ aws configure --profile learnaws</p>
<blockquote>
<p>AWS Access Key ID [None]: FFUff89898u89vxv
  AWS Secret Access Key [None]: Ahy789yvhjxlFDoajsdflajia90sdfjsaa
Default region name [None]: ap-northeast-1
  Default output format [None]: json
  # 授权身份存储位置(<strong><em>*</em>*内容涉及敏感信息</strong>****)
  $ ls ~/.aws
  # 列出所有配置数据
  $ aws configure list --profile learnaws
  # 列出可用配置文件名称
  $ aws configure list-profiles
  # 列出当前区的VPC
  $ aws ec2 describe-vpcs --profile learnaws
  # 查询过滤显示
  $ aws ec2 describe-vpcs --profile learnaws --query 'Vpcs[].VpcId'
  # 列出S3存储桶
  $ aws s3 ls --profile learnaws
  ```</p>
</blockquote>
<p><code>bash
  # 此命令来验证您的 AWS 访问密钥是否正确，以及您是否已获得必要的 AWS 资源访问权限。如果该命令返回您的身份信息(账户ID、用户ID、ARN)，表示您已通过身份验证，并且可以在 AWS 上执行其他操作。如果出现错误，说明您的访问密钥无效或您没有必要的 AWS 资源访问权限。
  $ aws sts get-caller-identity</code></p>
<h3 id="-ec2">设置授权（方式二） - 给EC2进行角色授权<a class="headerlink" href="#-ec2" title="Permanent link">&para;</a></h3>
<p>使用下面的AWS CloudFormation 模版<em>awsNodeJSEC2.yml</em>，已经设置好 EC2 权限</p>
<div class="codehilite"><pre><span></span><code><span class="nt">Parameters</span><span class="p">:</span>
<span class="w">  </span><span class="nt">MyKeyName</span><span class="p">:</span>
<span class="w">    </span><span class="nt">Description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name of EC2 KeyPair</span>
<span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::KeyPair::KeyName</span>
<span class="w">    </span><span class="nt">Default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">learn-aws-ssh-key</span>
<span class="w">    </span><span class="nt">ConstraintDescription</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">must input</span>

<span class="nt">Resources</span><span class="p">:</span>
<span class="w">  </span><span class="nt">awsNodeJSEC2</span><span class="p">:</span>
<span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::Instance</span>
<span class="w">    </span><span class="nt">Properties</span><span class="p">:</span>
<span class="w">      </span><span class="nt">KeyName</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MyKeyName</span>
<span class="w">      </span><span class="nt">AvailabilityZone</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">{</span><span class="w"> </span><span class="s">&quot;Fn::Select&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;0&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="w"> </span><span class="s">&quot;Fn::GetAZs&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="w"> </span><span class="s">&quot;Ref&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;AWS::Region&quot;</span><span class="w"> </span><span class="p p-Indicator">}</span><span class="w"> </span><span class="p p-Indicator">}]</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">      </span><span class="nt">ImageId</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ami-0218d08a1f9dac831</span>
<span class="w">      </span><span class="nt">InstanceType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">t3.micro</span>
<span class="w">      </span><span class="nt">SecurityGroups</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">awsNodeJSSSHWEBSG</span>
<span class="w">      </span><span class="nt">IamInstanceProfile</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">awsNodeJSMyInstanceProfile</span>
<span class="w">      </span><span class="nt">BlockDeviceMappings</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">DeviceName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/dev/xvda</span>
<span class="w">          </span><span class="nt">Ebs</span><span class="p">:</span>
<span class="w">            </span><span class="nt">VolumeType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gp2</span>
<span class="w">            </span><span class="nt">VolumeSize</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8</span>
<span class="w">            </span><span class="nt">DeleteOnTermination</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">            </span><span class="nt">Encrypted</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">      </span><span class="nt">UserData</span><span class="p">:</span>
<span class="w">        </span><span class="nt">Fn::Base64</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">#!/bin/bash</span>
<span class="w">          </span><span class="no">yum update -y</span>
<span class="w">          </span><span class="no">timedatectl set-timezone &quot;Asia/Tokyo&quot;</span>
<span class="w">          </span><span class="no">localectl set-locale LANG=ja_JP.UTF-8          </span>
<span class="w">          </span><span class="no">touch /home/ec2-user/.hushlogin</span>
<span class="w">          </span><span class="no">chown ec2-user:ec2-user /home/ec2-user/.hushlogin</span>

<span class="w">          </span><span class="no">curl &quot;https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip&quot; -o &quot;/tmp/awscliv2.zip&quot;</span>
<span class="w">          </span><span class="no">unzip /tmp/awscliv2.zip  -d /tmp/awscliv2/</span>
<span class="w">          </span><span class="no">/tmp/awscliv2/aws/install</span>

<span class="w">          </span><span class="no">curl -sL https://rpm.nodesource.com/setup_14.x | bash -</span>
<span class="w">          </span><span class="no">yum install -y gcc-c++ make</span>
<span class="w">          </span><span class="no">yum install -y nodejs</span>

<span class="w">  </span><span class="nt">awsNodeJSSSHWEBSG</span><span class="p">:</span>
<span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::SecurityGroup</span>
<span class="w">    </span><span class="nt">Properties</span><span class="p">:</span>
<span class="w">      </span><span class="nt">GroupDescription</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SSH and Web PORT</span>
<span class="w">      </span><span class="nt">SecurityGroupIngress</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">IpProtocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tcp</span>
<span class="w">          </span><span class="nt">FromPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">22</span>
<span class="w">          </span><span class="nt">ToPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">22</span>
<span class="w">          </span><span class="nt">CidrIp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.0/0</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">IpProtocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tcp</span>
<span class="w">          </span><span class="nt">FromPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">          </span><span class="nt">ToPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">          </span><span class="nt">CidrIp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.0/0</span>

<span class="w">  </span><span class="nt">awsNodeJSAccessRole</span><span class="p">:</span>
<span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;AWS::IAM::Role&quot;</span>
<span class="w">    </span><span class="nt">Properties</span><span class="p">:</span>
<span class="w">      </span><span class="nt">AssumeRolePolicyDocument</span><span class="p">:</span>
<span class="w">        </span><span class="nt">Version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2012-10-17&quot;</span>
<span class="w">        </span><span class="nt">Statement</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Effect</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Allow&quot;</span>
<span class="w">            </span><span class="nt">Principal</span><span class="p">:</span>
<span class="w">              </span><span class="nt">Service</span><span class="p">:</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;ec2.amazonaws.com&quot;</span>
<span class="w">            </span><span class="nt">Action</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;sts:AssumeRole&quot;</span>
<span class="w">      </span><span class="nt">Path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/&quot;</span>
<span class="w">      </span><span class="nt">ManagedPolicyArns</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">arn:aws:iam::aws:policy/AdministratorAccess</span>

<span class="w">  </span><span class="nt">awsNodeJSMyInstanceProfile</span><span class="p">:</span>
<span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;AWS::IAM::InstanceProfile&quot;</span>
<span class="w">    </span><span class="nt">Properties</span><span class="p">:</span>
<span class="w">      </span><span class="nt">Path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/&quot;</span>
<span class="w">      </span><span class="nt">Roles</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">awsNodeJSAccessRole</span>

<span class="w">  </span><span class="nt">awsNodeJSEIP</span><span class="p">:</span>
<span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::EIP</span>
<span class="w">    </span><span class="nt">Properties</span><span class="p">:</span>
<span class="w">      </span><span class="nt">InstanceId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">awsNodeJSEC2</span>
</code></pre></div>

<h1 id="vscode">三、VSCode 插件安装<a class="headerlink" href="#vscode" title="Permanent link">&para;</a></h1>
<blockquote>
<p>在 VSCode 中安装 Terraform 插件</p>
</blockquote>
<h2 id="_7">官网<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h2>
<p>https://marketplace.visualstudio.com/items?itemName=HashiCorp.terraform</p>
<h2 id="_8">操作步骤<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h2>
<h3 id="vscode-terraform">在 VSCode 中安装 Terraform 插件<a class="headerlink" href="#vscode-terraform" title="Permanent link">&para;</a></h3>
<p>在 VSCode 中搜索扩展 HashiCorp Terraform， 然后安装。</p>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>

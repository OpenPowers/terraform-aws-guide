{"config":{"lang":["ja"],"separator":"[\\s\\-\uff0c\u3002]+","pipeline":["stemmer"]},"docs":[{"location":"","title":"Terraform at AWS Guide","text":"<ul> <li>1\u3001\u7b80\u4ecb</li> <li>2\u3001\u5b89\u88c5\u53caAWS\u6388\u6743</li> <li>3\u3001Terraform \u5de5\u4f5c\u6d41</li> <li>4\u3001\u5feb\u901f\u5efa\u7acb\u7b2c\u4e00\u4e2a EC2 \u5b9e\u4f8b - \u672c\u5730\u6388\u6743\u65b9\u5f0f</li> <li>5\u3001\u5feb\u901f\u5efa\u7acb\u7b2c\u4e00\u4e2a EC2 \u5b9e\u4f8b - EC2\u6388\u6743\u65b9\u5f0f.md</li> <li>6\u3001\u5206\u6587\u4ef6\u7ba1\u7406 Terraform \u8d44\u6e90</li> <li>7\u3001tf\u8bbe\u7f6eEC2\u8d44\u6e90\u7684\u7528\u6237\u6570\u636e</li> <li>8\u3001\u72b6\u6001\u6587\u4ef6 - \"terraform.tfstate\"</li> <li>9\u3001\u5b9a\u4e49\u5f15\u7528\u53d8\u91cf</li> <li>10\u3001\u5b9a\u4e49AWS\u5b89\u5168\u7ec4</li> <li>11\u3001EC2 \u6570\u636e\u6e90 - \u4f7f\u7528\u6700\u65b0\u7684 AMI \u6570\u636e\u6e90</li> <li>12\u3001Output Values - \u5b9a\u4e49\u8f93\u51fa\u5185\u5bb9</li> <li>13\u3001\u5b9a\u4e49 EC2 \u7684Size\u5217\u8868</li> <li>14\u3001\u5b9a\u4e49 EC2 \u7684Size\u6620\u5c04</li> <li>15\u3001\u540c\u65f6\u542f\u52a8\u591a\u53f0 EC2 \u5b9e\u4f8b</li> <li>16\u3001\u67e5\u8be2\u53ef\u7528\u533a\u6570\u636e\u6e90, \u5206\u522b\u542f\u52a8 EC2</li> </ul>"},{"location":"10%E3%80%81%E5%AE%9A%E4%B9%89AWS%E5%AE%89%E5%85%A8%E7%BB%84/","title":"\u4e3aEC2\u5b9a\u4e49AWS\u5b89\u5168\u7ec4","text":""},{"location":"10%E3%80%81%E5%AE%9A%E4%B9%89AWS%E5%AE%89%E5%85%A8%E7%BB%84/#_1","title":"\u77e5\u8bc6\u70b9","text":"<p>\u4e4b\u524d\u6211\u4eec\u90e8\u7f72\u7684EC2\u90fd\u662f\u7528\u7684\u9ed8\u8ba4\u5b89\u5168\u7ec4\uff0c\u5728\u5b9e\u9645\u73af\u5883\u4e2d\uff0c\u8981\u6839\u636e\u6bcf\u53f0EC2\u7684\u804c\u80fd\u4f7f\u7528\u4e0d\u540c\u7684\u5b89\u5168\u7ec4</p> <ul> <li>\u4f7f\u7528 Terraform \u5b9a\u4e49\u5b89\u5168\u7ec4</li> </ul>"},{"location":"10%E3%80%81%E5%AE%9A%E4%B9%89AWS%E5%AE%89%E5%85%A8%E7%BB%84/#_2","title":"\u5b98\u7f51","text":"<p>https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group</p>"},{"location":"10%E3%80%81%E5%AE%9A%E4%B9%89AWS%E5%AE%89%E5%85%A8%E7%BB%84/#_3","title":"\u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3","text":"<ul> <li>\u7f16\u5199\u5b89\u5168\u7ec4\u5b9a\u4e49\u6587\u4ef6</li> <li>\u7f16\u5199 TF \u8d44\u6e90\u63cf\u8ff0\u6587\u4ef6\uff0c \u5f15\u7528\u5b89\u5168\u7ec4\u5b9a\u4e49</li> <li>\u90e8\u7f72\u786e\u8ba4</li> </ul>"},{"location":"10%E3%80%81%E5%AE%9A%E4%B9%89AWS%E5%AE%89%E5%85%A8%E7%BB%84/#_4","title":"\u64cd\u4f5c\u6b65\u9aa4","text":""},{"location":"10%E3%80%81%E5%AE%9A%E4%B9%89AWS%E5%AE%89%E5%85%A8%E7%BB%84/#_5","title":"\u76ee\u5f55\u7ed3\u6784","text":"<pre><code>.\n\u251c\u2500\u2500 ec2-variables.tf\n\u251c\u2500\u2500 ec2-sg.tf\n\u251c\u2500\u2500 ec2.tf\n\u2514\u2500\u2500 main.tf\n</code></pre>"},{"location":"10%E3%80%81%E5%AE%9A%E4%B9%89AWS%E5%AE%89%E5%85%A8%E7%BB%84/#_6","title":"\u7f16\u5199\u53d8\u91cf\u5b9a\u4e49\u6587\u4ef6","text":"<p>ec2-variables.tf</p> <pre><code># AWS Region\nvariable \"aws_region\" {\ndescription = \"AWS Region\"\ntype = string\n  default = \"ap-northeast-1\"\n}\n\n# AWS EC2 Instance Type\nvariable \"instance_type\" {\ndescription = \"EC2 Instance Type\"\ntype = string\n  default = \"t3.micro\"  }\n\n# AWS EC2 Instance Key Pair\nvariable \"ami_id\" {\ndescription = \"AMI Image ID\"\ntype = string\n  default = \"ami-0218d08a1f9dac831\"\n}\n</code></pre>"},{"location":"10%E3%80%81%E5%AE%9A%E4%B9%89AWS%E5%AE%89%E5%85%A8%E7%BB%84/#_7","title":"\u7f16\u5199\u5b89\u5168\u7ec4\u5b9a\u4e49\u6587\u4ef6","text":"<p>ec2-sg.tf</p> <pre><code># Create Security Group\nresource \"aws_security_group\" \"learnaws-sg-web-ssh\" {\n# \u5b89\u5168\u7ec4\u7684\u540d\u79f0\nname        = \"learnaws-sg-web-ssh\"\ndescription = \"Web and SSH\"\n# \u5b89\u5168\u7ec4\u7684\u5165\u53e3\u63cf\u8ff0\ningress {\ndescription = \"Allow Port 80\"\nfrom_port   = 80\nto_port     = 80\nprotocol    = \"tcp\"\n# \u5141\u8bb8\u8303\u56f4\uff0c\u8fd9\u91cc\u662f\u6240\u6709ip\u90fd\u53ef\u8bbf\u95ee\ncidr_blocks = [\"0.0.0.0/0\"]\n}\ningress {\ndescription = \"Allow Port 443\"\nfrom_port   = 443\nto_port     = 443\nprotocol    = \"tcp\"\ncidr_blocks = [\"0.0.0.0/0\"]\n}\ningress {\ndescription = \"Allow Port 22\"\nfrom_port   = 22\nto_port     = 22\nprotocol    = \"tcp\"\ncidr_blocks = [\"0.0.0.0/0\"]\n# cidr_blocks = [\"12.15.55.32/32\"]\n}\n# \u5b89\u5168\u7ec4\u7684\u51fa\u53e3\u63cf\u8ff0\negress {\ndescription = \"Allow all ip and ports outbound\"\nfrom_port   = 0\nto_port     = 0\nprotocol    = \"-1\"\ncidr_blocks = [\"0.0.0.0/0\"]\n}\ntags = {\nName = \"learnaws-sg-web-ssh\"\n}\n}\n</code></pre>"},{"location":"10%E3%80%81%E5%AE%9A%E4%B9%89AWS%E5%AE%89%E5%85%A8%E7%BB%84/#tf","title":"\u7f16\u5199 TF \u8d44\u6e90\u63cf\u8ff0\u6587\u4ef6\uff0c \u5f15\u7528\u5b89\u5168\u7ec4\u5b9a\u4e49","text":"<p>ec2.tf</p> <pre><code>###########################################################\n# EC2 \u8d44\u6e90\u8bbe\u7f6e\nresource \"aws_instance\" \"myweb_server2\" {\nami           = var.ami_id\n  instance_type = var.instance_type\n  # \u4e3aEC2\u6307\u5b9a\u5b89\u5168\u7ec4\u7684ids\nvpc_security_group_ids = [aws_security_group.learnaws-sg-web-ssh.id]\n\ntags = {\nName = \"learnaws-ec2-from-terraform-cli\"\n}\n}\n</code></pre>"},{"location":"10%E3%80%81%E5%AE%9A%E4%B9%89AWS%E5%AE%89%E5%85%A8%E7%BB%84/#tf_1","title":"\u7f16\u5199 TF \u9879\u76ee\u63cf\u8ff0\u6587\u4ef6","text":"<p>main.tf</p> <pre><code>###########################################################\n# Terraform \u57fa\u672c\u8bbe\u7f6e\nterraform {\nrequired_providers {\naws = {\nsource  = \"hashicorp/aws\"\nversion = \"~&gt; 3.71\"\n}\n}\nrequired_version = \"&gt;= 1.1.3\"\n}\n\n###########################################################\n# \u63d0\u4f9b\u5546\u8bbe\u7f6e(\u4e91\u5e73\u53f0)\nprovider \"aws\" {\nprofile = \"learnaws\"\nregion  = var.aws_region\n}\n</code></pre>"},{"location":"10%E3%80%81%E5%AE%9A%E4%B9%89AWS%E5%AE%89%E5%85%A8%E7%BB%84/#_8","title":"\u90e8\u7f72\u786e\u8ba4","text":"<pre><code># \u76ee\u5f55\u521d\u59cb\u5316\n$ terraform init\n# \u68c0\u9a8c tf \u6587\u4ef6\n$ terraform validate\n# \u5b9e\u65bd\u8ba1\u5212, \u51c6\u5907\u8d44\u6e90\n$ terraform plan\n# \u5e94\u7528\u90e8\u7f72\n$ terraform apply\n$ terraform apply -auto-approve\n# \u6467\u6bc1\u7cfb\u7edf\n$ terraform destroy\n$ terraform destroy -auto-approve\n</code></pre>"},{"location":"11%E3%80%81EC2%20%E6%95%B0%E6%8D%AE%E6%BA%90%20-%20%E4%BD%BF%E7%94%A8%E6%9C%80%E6%96%B0%E7%9A%84%20AMI%20%E6%95%B0%E6%8D%AE%E6%BA%90/","title":"EC2 \u6570\u636e\u6e90 - \u4f7f\u7528\u6700\u65b0\u7684 AMI \u6570\u636e\u6e90","text":""},{"location":"11%E3%80%81EC2%20%E6%95%B0%E6%8D%AE%E6%BA%90%20-%20%E4%BD%BF%E7%94%A8%E6%9C%80%E6%96%B0%E7%9A%84%20AMI%20%E6%95%B0%E6%8D%AE%E6%BA%90/#_1","title":"\u77e5\u8bc6\u70b9","text":"<ul> <li> <p>\u4e4b\u524d\u6211\u4eec\u901a\u8fc7TF\u542f\u52a8\u7684EC2\u90fd\u662f\u5199\u6b7b\u7684AMI\uff0c\u800camazon\u4e3a\u6211\u4eec\u7ef4\u62a4\u4e86\u4e00\u5957AMI\uff0c\u5e76\u4e14\u968f\u65f6\u53ef\u80fd\u4f1a\u53d1\u751f\u66f4\u65b0\uff0c\u4e00\u65e6amazon\u628aAMI ID\u8fdb\u884c\u66f4\u65b0\uff0c\u6b64\u65f6\u5982\u4f55\u53cd\u5e94\u5230\u672c\u5730\u7684TF\u7ef4\u62a4\u6587\u4ef6\u5f53\u4e2d\u5462\uff1f\u4e0d\u53ef\u80fd\u6bcf\u6b21\u90fd\u8981\u624b\u52a8\u8fdb\u884c\u4fee\u6539\u3002   \u90a3\u4e48\u6709\u6ca1\u6709\u4e00\u79cd\u65b9\u5f0f\uff0c\u53ea\u8981amazon\u7684\u4e91\u7aefAMI ID\u53d1\u751f\u66f4\u65b0\uff0c\u54b1\u4eec\u518d\u901a\u8fc7TF\u90e8\u7f72\u65f6\u81ea\u52a8\u5f15\u7528\u6700\u65b0\u7684AMI\uff1f</p> </li> <li> <p>\u5229\u7528 EC2 \u6570\u636e\u6e90\uff0c \u4fdd\u6301\u4f7f\u7528\u6700\u65b0\u7684 AMI \u955c\u50cf</p> </li> </ul>"},{"location":"11%E3%80%81EC2%20%E6%95%B0%E6%8D%AE%E6%BA%90%20-%20%E4%BD%BF%E7%94%A8%E6%9C%80%E6%96%B0%E7%9A%84%20AMI%20%E6%95%B0%E6%8D%AE%E6%BA%90/#_2","title":"\u5b98\u7f51","text":"<p>https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/ami</p>"},{"location":"11%E3%80%81EC2%20%E6%95%B0%E6%8D%AE%E6%BA%90%20-%20%E4%BD%BF%E7%94%A8%E6%9C%80%E6%96%B0%E7%9A%84%20AMI%20%E6%95%B0%E6%8D%AE%E6%BA%90/#_3","title":"\u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3","text":"<ul> <li>\u7f16\u5199 EC2 AMI \u6570\u636e\u6e90\u6587\u4ef6\uff0c \u59cb\u7ec8\u4fdd\u6301\u4f7f\u7528\u6700\u65b0\u7684 AMI</li> <li>\u7f16\u5199 TF \u8d44\u6e90\u63cf\u8ff0\u6587\u4ef6\uff0c \u5f15\u7528\u6700\u65b0\u7684 AMI \u6570\u636e\u6e90</li> <li>\u90e8\u7f72\u786e\u8ba4</li> </ul>"},{"location":"11%E3%80%81EC2%20%E6%95%B0%E6%8D%AE%E6%BA%90%20-%20%E4%BD%BF%E7%94%A8%E6%9C%80%E6%96%B0%E7%9A%84%20AMI%20%E6%95%B0%E6%8D%AE%E6%BA%90/#_4","title":"\u64cd\u4f5c\u6b65\u9aa4","text":""},{"location":"11%E3%80%81EC2%20%E6%95%B0%E6%8D%AE%E6%BA%90%20-%20%E4%BD%BF%E7%94%A8%E6%9C%80%E6%96%B0%E7%9A%84%20AMI%20%E6%95%B0%E6%8D%AE%E6%BA%90/#_5","title":"\u76ee\u5f55\u7ed3\u6784","text":"<pre><code>.\n\u251c\u2500\u2500 ec2-variables.tf\n\u251c\u2500\u2500 ec2-aws_ami.tf\n\u251c\u2500\u2500 ec2-sg.tf\n\u251c\u2500\u2500 ec2.tf\n\u2514\u2500\u2500 main.tf\n</code></pre>"},{"location":"11%E3%80%81EC2%20%E6%95%B0%E6%8D%AE%E6%BA%90%20-%20%E4%BD%BF%E7%94%A8%E6%9C%80%E6%96%B0%E7%9A%84%20AMI%20%E6%95%B0%E6%8D%AE%E6%BA%90/#_6","title":"\u7f16\u5199\u53d8\u91cf\u5b9a\u4e49\u6587\u4ef6","text":"<p>ec2-variables.tf</p> <pre><code># AWS Region\nvariable \"aws_region\" {\ndescription = \"AWS Region\"\ntype = string\n  default = \"ap-northeast-1\"\n}\n\n# AWS EC2 Instance Type\nvariable \"instance_type\" {\ndescription = \"EC2 Instance Type\"\ntype = string\n  default = \"t3.micro\"  }\n</code></pre>"},{"location":"11%E3%80%81EC2%20%E6%95%B0%E6%8D%AE%E6%BA%90%20-%20%E4%BD%BF%E7%94%A8%E6%9C%80%E6%96%B0%E7%9A%84%20AMI%20%E6%95%B0%E6%8D%AE%E6%BA%90/#ec2-ami-ami","title":"\u7f16\u5199 EC2 AMI \u6570\u636e\u6e90\u6587\u4ef6\uff0c \u59cb\u7ec8\u4fdd\u6301\u4f7f\u7528\u6700\u65b0\u7684 AMI","text":"<p>ec2-aws_ami.tf</p> <pre><code>data \"aws_ami\" \"myami\" {\n# \u6700\u65b0\u4f7f\u7528\nmost_recent = true\n# amazon\u5b98\u65b9\u8ba4\u8bc1\nowners      = [\"amazon\"]\n\n# \u955c\u50cf\u6587\u4ef6\u540d\u79f0\u8fc7\u6ee4\nfilter {\nname   = \"name\"\nvalues = [\"amzn-ami-hvm-*-x86_64-gp2\"]\n}\n\n# \u6839\u8bbe\u5907\u8fc7\u6ee4\u6761\u4ef6\nfilter {\nname   = \"root-device-type\"\nvalues = [\"ebs\"]\n}\n}\n</code></pre>"},{"location":"11%E3%80%81EC2%20%E6%95%B0%E6%8D%AE%E6%BA%90%20-%20%E4%BD%BF%E7%94%A8%E6%9C%80%E6%96%B0%E7%9A%84%20AMI%20%E6%95%B0%E6%8D%AE%E6%BA%90/#_7","title":"\u7f16\u5199\u5b89\u5168\u7ec4\u5b9a\u4e49\u6587\u4ef6","text":"<p>ec2-sg.tf</p> <pre><code># Create Security Group\nresource \"aws_security_group\" \"learnaws-sg-web-ssh\" {\n# \u5b89\u5168\u7ec4\u7684\u540d\u79f0\nname        = \"learnaws-sg-web-ssh\"\ndescription = \"Web and SSH\"\n# \u5b89\u5168\u7ec4\u7684\u5165\u53e3\u63cf\u8ff0\ningress {\ndescription = \"Allow Port 80\"\nfrom_port   = 80\nto_port     = 80\nprotocol    = \"tcp\"\n# \u5141\u8bb8\u8303\u56f4\uff0c\u8fd9\u91cc\u662f\u6240\u6709ip\u90fd\u53ef\u8bbf\u95ee\ncidr_blocks = [\"0.0.0.0/0\"]\n}\ningress {\ndescription = \"Allow Port 443\"\nfrom_port   = 443\nto_port     = 443\nprotocol    = \"tcp\"\ncidr_blocks = [\"0.0.0.0/0\"]\n}\ningress {\ndescription = \"Allow Port 22\"\nfrom_port   = 22\nto_port     = 22\nprotocol    = \"tcp\"\ncidr_blocks = [\"0.0.0.0/0\"]\n# cidr_blocks = [\"12.15.55.32/32\"]\n}\n# \u5b89\u5168\u7ec4\u7684\u51fa\u53e3\u63cf\u8ff0\negress {\ndescription = \"Allow all ip and ports outbound\"\nfrom_port   = 0\nto_port     = 0\nprotocol    = \"-1\"\ncidr_blocks = [\"0.0.0.0/0\"]\n}\ntags = {\nName = \"learnaws-sg-web-ssh\"\n}\n}\n</code></pre>"},{"location":"11%E3%80%81EC2%20%E6%95%B0%E6%8D%AE%E6%BA%90%20-%20%E4%BD%BF%E7%94%A8%E6%9C%80%E6%96%B0%E7%9A%84%20AMI%20%E6%95%B0%E6%8D%AE%E6%BA%90/#tf-ami","title":"\u7f16\u5199 TF \u8d44\u6e90\u63cf\u8ff0\u6587\u4ef6\uff0c \u5f15\u7528\u6700\u65b0\u7684 AMI \u6570\u636e\u6e90","text":"<p>ec2.tf</p> <pre><code>###########################################################\n# EC2 \u8d44\u6e90\u8bbe\u7f6e\nresource \"aws_instance\" \"myweb_server2\" {\n# \u5f15\u7528 AMI \u6570\u636e\u6e90\nami           = data.aws_ami.myami.id\n  instance_type = var.instance_type\n  vpc_security_group_ids = [aws_security_group.learnaws-sg-web-ssh.id]\n\ntags = {\nName = \"learnaws-ec2-from-terraform\"\n}\n}\n</code></pre>"},{"location":"11%E3%80%81EC2%20%E6%95%B0%E6%8D%AE%E6%BA%90%20-%20%E4%BD%BF%E7%94%A8%E6%9C%80%E6%96%B0%E7%9A%84%20AMI%20%E6%95%B0%E6%8D%AE%E6%BA%90/#tf","title":"\u7f16\u5199 TF \u9879\u76ee\u63cf\u8ff0\u6587\u4ef6","text":"<p>main.tf</p> <pre><code>###########################################################\n# Terraform \u57fa\u672c\u8bbe\u7f6e\nterraform {\nrequired_providers {\naws = {\nsource  = \"hashicorp/aws\"\nversion = \"~&gt; 3.71\"\n}\n}\nrequired_version = \"&gt;= 1.1.3\"\n}\n\n###########################################################\n# \u63d0\u4f9b\u5546\u8bbe\u7f6e(\u4e91\u5e73\u53f0)\nprovider \"aws\" {\nprofile = \"learnaws\"\nregion  = var.aws_region\n}\n</code></pre>"},{"location":"11%E3%80%81EC2%20%E6%95%B0%E6%8D%AE%E6%BA%90%20-%20%E4%BD%BF%E7%94%A8%E6%9C%80%E6%96%B0%E7%9A%84%20AMI%20%E6%95%B0%E6%8D%AE%E6%BA%90/#_8","title":"\u90e8\u7f72\u786e\u8ba4","text":"<pre><code># \u76ee\u5f55\u521d\u59cb\u5316\n$ terraform init\n# \u68c0\u9a8c tf \u6587\u4ef6\n$ terraform validate\n# \u5b9e\u65bd\u8ba1\u5212, \u51c6\u5907\u8d44\u6e90\n$ terraform plan\n# \u5e94\u7528\u90e8\u7f72\n$ terraform apply\n$ terraform apply -auto-approve\n# \u6467\u6bc1\u7cfb\u7edf\n$ terraform destroy\n$ terraform destroy -auto-approve\n</code></pre>"},{"location":"12%E3%80%81Output%20Values%20-%20%E5%AE%9A%E4%B9%89%E8%BE%93%E5%87%BA%E5%86%85%E5%AE%B9/","title":"Output Values - \u5b9a\u4e49\u8f93\u51fa\u5185\u5bb9","text":""},{"location":"12%E3%80%81Output%20Values%20-%20%E5%AE%9A%E4%B9%89%E8%BE%93%E5%87%BA%E5%86%85%E5%AE%B9/#_1","title":"\u77e5\u8bc6\u70b9","text":"<ul> <li> <p>\u5f53\u6211\u4eec\u6bcf\u6b21\u6267\u884c<code>terraform apply</code>\u547d\u4ee4\u540e\uff0c\u4f1a\u8f93\u51fa\u5f88\u591a\u65e5\u5fd7\uff0c\u6211\u4eec\u53ef\u4ee5\u8fdb\u884c\u5b9a\u4e49\u8f93\u51fa\u5185\u5bb9\uff0c\u628a\u6bd4\u8f83\u5173\u5fc3\u7684\u65e5\u5fd7\u8fdb\u884c\u8f93\u51fa</p> </li> <li> <p>\u5b9a\u4e49 Terraform \u7ba1\u7406\u7684\u4e91\u7aef\u8d44\u6e90\u7684\u8f93\u51fa\u5185\u5bb9</p> </li> </ul>"},{"location":"12%E3%80%81Output%20Values%20-%20%E5%AE%9A%E4%B9%89%E8%BE%93%E5%87%BA%E5%86%85%E5%AE%B9/#_2","title":"\u5b98\u7f51","text":"<p>https://www.terraform.io/language/values/outputs</p>"},{"location":"12%E3%80%81Output%20Values%20-%20%E5%AE%9A%E4%B9%89%E8%BE%93%E5%87%BA%E5%86%85%E5%AE%B9/#_3","title":"\u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3","text":"<ul> <li>\u5b9a\u4e8e\u8d44\u6e90\u8f93\u51fa\u663e\u793a\u7684\u5185\u5bb9</li> <li>\u8fd0\u884c\u6a21\u7248\u786e\u8ba4\u52a8\u4f5c</li> </ul>"},{"location":"12%E3%80%81Output%20Values%20-%20%E5%AE%9A%E4%B9%89%E8%BE%93%E5%87%BA%E5%86%85%E5%AE%B9/#_4","title":"\u64cd\u4f5c\u6b65\u9aa4","text":""},{"location":"12%E3%80%81Output%20Values%20-%20%E5%AE%9A%E4%B9%89%E8%BE%93%E5%87%BA%E5%86%85%E5%AE%B9/#_5","title":"\u76ee\u5f55\u7ed3\u6784","text":"<pre><code>.\n\u251c\u2500\u2500 ec2-variables.tf\n\u251c\u2500\u2500 ec2-aws_ami.tf\n\u251c\u2500\u2500 ec2-sg.tf\n\u251c\u2500\u2500 ec2.tf\n\u251c\u2500\u2500 main.tf\n\u2514\u2500\u2500 ec2-outputs.tf\n</code></pre>"},{"location":"12%E3%80%81Output%20Values%20-%20%E5%AE%9A%E4%B9%89%E8%BE%93%E5%87%BA%E5%86%85%E5%AE%B9/#_6","title":"\u7f16\u5199\u53d8\u91cf\u5b9a\u4e49\u6587\u4ef6","text":"<p>ec2-variables.tf</p> <pre><code># AWS Region\nvariable \"aws_region\" {\ndescription = \"AWS Region\"\ntype = string\n  default = \"ap-northeast-1\"\n}\n\n# AWS EC2 Instance Type\nvariable \"instance_type\" {\ndescription = \"EC2 Instance Type\"\ntype = string\n  default = \"t3.micro\"  }\n</code></pre>"},{"location":"12%E3%80%81Output%20Values%20-%20%E5%AE%9A%E4%B9%89%E8%BE%93%E5%87%BA%E5%86%85%E5%AE%B9/#ec2-ami-ami","title":"\u7f16\u5199 EC2 AMI \u6570\u636e\u6e90\u6587\u4ef6\uff0c \u59cb\u7ec8\u4fdd\u6301\u4f7f\u7528\u6700\u65b0\u7684 AMI","text":"<p>ec2-aws_ami.tf</p> <pre><code>data \"aws_ami\" \"myami\" {\n# \u6700\u65b0\u4f7f\u7528\nmost_recent = true\n# amazon\u5b98\u65b9\u8ba4\u8bc1\nowners      = [\"amazon\"]\n\n# \u955c\u50cf\u6587\u4ef6\u540d\u79f0\u8fc7\u6ee4\nfilter {\nname   = \"name\"\nvalues = [\"amzn-ami-hvm-*-x86_64-gp2\"]\n}\n\n# \u6839\u8bbe\u5907\u8fc7\u6ee4\u6761\u4ef6\nfilter {\nname   = \"root-device-type\"\nvalues = [\"ebs\"]\n}\n}\n</code></pre>"},{"location":"12%E3%80%81Output%20Values%20-%20%E5%AE%9A%E4%B9%89%E8%BE%93%E5%87%BA%E5%86%85%E5%AE%B9/#_7","title":"\u7f16\u5199\u5b89\u5168\u7ec4\u5b9a\u4e49\u6587\u4ef6","text":"<p>ec2-sg.tf</p> <pre><code># Create Security Group\nresource \"aws_security_group\" \"learnaws-sg-web-ssh\" {\n# \u5b89\u5168\u7ec4\u7684\u540d\u79f0\nname        = \"learnaws-sg-web-ssh\"\ndescription = \"Web and SSH\"\n# \u5b89\u5168\u7ec4\u7684\u5165\u53e3\u63cf\u8ff0\ningress {\ndescription = \"Allow Port 80\"\nfrom_port   = 80\nto_port     = 80\nprotocol    = \"tcp\"\n# \u5141\u8bb8\u8303\u56f4\uff0c\u8fd9\u91cc\u662f\u6240\u6709ip\u90fd\u53ef\u8bbf\u95ee\ncidr_blocks = [\"0.0.0.0/0\"]\n}\ningress {\ndescription = \"Allow Port 443\"\nfrom_port   = 443\nto_port     = 443\nprotocol    = \"tcp\"\ncidr_blocks = [\"0.0.0.0/0\"]\n}\ningress {\ndescription = \"Allow Port 22\"\nfrom_port   = 22\nto_port     = 22\nprotocol    = \"tcp\"\ncidr_blocks = [\"0.0.0.0/0\"]\n# cidr_blocks = [\"12.15.55.32/32\"]\n}\n# \u5b89\u5168\u7ec4\u7684\u51fa\u53e3\u63cf\u8ff0\negress {\ndescription = \"Allow all ip and ports outbound\"\nfrom_port   = 0\nto_port     = 0\nprotocol    = \"-1\"\ncidr_blocks = [\"0.0.0.0/0\"]\n}\ntags = {\nName = \"learnaws-sg-web-ssh\"\n}\n}\n</code></pre>"},{"location":"12%E3%80%81Output%20Values%20-%20%E5%AE%9A%E4%B9%89%E8%BE%93%E5%87%BA%E5%86%85%E5%AE%B9/#tf","title":"\u7f16\u5199 TF \u8d44\u6e90\u63cf\u8ff0\u6587\u4ef6","text":"<p>ec2.tf</p> <pre><code>###########################################################\n# EC2 \u8d44\u6e90\u8bbe\u7f6e\nresource \"aws_instance\" \"myweb_server2\" {\n# \u5f15\u7528 AMI \u6570\u636e\u6e90\nami           = data.aws_ami.myami.id\n  instance_type = var.instance_type\n  vpc_security_group_ids = [aws_security_group.learnaws-sg-web-ssh.id]\n\ntags = {\nName = \"learnaws-ec2-from-terraform\"\n}\n}\n</code></pre>"},{"location":"12%E3%80%81Output%20Values%20-%20%E5%AE%9A%E4%B9%89%E8%BE%93%E5%87%BA%E5%86%85%E5%AE%B9/#tf_1","title":"\u7f16\u5199 TF \u9879\u76ee\u63cf\u8ff0\u6587\u4ef6","text":"<p>main.tf</p> <pre><code>###########################################################\n# Terraform \u57fa\u672c\u8bbe\u7f6e\nterraform {\nrequired_providers {\naws = {\nsource  = \"hashicorp/aws\"\nversion = \"~&gt; 3.71\"\n}\n}\nrequired_version = \"&gt;= 1.1.3\"\n}\n\n###########################################################\n# \u63d0\u4f9b\u5546\u8bbe\u7f6e(\u4e91\u5e73\u53f0)\nprovider \"aws\" {\nprofile = \"learnaws\"\nregion  = var.aws_region\n}\n</code></pre>"},{"location":"12%E3%80%81Output%20Values%20-%20%E5%AE%9A%E4%B9%89%E8%BE%93%E5%87%BA%E5%86%85%E5%AE%B9/#_8","title":"\u5b9a\u4e49\u8d44\u6e90\u8f93\u51fa\u663e\u793a\u7684\u5185\u5bb9","text":"<p>ec2-outputs.tf</p> <pre><code>output \"instance_publicip\" {\n# EC2 \u516c\u6709IP\nvalue = aws_instance.myweb_server2.public_ip\n}\noutput \"instance_availability_zone\" {\n# \u90e8\u7f72\u7684\u53ef\u7528\u533a\nvalue = aws_instance.myweb_server2.availability_zone\n}\noutput \"instance_ami\" {\n# \u4f7f\u7528\u7684 AMI\nvalue = aws_instance.myweb_server2.ami\n}\noutput \"instance_private_ip\" {\n# EC2 \u79c1\u6709\u7f51\u65ad IP\nvalue = aws_instance.myweb_server2.private_ip\n}\noutput \"instance_cpu_core_count\" {\n# EC2 CPU \u6838\u5fc3\u6570\nvalue = aws_instance.myweb_server2.cpu_core_count\n}\noutput \"instance_instance_type\" {\n# EC2 \u5b9e\u4f8b\u7c7b\u578b\nvalue = aws_instance.myweb_server2.instance_type\n}\n\n# \u6700\u540e\u8f93\u51fa\u7684\u6837\u5f0f\u5982\u4e0b:\n# instance_ami = \"ami-0d9f3ffed238c343f\"\n# instance_availability_zone = \"ap-northeast-1c\"\n# instance_cpu_core_count = \"1\"\n# instance_instance_type = \"t3.micro\"\n# instance_private_ip = \"172.31.13.114\"\n# instance_publicip = \"18.183.155.128\"\n</code></pre> <p>EC2\u8d44\u6e90\u5c5e\u6027\u53c2\u7167</p> <p>https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance</p>"},{"location":"12%E3%80%81Output%20Values%20-%20%E5%AE%9A%E4%B9%89%E8%BE%93%E5%87%BA%E5%86%85%E5%AE%B9/#_9","title":"\u8fd0\u884c\u6a21\u7248\u786e\u8ba4\u52a8\u4f5c","text":"<pre><code># \u76ee\u5f55\u521d\u59cb\u5316\n$ terraform init\n# \u68c0\u9a8c tf \u6587\u4ef6\n$ terraform validate\n# \u5b9e\u65bd\u8ba1\u5212, \u51c6\u5907\u8d44\u6e90\n$ terraform plan\n# \u5e94\u7528\u90e8\u7f72\n$ terraform apply\n$ terraform apply -auto-approve\n# \u6467\u6bc1\u7cfb\u7edf\n$ terraform destroy\n</code></pre>"},{"location":"13%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E5%88%97%E8%A1%A8/","title":"\u5b9a\u4e49 EC2 \u7684Size\u5217\u8868","text":""},{"location":"13%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E5%88%97%E8%A1%A8/#_1","title":"\u77e5\u8bc6\u70b9","text":"<ul> <li>\u4f7f\u7528 list \u5217\u8868\u7c7b\u578b, \u5b9a\u4e49\u591a\u79cd EC2 \u542f\u52a8\u5b9e\u4f8b</li> </ul>"},{"location":"13%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E5%88%97%E8%A1%A8/#_2","title":"\u5b98\u7f51","text":"<p>https://www.terraform.io/language/functions/list</p>"},{"location":"13%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E5%88%97%E8%A1%A8/#_3","title":"\u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3","text":"<ul> <li>\u5b9a\u4e49 EC2 \u542f\u52a8\u7c7b\u578b\u5217\u8868</li> <li>\u5728 EC2 \u5b9a\u4e49\u6587\u4ef6\u4e2d\u5f15\u7528\u5217\u8868\u7c7b\u578b</li> <li>\u8fd0\u884c\u6a21\u7248\u786e\u8ba4\u52a8\u4f5c</li> </ul>"},{"location":"13%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E5%88%97%E8%A1%A8/#_4","title":"\u64cd\u4f5c\u6b65\u9aa4","text":""},{"location":"13%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E5%88%97%E8%A1%A8/#_5","title":"\u76ee\u5f55\u7ed3\u6784","text":"<pre><code>.\n\u251c\u2500\u2500 ec2-aws_ami.tf\n\u251c\u2500\u2500 ec2-sg.tf\n\u251c\u2500\u2500 ec2-variables.tf\n\u251c\u2500\u2500 ec2.tf\n\u251c\u2500\u2500 main.tf\n\u2514\u2500\u2500 ec2-outputs.tf\n</code></pre>"},{"location":"13%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E5%88%97%E8%A1%A8/#ec2-ami-ami","title":"\u7f16\u5199 EC2 AMI \u6570\u636e\u6e90\u6587\u4ef6\uff0c \u59cb\u7ec8\u4fdd\u6301\u4f7f\u7528\u6700\u65b0\u7684 AMI","text":"<p>ec2-aws_ami.tf</p> <pre><code>data \"aws_ami\" \"myami\" {\n# \u6700\u65b0\u4f7f\u7528\nmost_recent = true\n# amazon\u5b98\u65b9\u8ba4\u8bc1\nowners      = [\"amazon\"]\n\n# \u955c\u50cf\u6587\u4ef6\u540d\u79f0\u8fc7\u6ee4\nfilter {\nname   = \"name\"\nvalues = [\"amzn-ami-hvm-*-x86_64-gp2\"]\n}\n\n# \u6839\u8bbe\u5907\u8fc7\u6ee4\u6761\u4ef6\nfilter {\nname   = \"root-device-type\"\nvalues = [\"ebs\"]\n}\n}\n</code></pre>"},{"location":"13%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E5%88%97%E8%A1%A8/#_6","title":"\u7f16\u5199\u5b89\u5168\u7ec4\u5b9a\u4e49\u6587\u4ef6","text":"<p>ec2-sg.tf</p> <pre><code># Create Security Group\nresource \"aws_security_group\" \"learnaws-sg-web-ssh\" {\n# \u5b89\u5168\u7ec4\u7684\u540d\u79f0\nname        = \"learnaws-sg-web-ssh\"\ndescription = \"Web and SSH\"\n# \u5b89\u5168\u7ec4\u7684\u5165\u53e3\u63cf\u8ff0\ningress {\ndescription = \"Allow Port 80\"\nfrom_port   = 80\nto_port     = 80\nprotocol    = \"tcp\"\n# \u5141\u8bb8\u8303\u56f4\uff0c\u8fd9\u91cc\u662f\u6240\u6709ip\u90fd\u53ef\u8bbf\u95ee\ncidr_blocks = [\"0.0.0.0/0\"]\n}\ningress {\ndescription = \"Allow Port 443\"\nfrom_port   = 443\nto_port     = 443\nprotocol    = \"tcp\"\ncidr_blocks = [\"0.0.0.0/0\"]\n}\ningress {\ndescription = \"Allow Port 22\"\nfrom_port   = 22\nto_port     = 22\nprotocol    = \"tcp\"\ncidr_blocks = [\"0.0.0.0/0\"]\n# cidr_blocks = [\"12.15.55.32/32\"]\n}\n# \u5b89\u5168\u7ec4\u7684\u51fa\u53e3\u63cf\u8ff0\negress {\ndescription = \"Allow all ip and ports outbound\"\nfrom_port   = 0\nto_port     = 0\nprotocol    = \"-1\"\ncidr_blocks = [\"0.0.0.0/0\"]\n}\ntags = {\nName = \"learnaws-sg-web-ssh\"\n}\n}\n</code></pre>"},{"location":"13%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E5%88%97%E8%A1%A8/#ec2","title":"\u5b9a\u4e49 EC2 \u542f\u52a8\u7c7b\u578b\u5217\u8868","text":"<p>ec2-variables.tf</p> <pre><code># AWS Region\nvariable \"aws_region\" {\ndescription = \"AWS Region\"\ntype = string\n  default = \"ap-northeast-1\"\n}\n\n# \u4e4b\u524d\u4f7f\u7528\u7684: AWS EC2 Instance Type\n# variable \"instance_type\" {\n#   description = \"EC2 Instance Type\"\n#   type = string\n#   default = \"t2.micro\"  \n# }\n\n# AWS EC2 Instance Type List\nvariable \"instance_type_list\" {\ndescription = \"EC2 Instnace Type\"\ntype = list(string)\ndefault = [\"t2.micro\", \"t3.micro\", \"t3.small\"]\n}\n</code></pre>"},{"location":"13%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E5%88%97%E8%A1%A8/#ec2_1","title":"\u5728 EC2 \u5b9a\u4e49\u6587\u4ef6\u4e2d\u5f15\u7528\u5217\u8868\u7c7b\u578b","text":"<p>ec2.tf</p> <pre><code>###########################################################\n# EC2 \u8d44\u6e90\u8bbe\u7f6e\nresource \"aws_instance\" \"myweb_server2\" {\nami           = data.aws_ami.myami.id\n  # \u5f15\u7528 EC2 \u542f\u52a8\u7c7b\u578b\u7684list\u5217\u8868\uff0c\u8fd9\u91cc\u5bf9\u5e94\"t3.small\"\u7c7b\u578b\ninstance_type = var.instance_type_list[2]\nvpc_security_group_ids = [aws_security_group.learnaws-sg-web-ssh.id]\n\ntags = {\nName = \"learnaws-ec2-from-terraform-cli\"\n}\n}\n</code></pre>"},{"location":"13%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E5%88%97%E8%A1%A8/#tf","title":"\u7f16\u5199 TF \u9879\u76ee\u63cf\u8ff0\u6587\u4ef6","text":"<p>main.tf</p> <pre><code>###########################################################\n# Terraform \u57fa\u672c\u8bbe\u7f6e\nterraform {\nrequired_providers {\naws = {\nsource  = \"hashicorp/aws\"\nversion = \"~&gt; 3.71\"\n}\n}\nrequired_version = \"&gt;= 1.1.3\"\n}\n\n###########################################################\n# \u63d0\u4f9b\u5546\u8bbe\u7f6e(\u4e91\u5e73\u53f0)\nprovider \"aws\" {\nprofile = \"learnaws\"\nregion  = var.aws_region\n}\n</code></pre>"},{"location":"13%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E5%88%97%E8%A1%A8/#_7","title":"\u5b9a\u4e49\u8d44\u6e90\u8f93\u51fa\u663e\u793a\u7684\u5185\u5bb9","text":"<p>ec2-outputs.tf</p> <pre><code>output \"instance_publicip\" {\n# EC2 \u516c\u6709IP\nvalue = aws_instance.myweb_server2.public_ip\n}\noutput \"instance_availability_zone\" {\n# \u90e8\u7f72\u7684\u53ef\u7528\u533a\nvalue = aws_instance.myweb_server2.availability_zone\n}\noutput \"instance_ami\" {\n# \u4f7f\u7528\u7684 AMI\nvalue = aws_instance.myweb_server2.ami\n}\noutput \"instance_private_ip\" {\n# EC2 \u79c1\u6709\u7f51\u65ad IP\nvalue = aws_instance.myweb_server2.private_ip\n}\noutput \"instance_cpu_core_count\" {\n# EC2 CPU \u6838\u5fc3\u6570\nvalue = aws_instance.myweb_server2.cpu_core_count\n}\noutput \"instance_instance_type\" {\n# EC2 \u5b9e\u4f8b\u7c7b\u578b\nvalue = aws_instance.myweb_server2.instance_type\n}\n\n# \u6700\u540e\u8f93\u51fa\u7684\u6837\u5f0f\u5982\u4e0b:\n# instance_ami = \"ami-0d9f3ffed238c343f\"\n# instance_availability_zone = \"ap-northeast-1c\"\n# instance_cpu_core_count = \"1\"\n# instance_instance_type = \"t3.small\"\n# instance_private_ip = \"172.31.13.114\"\n# instance_publicip = \"18.183.155.128\"\n</code></pre> <p>EC2\u8d44\u6e90\u5c5e\u6027\u53c2\u7167</p> <p>https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance</p>"},{"location":"13%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E5%88%97%E8%A1%A8/#_8","title":"\u8fd0\u884c\u6a21\u7248\u786e\u8ba4\u52a8\u4f5c","text":"<pre><code># \u76ee\u5f55\u521d\u59cb\u5316\n$ terraform init\n# \u68c0\u9a8c tf \u6587\u4ef6\n$ terraform validate\n# \u5b9e\u65bd\u8ba1\u5212, \u51c6\u5907\u8d44\u6e90\n$ terraform plan\n# \u5e94\u7528\u90e8\u7f72\n$ terraform apply\n$ terraform apply -auto-approve\n# \u6467\u6bc1\u7cfb\u7edf\n$ terraform destroy\n$ terraform destroy -auto-approve\n</code></pre>"},{"location":"14%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E6%98%A0%E5%B0%84/","title":"\u5b9a\u4e49 EC2 \u7684Size\u6620\u5c04","text":""},{"location":"14%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E6%98%A0%E5%B0%84/#_1","title":"\u77e5\u8bc6\u70b9","text":"<ul> <li>\u4f7f\u7528 map \u6620\u5c04\u7c7b\u578b, \u5b9a\u4e49\u591a\u79cd EC2 \u542f\u52a8\u5b9e\u4f8b</li> </ul>"},{"location":"14%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E6%98%A0%E5%B0%84/#_2","title":"\u5b98\u7f51","text":"<p>https://www.terraform.io/language/functions/map</p>"},{"location":"14%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E6%98%A0%E5%B0%84/#_3","title":"\u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3","text":"<ul> <li>\u5b9a\u4e49 EC2 \u542f\u52a8\u73af\u5883\u5217\u8868</li> <li>\u5728 EC2 \u5b9a\u4e49\u6587\u4ef6\u4e2d\u5f15\u7528\u73af\u5883\u7c7b\u578b, \u542f\u52a8 EC2</li> <li>\u8fd0\u884c\u6a21\u7248\u786e\u8ba4\u52a8\u4f5c</li> </ul>"},{"location":"14%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E6%98%A0%E5%B0%84/#_4","title":"\u64cd\u4f5c\u6b65\u9aa4","text":""},{"location":"14%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E6%98%A0%E5%B0%84/#_5","title":"\u76ee\u5f55\u7ed3\u6784","text":"<pre><code>.\n\u251c\u2500\u2500 ec2-aws_ami.tf\n\u251c\u2500\u2500 ec2-sg.tf\n\u251c\u2500\u2500 ec2-variables.tf\n\u251c\u2500\u2500 ec2.tf\n\u251c\u2500\u2500 main.tf\n\u2514\u2500\u2500 ec2-outputs.tf\n</code></pre>"},{"location":"14%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E6%98%A0%E5%B0%84/#ec2-ami-ami","title":"\u7f16\u5199 EC2 AMI \u6570\u636e\u6e90\u6587\u4ef6\uff0c \u59cb\u7ec8\u4fdd\u6301\u4f7f\u7528\u6700\u65b0\u7684 AMI","text":"<p>ec2-aws_ami.tf</p> <pre><code>data \"aws_ami\" \"myami\" {\n# \u6700\u65b0\u4f7f\u7528\nmost_recent = true\n# amazon\u5b98\u65b9\u8ba4\u8bc1\nowners      = [\"amazon\"]\n\n# \u955c\u50cf\u6587\u4ef6\u540d\u79f0\u8fc7\u6ee4\nfilter {\nname   = \"name\"\nvalues = [\"amzn-ami-hvm-*-x86_64-gp2\"]\n}\n\n# \u6839\u8bbe\u5907\u8fc7\u6ee4\u6761\u4ef6\nfilter {\nname   = \"root-device-type\"\nvalues = [\"ebs\"]\n}\n}\n</code></pre>"},{"location":"14%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E6%98%A0%E5%B0%84/#_6","title":"\u7f16\u5199\u5b89\u5168\u7ec4\u5b9a\u4e49\u6587\u4ef6","text":"<p>ec2-sg.tf</p> <pre><code># Create Security Group\nresource \"aws_security_group\" \"learnaws-sg-web-ssh\" {\n# \u5b89\u5168\u7ec4\u7684\u540d\u79f0\nname        = \"learnaws-sg-web-ssh\"\ndescription = \"Web and SSH\"\n# \u5b89\u5168\u7ec4\u7684\u5165\u53e3\u63cf\u8ff0\ningress {\ndescription = \"Allow Port 80\"\nfrom_port   = 80\nto_port     = 80\nprotocol    = \"tcp\"\n# \u5141\u8bb8\u8303\u56f4\uff0c\u8fd9\u91cc\u662f\u6240\u6709ip\u90fd\u53ef\u8bbf\u95ee\ncidr_blocks = [\"0.0.0.0/0\"]\n}\ningress {\ndescription = \"Allow Port 443\"\nfrom_port   = 443\nto_port     = 443\nprotocol    = \"tcp\"\ncidr_blocks = [\"0.0.0.0/0\"]\n}\ningress {\ndescription = \"Allow Port 22\"\nfrom_port   = 22\nto_port     = 22\nprotocol    = \"tcp\"\ncidr_blocks = [\"0.0.0.0/0\"]\n# cidr_blocks = [\"12.15.55.32/32\"]\n}\n# \u5b89\u5168\u7ec4\u7684\u51fa\u53e3\u63cf\u8ff0\negress {\ndescription = \"Allow all ip and ports outbound\"\nfrom_port   = 0\nto_port     = 0\nprotocol    = \"-1\"\ncidr_blocks = [\"0.0.0.0/0\"]\n}\ntags = {\nName = \"learnaws-sg-web-ssh\"\n}\n}\n</code></pre>"},{"location":"14%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E6%98%A0%E5%B0%84/#ec2","title":"\u5b9a\u4e49 EC2 \u542f\u52a8\u73af\u5883\u6620\u5c04","text":"<p>ec2-variables.tf</p> <pre><code># AWS Region\nvariable \"aws_region\" {\ndescription = \"AWS Region\"\ntype = string\n  default = \"ap-northeast-1\"\n}\n\n# AWS EC2 Instance Env\nvariable \"instance_type_env\" {\ndescription = \"EC2 Instnace Type Env\"\ntype = map(string)\ndefault = {\n\"dev\" = \"t2.micro\"\n\"prod\" = \"t2.large\"\n}\n}\n</code></pre>"},{"location":"14%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E6%98%A0%E5%B0%84/#ec2-ec2","title":"\u5728 EC2 \u5b9a\u4e49\u6587\u4ef6\u4e2d\u5f15\u7528\u73af\u5883\u7c7b\u578b, \u542f\u52a8 EC2","text":"<p>ec2.tf</p> <pre><code>###########################################################\n# EC2 \u8d44\u6e90\u8bbe\u7f6e\nresource \"aws_instance\" \"myweb_server2\" {\nami           = data.aws_ami.myami.id\n  # \u5f15\u7528 EC2 \u542f\u52a8\u7c7b\u578b\u5217\u8868\ninstance_type = var.instance_type_env[\"dev\"]\nvpc_security_group_ids = [aws_security_group.learnaws-sg-web-ssh.id]\n\ntags = {\nName = \"learnaws-ec2-from-terraform-cli\"\n}\n}\n</code></pre>"},{"location":"14%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E6%98%A0%E5%B0%84/#tf","title":"\u7f16\u5199 TF \u9879\u76ee\u63cf\u8ff0\u6587\u4ef6","text":"<p>main.tf</p> <pre><code>###########################################################\n# Terraform \u57fa\u672c\u8bbe\u7f6e\nterraform {\nrequired_providers {\naws = {\nsource  = \"hashicorp/aws\"\nversion = \"~&gt; 3.71\"\n}\n}\nrequired_version = \"&gt;= 1.1.3\"\n}\n\n###########################################################\n# \u63d0\u4f9b\u5546\u8bbe\u7f6e(\u4e91\u5e73\u53f0)\nprovider \"aws\" {\nprofile = \"learnaws\"\nregion  = var.aws_region\n}\n</code></pre>"},{"location":"14%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E6%98%A0%E5%B0%84/#_7","title":"\u5b9a\u4e49\u8d44\u6e90\u8f93\u51fa\u663e\u793a\u7684\u5185\u5bb9","text":"<p>ec2-outputs.tf</p> <pre><code>output \"instance_publicip\" {\n# EC2 \u516c\u6709IP\nvalue = aws_instance.myweb_server2.public_ip\n}\noutput \"instance_availability_zone\" {\n# \u90e8\u7f72\u7684\u53ef\u7528\u533a\nvalue = aws_instance.myweb_server2.availability_zone\n}\noutput \"instance_ami\" {\n# \u4f7f\u7528\u7684 AMI\nvalue = aws_instance.myweb_server2.ami\n}\noutput \"instance_private_ip\" {\n# EC2 \u79c1\u6709\u7f51\u65ad IP\nvalue = aws_instance.myweb_server2.private_ip\n}\noutput \"instance_cpu_core_count\" {\n# EC2 CPU \u6838\u5fc3\u6570\nvalue = aws_instance.myweb_server2.cpu_core_count\n}\noutput \"instance_instance_type\" {\n# EC2 \u5b9e\u4f8b\u7c7b\u578b\nvalue = aws_instance.myweb_server2.instance_type\n}\n\n# \u6700\u540e\u8f93\u51fa\u7684\u6837\u5f0f\u5982\u4e0b:\n# instance_ami = \"ami-0d9f3ffed238c343f\"\n# instance_availability_zone = \"ap-northeast-1c\"\n# instance_cpu_core_count = \"1\"\n# instance_instance_type = \"t3.small\"\n# instance_private_ip = \"172.31.13.114\"\n# instance_publicip = \"18.183.155.128\"\n</code></pre> <p>EC2\u8d44\u6e90\u5c5e\u6027\u53c2\u7167</p> <p>https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance</p>"},{"location":"14%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E6%98%A0%E5%B0%84/#_8","title":"\u8fd0\u884c\u6a21\u7248\u786e\u8ba4\u52a8\u4f5c","text":"<pre><code># \u76ee\u5f55\u521d\u59cb\u5316\n$ terraform init\n# \u68c0\u9a8c tf \u6587\u4ef6\n$ terraform validate\n# \u5b9e\u65bd\u8ba1\u5212, \u51c6\u5907\u8d44\u6e90\n$ terraform plan\n# \u5e94\u7528\u90e8\u7f72\n$ terraform apply\n$ terraform apply -auto-approve\n# \u6467\u6bc1\u7cfb\u7edf\n$ terraform destroy\n$ terraform destroy -auto-approve\n</code></pre>"},{"location":"15%E3%80%81%E5%90%8C%E6%97%B6%E5%90%AF%E5%8A%A8%E5%A4%9A%E5%8F%B0%20EC2%20%E5%AE%9E%E4%BE%8B/","title":"\u540c\u65f6\u542f\u52a8\u591a\u53f0 EC2 \u5b9e\u4f8b","text":""},{"location":"15%E3%80%81%E5%90%8C%E6%97%B6%E5%90%AF%E5%8A%A8%E5%A4%9A%E5%8F%B0%20EC2%20%E5%AE%9E%E4%BE%8B/#_1","title":"\u77e5\u8bc6\u70b9","text":"<ul> <li>\u540c\u65f6\u542f\u52a8\u6307\u5b9a\u53f0\u6570\u7684\u540c\u6837\u914d\u7f6e\u7684 EC2 \u5b9e\u4f8b</li> </ul>"},{"location":"15%E3%80%81%E5%90%8C%E6%97%B6%E5%90%AF%E5%8A%A8%E5%A4%9A%E5%8F%B0%20EC2%20%E5%AE%9E%E4%BE%8B/#_2","title":"\u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3","text":"<ul> <li>\u4fee\u6539 EC2 \u8d44\u6e90\u914d\u7f6e\uff0c \u8bbe\u7f6e\u542f\u52a8\u6570\u91cf</li> <li>\u4fee\u6539 Outputs \u8f93\u51fa\u5b9a\u4e49(\u7531\u4e8e\u751f\u6210\u591a\u53f0EC2)</li> <li>\u8fd0\u884c\u6a21\u7248\u786e\u8ba4\u52a8\u4f5c</li> </ul>"},{"location":"15%E3%80%81%E5%90%8C%E6%97%B6%E5%90%AF%E5%8A%A8%E5%A4%9A%E5%8F%B0%20EC2%20%E5%AE%9E%E4%BE%8B/#_3","title":"\u64cd\u4f5c\u6b65\u9aa4","text":""},{"location":"15%E3%80%81%E5%90%8C%E6%97%B6%E5%90%AF%E5%8A%A8%E5%A4%9A%E5%8F%B0%20EC2%20%E5%AE%9E%E4%BE%8B/#_4","title":"\u76ee\u5f55\u7ed3\u6784","text":"<pre><code>.\n\u251c\u2500\u2500 ec2-aws_ami.tf\n\u251c\u2500\u2500 ec2-sg.tf\n\u251c\u2500\u2500 ec2-variables.tf\n\u251c\u2500\u2500 ec2.tf\n\u251c\u2500\u2500 main.tf\n\u2514\u2500\u2500 ec2-outputs.tf\n</code></pre>"},{"location":"15%E3%80%81%E5%90%8C%E6%97%B6%E5%90%AF%E5%8A%A8%E5%A4%9A%E5%8F%B0%20EC2%20%E5%AE%9E%E4%BE%8B/#ec2-ami-ami","title":"\u7f16\u5199 EC2 AMI \u6570\u636e\u6e90\u6587\u4ef6\uff0c \u59cb\u7ec8\u4fdd\u6301\u4f7f\u7528\u6700\u65b0\u7684 AMI","text":"<p>ec2-aws_ami.tf</p> <pre><code>data \"aws_ami\" \"myami\" {\n# \u6700\u65b0\u4f7f\u7528\nmost_recent = true\n# amazon\u5b98\u65b9\u8ba4\u8bc1\nowners      = [\"amazon\"]\n\n# \u955c\u50cf\u6587\u4ef6\u540d\u79f0\u8fc7\u6ee4\nfilter {\nname   = \"name\"\nvalues = [\"amzn-ami-hvm-*-x86_64-gp2\"]\n}\n\n# \u6839\u8bbe\u5907\u8fc7\u6ee4\u6761\u4ef6\nfilter {\nname   = \"root-device-type\"\nvalues = [\"ebs\"]\n}\n}\n</code></pre>"},{"location":"15%E3%80%81%E5%90%8C%E6%97%B6%E5%90%AF%E5%8A%A8%E5%A4%9A%E5%8F%B0%20EC2%20%E5%AE%9E%E4%BE%8B/#_5","title":"\u7f16\u5199\u5b89\u5168\u7ec4\u5b9a\u4e49\u6587\u4ef6","text":"<p>ec2-sg.tf</p> <pre><code># Create Security Group\nresource \"aws_security_group\" \"learnaws-sg-web-ssh\" {\n# \u5b89\u5168\u7ec4\u7684\u540d\u79f0\nname        = \"learnaws-sg-web-ssh\"\ndescription = \"Web and SSH\"\n# \u5b89\u5168\u7ec4\u7684\u5165\u53e3\u63cf\u8ff0\ningress {\ndescription = \"Allow Port 80\"\nfrom_port   = 80\nto_port     = 80\nprotocol    = \"tcp\"\n# \u5141\u8bb8\u8303\u56f4\uff0c\u8fd9\u91cc\u662f\u6240\u6709ip\u90fd\u53ef\u8bbf\u95ee\ncidr_blocks = [\"0.0.0.0/0\"]\n}\ningress {\ndescription = \"Allow Port 443\"\nfrom_port   = 443\nto_port     = 443\nprotocol    = \"tcp\"\ncidr_blocks = [\"0.0.0.0/0\"]\n}\ningress {\ndescription = \"Allow Port 22\"\nfrom_port   = 22\nto_port     = 22\nprotocol    = \"tcp\"\ncidr_blocks = [\"0.0.0.0/0\"]\n# cidr_blocks = [\"12.15.55.32/32\"]\n}\n# \u5b89\u5168\u7ec4\u7684\u51fa\u53e3\u63cf\u8ff0\negress {\ndescription = \"Allow all ip and ports outbound\"\nfrom_port   = 0\nto_port     = 0\nprotocol    = \"-1\"\ncidr_blocks = [\"0.0.0.0/0\"]\n}\ntags = {\nName = \"learnaws-sg-web-ssh\"\n}\n}\n</code></pre>"},{"location":"15%E3%80%81%E5%90%8C%E6%97%B6%E5%90%AF%E5%8A%A8%E5%A4%9A%E5%8F%B0%20EC2%20%E5%AE%9E%E4%BE%8B/#ec2_1","title":"\u5b9a\u4e49 EC2 \u542f\u52a8\u73af\u5883\u6620\u5c04","text":"<p>ec2-variables.tf</p> <pre><code># AWS Region\nvariable \"aws_region\" {\ndescription = \"AWS Region\"\ntype = string\n  default = \"ap-northeast-1\"\n}\n\n# AWS EC2 Instance Env\nvariable \"instance_type_env\" {\ndescription = \"EC2 Instnace Type Env\"\ntype = map(string)\ndefault = {\n\"dev\" = \"t2.micro\"\n\"prod\" = \"t2.large\"\n}\n}\n</code></pre>"},{"location":"15%E3%80%81%E5%90%8C%E6%97%B6%E5%90%AF%E5%8A%A8%E5%A4%9A%E5%8F%B0%20EC2%20%E5%AE%9E%E4%BE%8B/#ec2_2","title":"\u4fee\u6539 EC2 \u8d44\u6e90\u914d\u7f6e\uff0c \u8bbe\u7f6e\u542f\u52a8\u6570\u91cf","text":"<p>ec2.tf</p> <pre><code>###########################################################\n# EC2 \u8d44\u6e90\u8bbe\u7f6e\nresource \"aws_instance\" \"myweb_server2\" {\nami                    = data.aws_ami.myami.id\n  instance_type          = var.instance_type_env[\"dev\"]\nvpc_security_group_ids = [aws_security_group.learnaws-sg-web-ssh.id]\n\n# \u8bbe\u7f6e\u542f\u52a8\u53f0\u6570\ncount = 3\n\ntags = {\n# \u4e3a\u751f\u6210\u7684 EC2 \u52a0\u5165\u6807\u7b7e\u7d22\u5f15\nName = \"learnaws-tf-ec2-${count.index}\"\n}\n}\n</code></pre>"},{"location":"15%E3%80%81%E5%90%8C%E6%97%B6%E5%90%AF%E5%8A%A8%E5%A4%9A%E5%8F%B0%20EC2%20%E5%AE%9E%E4%BE%8B/#tf","title":"\u7f16\u5199 TF \u9879\u76ee\u63cf\u8ff0\u6587\u4ef6","text":"<p>main.tf</p> <pre><code>###########################################################\n# Terraform \u57fa\u672c\u8bbe\u7f6e\nterraform {\nrequired_providers {\naws = {\nsource  = \"hashicorp/aws\"\nversion = \"~&gt; 3.71\"\n}\n}\nrequired_version = \"&gt;= 1.1.3\"\n}\n\n###########################################################\n# \u63d0\u4f9b\u5546\u8bbe\u7f6e(\u4e91\u5e73\u53f0)\nprovider \"aws\" {\nprofile = \"learnaws\"\nregion  = var.aws_region\n}\n</code></pre>"},{"location":"15%E3%80%81%E5%90%8C%E6%97%B6%E5%90%AF%E5%8A%A8%E5%A4%9A%E5%8F%B0%20EC2%20%E5%AE%9E%E4%BE%8B/#outputs-ec2","title":"\u4fee\u6539 Outputs \u8f93\u51fa\u5b9a\u4e49(\u7531\u4e8e\u751f\u6210\u591a\u53f0EC2)","text":"<p>ec2-outputs.tf</p> <pre><code>output \"instance_instance_type\" {\n# EC2 \u5b9e\u4f8b\u7c7b\u578b\uff0c\u56e0\u4e3a\u6240\u6709\u7684EC2\u90fd\u662f\u4e00\u6837\u7684\uff0c\u53d6\u7b2c\u4e00\u4e2a\u8f93\u51fa\u5373\u53ef\nvalue = aws_instance.myweb_server2[0].instance_type\n}\noutput \"instance_ami\" {\n# \u4f7f\u7528\u7684 AMI\uff0c\u56e0\u4e3a\u6240\u6709\u7684EC2\u90fd\u662f\u4e00\u6837\u7684\uff0c\u53d6\u7b2c\u4e00\u4e2a\u8f93\u51fa\u5373\u53ef\nvalue = aws_instance.myweb_server2[0].ami\n}\n\n# \u8f93\u51fa\u6240\u6709 EC2 ips\noutput \"instance_publicip\" {\ndescription = \"EC2 ips\"\nvalue       = [for instance in aws_instance.myweb_server2 : instance.public_ip]\n}\n# \u8f93\u51fa\u6240\u6709 EC2 \u90e8\u7f72\u7684\u53ef\u7528\u533a\noutput \"instance_availability_zone\" {\nvalue = aws_instance.myweb_server2[*].availability_zone\n}\n# \u901a\u8fc7 map \u65b9\u5f0f\u8f93\u51fa\u5185\u7f51ip\noutput \"instance_privateip_map\" {\nvalue = { for instance in aws_instance.myweb_server2 : instance.id =&gt; instance.private_ip }\n}\n# \u901a\u8fc7 map \u65b9\u5f0f\u8f93\u51fa EC2 TagName\noutput \"instance_tagName\" {\nvalue = { for instance in aws_instance.myweb_server2 : instance.id =&gt; lookup(instance.tags, \"Name\") }\n}\n\n# \u6700\u540e\u8f93\u51fa\u7684\u6837\u5f0f\u5982\u4e0b:\n# instance_ami = \"ami-0204e434dddffa5cf\"\n# instance_availability_zone = [\n#   \"ap-northeast-1c\",\n#   \"ap-northeast-1c\",\n#   \"ap-northeast-1c\",\n# ]\n# instance_instance_type = \"t2.micro\"\n# instance_privateip_map = {\n#   \"i-03c0f40ee9e65b268\" = \"172.31.5.141\"\n#   \"i-0b4b99fa322384d4e\" = \"172.31.14.184\"\n#   \"i-0f4535c49c555b4c2\" = \"172.31.14.125\"\n# }\n# instance_publicip = [\n#   \"18.183.163.231\",\n#   \"3.115.19.20\",\n#   \"35.78.86.26\",\n# ]\n# instance_tagName = {\n#   \"i-03c0f40ee9e65b268\" = \"learnaws-tf-ec2-0\"\n#   \"i-0b4b99fa322384d4e\" = \"learnaws-tf-ec2-2\"\n#   \"i-0f4535c49c555b4c2\" = \"learnaws-tf-ec2-1\"\n# }\n</code></pre> <p>EC2\u8d44\u6e90\u5c5e\u6027\u53c2\u7167</p> <p>https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance</p>"},{"location":"15%E3%80%81%E5%90%8C%E6%97%B6%E5%90%AF%E5%8A%A8%E5%A4%9A%E5%8F%B0%20EC2%20%E5%AE%9E%E4%BE%8B/#_6","title":"\u8fd0\u884c\u6a21\u7248\u786e\u8ba4\u52a8\u4f5c","text":"<pre><code># \u76ee\u5f55\u521d\u59cb\u5316\n$ terraform init\n# \u68c0\u9a8c tf \u6587\u4ef6\n$ terraform validate\n# \u5b9e\u65bd\u8ba1\u5212, \u51c6\u5907\u8d44\u6e90\n$ terraform plan\n# \u5e94\u7528\u90e8\u7f72\n$ terraform apply\n$ terraform apply -auto-approve\n# \u6467\u6bc1\u7cfb\u7edf\n$ terraform destroy\n$ terraform destroy -auto-approve\n</code></pre>"},{"location":"16%E3%80%81%E6%9F%A5%E8%AF%A2%E5%8F%AF%E7%94%A8%E5%8C%BA%E6%95%B0%E6%8D%AE%E6%BA%90%2C%20%E5%88%86%E5%88%AB%E5%90%AF%E5%8A%A8%20EC2/","title":"\u67e5\u8be2\u53ef\u7528\u533a\u6570\u636e\u6e90, \u5206\u522b\u542f\u52a8 EC2","text":""},{"location":"16%E3%80%81%E6%9F%A5%E8%AF%A2%E5%8F%AF%E7%94%A8%E5%8C%BA%E6%95%B0%E6%8D%AE%E6%BA%90%2C%20%E5%88%86%E5%88%AB%E5%90%AF%E5%8A%A8%20EC2/#_1","title":"\u77e5\u8bc6\u70b9","text":"<ul> <li>\u5efa\u7acb\u53ef\u7528\u533a\u6570\u636e\u6e90, \u4e3a\u6bcf\u4e2a\u53ef\u7528\u533a\u542f\u7528\u4e00\u4e2a EC2</li> </ul>"},{"location":"16%E3%80%81%E6%9F%A5%E8%AF%A2%E5%8F%AF%E7%94%A8%E5%8C%BA%E6%95%B0%E6%8D%AE%E6%BA%90%2C%20%E5%88%86%E5%88%AB%E5%90%AF%E5%8A%A8%20EC2/#_2","title":"\u5b98\u7f51","text":"<p>https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/availability_zones</p>"},{"location":"16%E3%80%81%E6%9F%A5%E8%AF%A2%E5%8F%AF%E7%94%A8%E5%8C%BA%E6%95%B0%E6%8D%AE%E6%BA%90%2C%20%E5%88%86%E5%88%AB%E5%90%AF%E5%8A%A8%20EC2/#_3","title":"\u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3","text":"<ul> <li>\u5efa\u7acb\u53ef\u7528\u533a\u6570\u636e\u6e90</li> <li>\u5728 EC2 \u8d44\u6e90\u63cf\u8ff0\u4e2d\u5e94\u7528\u53ef\u7528\u533a\u6570\u636e\u6e90</li> <li>\u8fd0\u884c\u6a21\u7248\u786e\u8ba4\u52a8\u4f5c</li> </ul>"},{"location":"16%E3%80%81%E6%9F%A5%E8%AF%A2%E5%8F%AF%E7%94%A8%E5%8C%BA%E6%95%B0%E6%8D%AE%E6%BA%90%2C%20%E5%88%86%E5%88%AB%E5%90%AF%E5%8A%A8%20EC2/#_4","title":"\u64cd\u4f5c\u6b65\u9aa4","text":""},{"location":"16%E3%80%81%E6%9F%A5%E8%AF%A2%E5%8F%AF%E7%94%A8%E5%8C%BA%E6%95%B0%E6%8D%AE%E6%BA%90%2C%20%E5%88%86%E5%88%AB%E5%90%AF%E5%8A%A8%20EC2/#_5","title":"\u5efa\u7acb\u53ef\u7528\u533a\u6570\u636e\u6e90","text":"<p>ec2-aws_availability_zones.tf</p> <pre><code># \u53d6\u5f97\u5df2\u542f\u7528\u7684\u53ef\u7528\u533a\u8d44\u6e90\ndata \"aws_availability_zones\" \"deeplearnaws_azones\" {\nfilter {\n# \u533a\u57df\u72b6\u6001\nname   = \"opt-in-status\"\n# opt-in-not-required: \u5df2\u542f\u7528\u533a\u57df\n# not-opted-in:        \u672a\u542f\u7528\u533a\u57df\n# opted-in:            \u542f\u7528\u9009\u62e9\u52a0\u5165\u7684\u533a\u57df\nvalues = [\"opt-in-not-required\"]\n}\n}\n</code></pre> <p>\u7ba1\u7406 AWS \u533a\u57df - \u53c2\u7167\u7f51\u9875</p> <p>https://docs.aws.amazon.com/zh_cn/general/latest/gr/rande-manage.html</p> <pre><code>$ aws ec2 describe-regions \\\n--all-regions \\\n--query \"Regions[].[RegionName, OptInStatus]\" \\\n--output table \\\n--profile deeplearnaws \\\n--region ap-northeast-1\n</code></pre>"},{"location":"16%E3%80%81%E6%9F%A5%E8%AF%A2%E5%8F%AF%E7%94%A8%E5%8C%BA%E6%95%B0%E6%8D%AE%E6%BA%90%2C%20%E5%88%86%E5%88%AB%E5%90%AF%E5%8A%A8%20EC2/#_6","title":"\u8f93\u51fa\u53ef\u7528\u533a\u4e00\u89c8","text":"<p>ec2-outputs.tf</p> <pre><code>output \"deeplearnaws_azones\" {\n# \u8f93\u51fa\u53ef\u7528\u533a\u4e00\u89c8\nvalue = data.aws_availability_zones.deeplearnaws_azones.names\n}\n\n$ terraform plan\n</code></pre>"},{"location":"16%E3%80%81%E6%9F%A5%E8%AF%A2%E5%8F%AF%E7%94%A8%E5%8C%BA%E6%95%B0%E6%8D%AE%E6%BA%90%2C%20%E5%88%86%E5%88%AB%E5%90%AF%E5%8A%A8%20EC2/#ec2_1","title":"\u5728 EC2 \u8d44\u6e90\u63cf\u8ff0\u4e2d\u5e94\u7528\u53ef\u7528\u533a\u6570\u636e\u6e90","text":"<p>ec2.tf</p> <pre><code>###########################################################\n# EC2 \u8d44\u6e90\u8bbe\u7f6e\nresource \"aws_instance\" \"myweb_server2\" {\nami                    = data.aws_ami.komaami.id\n  instance_type          = var.instance_type_env[\"dev\"]\nvpc_security_group_ids = [aws_security_group.deeplearnaws-sg-web-ssh.id]\n\n# \u5faa\u73af\u53ef\u7528\u533a\u6570\u636e\u6e90\nfor_each          = toset(data.aws_availability_zones.deeplearnaws_azones.names)\n# \u53d6\u5f97\u6570\u636e\u6e90\u8d4b\u4e88\u53ef\u7528\u533a\u5c5e\u6027\navailability_zone = each.key\n  tags = {\n# \u8d4b\u4e88 tagName \u6807\u7b7e\n\"Name\" = \"deeplearnaws-tf-ec2-${each.key}\"\n}\n}\n</code></pre>"},{"location":"16%E3%80%81%E6%9F%A5%E8%AF%A2%E5%8F%AF%E7%94%A8%E5%8C%BA%E6%95%B0%E6%8D%AE%E6%BA%90%2C%20%E5%88%86%E5%88%AB%E5%90%AF%E5%8A%A8%20EC2/#_7","title":"\u8fd0\u884c\u6a21\u7248\u786e\u8ba4\u52a8\u4f5c","text":"<pre><code># \u76ee\u5f55\u521d\u59cb\u5316\n$ terraform init\n# \u68c0\u9a8c tf \u6587\u4ef6\n$ terraform validate\n# \u5b9e\u65bd\u8ba1\u5212, \u51c6\u5907\u8d44\u6e90\n$ terraform plan\n# \u5e94\u7528\u90e8\u7f72\n$ terraform apply\n$ terraform apply -auto-approve\n# \u6467\u6bc1\u7cfb\u7edf\n$ terraform destroy\n$ terraform destroy -auto-approve\n</code></pre>"},{"location":"1%E3%80%81%E7%AE%80%E4%BB%8B/","title":"Terraform \u4e91\u5e73\u53f0\u7ba1\u7406\u5de5\u5177","text":"<p>\u4f7f\u7528\u7edf\u4e00\u7684\u4e91\u5e73\u53f0\u7ba1\u7406\u5de5\u5177\uff0c\u5b9e\u73b0\u6211\u4eec\u7684\u7406\u5ff5\uff0c\u5373\uff1a \u57fa\u7840\u8bbe\u65bd\u5373\u4ee3\u7801(IaC)</p>"},{"location":"1%E3%80%81%E7%AE%80%E4%BB%8B/#_1","title":"\u652f\u6301\u5e73\u53f0","text":""},{"location":"1%E3%80%81%E7%AE%80%E4%BB%8B/#_2","title":"\u4e09\u5927\u4e91\u5e73\u53f0","text":"<ul> <li>Amazon Web Services</li> <li>Microsoft Azure</li> <li>Google Cloud Platform</li> </ul>"},{"location":"1%E3%80%81%E7%AE%80%E4%BB%8B/#_3","title":"\u66f4\u591a\u7684\u5e73\u53f0","text":"<p>https://registry.terraform.io/browse/providers</p>"},{"location":"1%E3%80%81%E7%AE%80%E4%BB%8B/#_4","title":"\u5b98\u7f51","text":"<p>https://www.terraform.io/</p>"},{"location":"2%E3%80%81%E5%AE%89%E8%A3%85%E5%8F%8AAWS%E6%8E%88%E6%9D%83/","title":"\u4e00\u3001Terraform CLI \u5de5\u5177\u7684\u5b89\u88c5","text":""},{"location":"2%E3%80%81%E5%AE%89%E8%A3%85%E5%8F%8AAWS%E6%8E%88%E6%9D%83/#_1","title":"\u77e5\u8bc6\u70b9","text":"<ul> <li>Terraform CLI \u5de5\u5177\u7684\u5b89\u88c5 - @macOS @Linux</li> </ul>"},{"location":"2%E3%80%81%E5%AE%89%E8%A3%85%E5%8F%8AAWS%E6%8E%88%E6%9D%83/#_2","title":"\u5b98\u7f51","text":"<p>https://www.terraform.io/downloads</p>"},{"location":"2%E3%80%81%E5%AE%89%E8%A3%85%E5%8F%8AAWS%E6%8E%88%E6%9D%83/#_3","title":"\u64cd\u4f5c\u6b65\u9aa4","text":""},{"location":"2%E3%80%81%E5%AE%89%E8%A3%85%E5%8F%8AAWS%E6%8E%88%E6%9D%83/#_4","title":"\u4ece\u5b98\u7f51\u4e0b\u8f7d\u5b89\u88c5","text":"<p>https://releases.hashicorp.com/terraform/</p> <p>\u8fd9\u91cc\u9009\u62e9\uff1a<code>terraform_1.3.8_darwin_amd64.zip</code></p> <pre><code>$ unzip terraform_x.xx.x_darwin_amd64.zip\n$ mv terraform /usr/local/bin\n</code></pre>"},{"location":"2%E3%80%81%E5%AE%89%E8%A3%85%E5%8F%8AAWS%E6%8E%88%E6%9D%83/#macos-terraform-cli","title":"\u5728 macOS \u4e0a\u5b89\u88c5 Terraform CLI \u547d\u4ee4\u884c\u5de5\u5177","text":"<p>https://learn.hashicorp.com/tutorials/terraform/install-cli?in=terraform/aws-get-started</p> <pre><code>#######################################\n# \u4f7f\u7528 Homebrew \u5b89\u88c5 Terraform CLI\n$ brew tap hashicorp/tap                                # \u6ce8\u518chashicorp\u4fe1\u606f\u5e93\n$ brew install hashicorp/tap/terraform  # \u5b89\u88c5terraform\n# \u786e\u8ba4\u5b89\u88c5\n$ terraform -help\n$ terraform version\n# \u5404\u79cd\u5b50\u547d\u4ee4\u786e\u8ba4\n$ terraform -help init                                  # \u521d\u59cb\u5316\n$ terraform -help validate                          # \u9a8c\u8bc1Terraform\u914d\u7f6e\u6587\u4ef6\u7684\u8bed\u6cd5\u662f\u5426\u6b63\u786e\n$ terraform -help plan                                  # \n$ terraform -help apply\n$ terraform -help destroy\n\n#######################################\n# Homebrew \u672c\u4f53\u66f4\u65b0\n$ brew update\n# \u66f4\u65b0 Terraform CLI\n$ brew upgrade hashicorp/tap/terraform\n\n#######################################\n# Tab \u81ea\u52a8\u5b8c\u6210(\u53ef\u9009\u5b89\u88c5, \u6709\u5b89\u5168\u9690\u60a3, \u53ef\u8df3\u8fc7)\n## Bash \u7684\u573a\u5408\n# $ touch ~/.bashrc\n## Zsh  \u7684\u573a\u5408\n$ touch ~/.zshrc\n# \u5b89\u88c5 Terraform \u81ea\u52a8\u5b8c\u6210\u5305\n$ terraform -install-autocomplete\n</code></pre> <p>macos\u7cfb\u7edf\u7684Homebrew\u5305\u7ba1\u7406\u5de5\u5177\u5b98\u7f51</p>"},{"location":"2%E3%80%81%E5%AE%89%E8%A3%85%E5%8F%8AAWS%E6%8E%88%E6%9D%83/#linux-terraform-cli","title":"\u5728 Linux \u4e0a\u5b89\u88c5 Terraform CLI \u547d\u4ee4\u884c\u5de5\u5177","text":"<pre><code># \u5b89\u88c5 yum \u7ba1\u7406\u5de5\u5177 - yum-config-manager\n$ sudo yum install -y yum-utils\n# \u6ce8\u518c HashiCorp \u4fe1\u606f\u5e93\n$ sudo yum-config-manager --add-repo https://rpm.releases.hashicorp.com/AmazonLinux/hashicorp.repo\n# \u5b89\u88c5 terraform\n$ sudo yum -y install terraform\n# \u786e\u8ba4\u5b89\u88c5\n$ terraform -help\n$ terraform version\n</code></pre>"},{"location":"2%E3%80%81%E5%AE%89%E8%A3%85%E5%8F%8AAWS%E6%8E%88%E6%9D%83/#aws-cli","title":"\u4e8c\u3001AWS CLI \u547d\u4ee4\u884c\u5de5\u5177\u5b89\u88c5\u53ca\u8bbe\u7f6e","text":""},{"location":"2%E3%80%81%E5%AE%89%E8%A3%85%E5%8F%8AAWS%E6%8E%88%E6%9D%83/#_5","title":"\u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3","text":"<ul> <li>\u5b89\u88c5 AWS CLI \u547d\u4ee4\u884c\u5de5\u5177</li> <li>\u8bbe\u7f6e\u6388\u6743\uff08\u65b9\u5f0f\u4e00\uff09 - \u672c\u5730\u6388\u6743</li> <li>\u8bbe\u7f6e\u6388\u6743\uff08\u65b9\u5f0f\u4e8c\uff09 - EC2 \u89d2\u8272\u6388\u6743</li> </ul>"},{"location":"2%E3%80%81%E5%AE%89%E8%A3%85%E5%8F%8AAWS%E6%8E%88%E6%9D%83/#_6","title":"\u64cd\u4f5c\u6b65\u9aa4","text":""},{"location":"2%E3%80%81%E5%AE%89%E8%A3%85%E5%8F%8AAWS%E6%8E%88%E6%9D%83/#aws-cli_1","title":"\u5b89\u88c5 AWS CLI \u547d\u4ee4\u884c\u5de5\u5177","text":"<p>https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/install-cliv2.html</p> <ul> <li>Docker</li> <li>Linux</li> <li>macOS</li> <li>Windows</li> </ul> <pre><code># \u7248\u672c\u786e\u8ba4\n$ aws --version\n# \u786e\u8ba4\u672c\u5730\u6388\u6743\u6587\u4ef6\n$ cat ~/.aws/credentials\n</code></pre>"},{"location":"2%E3%80%81%E5%AE%89%E8%A3%85%E5%8F%8AAWS%E6%8E%88%E6%9D%83/#-","title":"\u8bbe\u7f6e\u6388\u6743\uff08\u65b9\u5f0f\u4e00\uff09 - \u672c\u5730\u6388\u6743","text":"<ul> <li> <p>\u767b\u9646AWS console\uff0c\u8fdb\u5165\u201cIAM\u201d\u9875\u9762\uff0c\u70b9\u51fb \u201c\u7528\u6237\u201d \uff0c\u6dfb\u52a0\u201c\u7528\u6237\u201d\u5e76\u8bbe\u7f6e\u52fe\u9009\u8bbf\u95ee\u7c7b\u578b\u201c\u7f16\u7a0b\u8bbf\u95ee\u201d</p> </li> <li> <p>\u8bbe\u7f6e\u76f8\u5e94\u6743\u9650</p> </li> <li> <p>\u521b\u5efa\u7528\u6237\uff0c\u5e76\u4fdd\u5b58\u8bbf\u95ee\u5bc6\u94a5\u5bf9\uff08\u6ce8\u610f\u53ea\u663e\u793a\u4e00\u6b21\uff09</p> </li> <li> <p>\u6388\u6743CLI\u8eab\u4efd</p> </li> </ul> <pre><code># \u6388\u6743CLI\u8eab\u4efd(\u6307\u5b9aprofile\u65b9\u5f0f - AWS Best Practices)\n$ aws configure --profile learnaws\n&gt;AWS Access Key ID [None]: FFUff89898u89vxv\nAWS Secret Access Key [None]: Ahy789yvhjxlFDoajsdflajia90sdfjsaa\n&gt;Default region name [None]: ap-northeast-1\nDefault output format [None]: json\n# \u6388\u6743\u8eab\u4efd\u5b58\u50a8\u4f4d\u7f6e(******\u5185\u5bb9\u6d89\u53ca\u654f\u611f\u4fe1\u606f******)\n$ ls ~/.aws\n# \u5217\u51fa\u6240\u6709\u914d\u7f6e\u6570\u636e\n$ aws configure list --profile learnaws\n# \u5217\u51fa\u53ef\u7528\u914d\u7f6e\u6587\u4ef6\u540d\u79f0\n$ aws configure list-profiles\n# \u5217\u51fa\u5f53\u524d\u533a\u7684VPC\n$ aws ec2 describe-vpcs --profile learnaws\n# \u67e5\u8be2\u8fc7\u6ee4\u663e\u793a\n$ aws ec2 describe-vpcs --profile learnaws --query 'Vpcs[].VpcId'\n# \u5217\u51faS3\u5b58\u50a8\u6876\n$ aws s3 ls --profile learnaws\n</code></pre> <pre><code># \u6b64\u547d\u4ee4\u6765\u9a8c\u8bc1\u60a8\u7684 AWS \u8bbf\u95ee\u5bc6\u94a5\u662f\u5426\u6b63\u786e\uff0c\u4ee5\u53ca\u60a8\u662f\u5426\u5df2\u83b7\u5f97\u5fc5\u8981\u7684 AWS \u8d44\u6e90\u8bbf\u95ee\u6743\u9650\u3002\u5982\u679c\u8be5\u547d\u4ee4\u8fd4\u56de\u60a8\u7684\u8eab\u4efd\u4fe1\u606f(\u8d26\u6237ID\u3001\u7528\u6237ID\u3001ARN)\uff0c\u8868\u793a\u60a8\u5df2\u901a\u8fc7\u8eab\u4efd\u9a8c\u8bc1\uff0c\u5e76\u4e14\u53ef\u4ee5\u5728 AWS \u4e0a\u6267\u884c\u5176\u4ed6\u64cd\u4f5c\u3002\u5982\u679c\u51fa\u73b0\u9519\u8bef\uff0c\u8bf4\u660e\u60a8\u7684\u8bbf\u95ee\u5bc6\u94a5\u65e0\u6548\u6216\u60a8\u6ca1\u6709\u5fc5\u8981\u7684 AWS \u8d44\u6e90\u8bbf\u95ee\u6743\u9650\u3002\n$ aws sts get-caller-identity\n</code></pre>"},{"location":"2%E3%80%81%E5%AE%89%E8%A3%85%E5%8F%8AAWS%E6%8E%88%E6%9D%83/#-ec2","title":"\u8bbe\u7f6e\u6388\u6743\uff08\u65b9\u5f0f\u4e8c\uff09 - \u7ed9EC2\u8fdb\u884c\u89d2\u8272\u6388\u6743","text":"<p>\u4f7f\u7528\u4e0b\u9762\u7684AWS CloudFormation \u6a21\u7248*awsNodeJSEC2.yml*\uff0c\u5df2\u7ecf\u8bbe\u7f6e\u597d EC2 \u6743\u9650</p> <pre><code>Parameters:\nMyKeyName:\nDescription: Name of EC2 KeyPair\nType: AWS::EC2::KeyPair::KeyName\nDefault: learn-aws-ssh-key\nConstraintDescription: must input\n\nResources:\nawsNodeJSEC2:\nType: AWS::EC2::Instance\nProperties:\nKeyName: !Ref MyKeyName\nAvailabilityZone:\n{ \"Fn::Select\": [\"0\", { \"Fn::GetAZs\": { \"Ref\": \"AWS::Region\" } }] }\nImageId: ami-0218d08a1f9dac831\nInstanceType: t3.micro\nSecurityGroups:\n- !Ref awsNodeJSSSHWEBSG\nIamInstanceProfile: !Ref awsNodeJSMyInstanceProfile\nBlockDeviceMappings:\n- DeviceName: /dev/xvda\nEbs:\nVolumeType: gp2\nVolumeSize: 8\nDeleteOnTermination: true\nEncrypted: false\nUserData:\nFn::Base64: |\n#!/bin/bash\nyum update -y\ntimedatectl set-timezone \"Asia/Tokyo\"\nlocalectl set-locale LANG=ja_JP.UTF-8          \ntouch /home/ec2-user/.hushlogin\nchown ec2-user:ec2-user /home/ec2-user/.hushlogin\n\ncurl \"https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip\" -o \"/tmp/awscliv2.zip\"\nunzip /tmp/awscliv2.zip  -d /tmp/awscliv2/\n/tmp/awscliv2/aws/install\n\ncurl -sL https://rpm.nodesource.com/setup_14.x | bash -\nyum install -y gcc-c++ make\nyum install -y nodejs\n\nawsNodeJSSSHWEBSG:\nType: AWS::EC2::SecurityGroup\nProperties:\nGroupDescription: SSH and Web PORT\nSecurityGroupIngress:\n- IpProtocol: tcp\nFromPort: 22\nToPort: 22\nCidrIp: 0.0.0.0/0\n- IpProtocol: tcp\nFromPort: 80\nToPort: 80\nCidrIp: 0.0.0.0/0\n\nawsNodeJSAccessRole:\nType: \"AWS::IAM::Role\"\nProperties:\nAssumeRolePolicyDocument:\nVersion: \"2012-10-17\"\nStatement:\n- Effect: \"Allow\"\nPrincipal:\nService:\n- \"ec2.amazonaws.com\"\nAction:\n- \"sts:AssumeRole\"\nPath: \"/\"\nManagedPolicyArns:\n- arn:aws:iam::aws:policy/AdministratorAccess\n\nawsNodeJSMyInstanceProfile:\nType: \"AWS::IAM::InstanceProfile\"\nProperties:\nPath: \"/\"\nRoles:\n- !Ref awsNodeJSAccessRole\n\nawsNodeJSEIP:\nType: AWS::EC2::EIP\nProperties:\nInstanceId: !Ref awsNodeJSEC2\n</code></pre>"},{"location":"2%E3%80%81%E5%AE%89%E8%A3%85%E5%8F%8AAWS%E6%8E%88%E6%9D%83/#vscode","title":"\u4e09\u3001VSCode \u63d2\u4ef6\u5b89\u88c5","text":"<p>\u5728 VSCode \u4e2d\u5b89\u88c5 Terraform \u63d2\u4ef6</p>"},{"location":"2%E3%80%81%E5%AE%89%E8%A3%85%E5%8F%8AAWS%E6%8E%88%E6%9D%83/#_7","title":"\u5b98\u7f51","text":"<p>https://marketplace.visualstudio.com/items?itemName=HashiCorp.terraform</p>"},{"location":"2%E3%80%81%E5%AE%89%E8%A3%85%E5%8F%8AAWS%E6%8E%88%E6%9D%83/#_8","title":"\u64cd\u4f5c\u6b65\u9aa4","text":""},{"location":"2%E3%80%81%E5%AE%89%E8%A3%85%E5%8F%8AAWS%E6%8E%88%E6%9D%83/#vscode-terraform","title":"\u5728 VSCode \u4e2d\u5b89\u88c5 Terraform \u63d2\u4ef6","text":"<p>\u5728 VSCode \u4e2d\u641c\u7d22\u6269\u5c55 HashiCorp Terraform\uff0c \u7136\u540e\u5b89\u88c5\u3002</p>"},{"location":"3%E3%80%81Terraform%20%E5%B7%A5%E4%BD%9C%E6%B5%81/","title":"Terraform \u5de5\u4f5c\u6d41","text":""},{"location":"3%E3%80%81Terraform%20%E5%B7%A5%E4%BD%9C%E6%B5%81/#_1","title":"\u5b98\u7f51","text":"<p>https://www.terraform.io/intro/core-workflow</p>"},{"location":"3%E3%80%81Terraform%20%E5%B7%A5%E4%BD%9C%E6%B5%81/#_2","title":"\u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3","text":"<p>\u770b\u56fe\u8bf4\u8bdd</p> <p></p> <ul> <li>\u521d\u59cb\u5316 - init</li> <li>\u6821\u9a8c\u6587\u4ef6 - validate</li> <li>\u8ba1\u5212\u5b9e\u65bd - plan</li> <li>\u5e94\u7528\u90e8\u7f72 - apply</li> <li>\u6467\u6bc1\u7cfb\u7edf - destroy</li> </ul>"},{"location":"3%E3%80%81Terraform%20%E5%B7%A5%E4%BD%9C%E6%B5%81/#_3","title":"\u64cd\u4f5c\u6b65\u9aa4","text":""},{"location":"3%E3%80%81Terraform%20%E5%B7%A5%E4%BD%9C%E6%B5%81/#-init","title":"\u521d\u59cb\u5316 - init","text":"<pre><code>$ terraform init\n</code></pre> <ul> <li>\u521d\u59cb\u5316\u5de5\u4f5c\u6587\u4ef6\u5939</li> <li>\u51c6\u5907\u63d0\u4f9b\u5546\u7ec4\u4ef6</li> </ul>"},{"location":"3%E3%80%81Terraform%20%E5%B7%A5%E4%BD%9C%E6%B5%81/#-validate","title":"\u6821\u9a8c\u6587\u4ef6 - validate","text":"<pre><code>$ terraform validate\n</code></pre> <ul> <li>\u7f16\u8bd1\u6821\u9a8c\u672c\u5730\u90e8\u7f72\u6587\u4ef6\uff0c \u786e\u4fdd\u6b63\u786e\u65e0\u8bef</li> </ul>"},{"location":"3%E3%80%81Terraform%20%E5%B7%A5%E4%BD%9C%E6%B5%81/#-plan","title":"\u8ba1\u5212\u5b9e\u65bd - plan","text":"<pre><code>$ terraform plan\n</code></pre> <ul> <li>\u6839\u636e\u672c\u5730\u90e8\u7f72\u6587\u4ef6\uff0c \u6839\u636e\u4e0d\u540c\u7684\u4e91\u63d0\u4f9b\u5546\uff0c \u5efa\u7acb\u4e0d\u540c\u7684\u90e8\u7f72\u5b9e\u65bd\u8ba1\u5212</li> </ul>"},{"location":"3%E3%80%81Terraform%20%E5%B7%A5%E4%BD%9C%E6%B5%81/#-apply","title":"\u5e94\u7528\u90e8\u7f72 - apply","text":"<pre><code>$ terraform apply\n</code></pre> <ul> <li>\u5e94\u7528\u90e8\u7f72\u5230\u5404\u4e2a\u4e91\u5e73\u53f0</li> </ul>"},{"location":"3%E3%80%81Terraform%20%E5%B7%A5%E4%BD%9C%E6%B5%81/#-destroy","title":"\u6467\u6bc1\u7cfb\u7edf - destroy","text":"<pre><code>$ terraform destroy\n</code></pre> <ul> <li>\u7cfb\u7edf\u5468\u671f\u5b8c\u6210\u65f6\uff0c \u6467\u6bc1\u7cfb\u7edf</li> </ul>"},{"location":"4%E3%80%81%E5%BF%AB%E9%80%9F%E5%BB%BA%E7%AB%8B%E7%AC%AC%E4%B8%80%E4%B8%AA%20EC2%20%E5%AE%9E%E4%BE%8B%20-%20%E6%9C%AC%E5%9C%B0%E6%8E%88%E6%9D%83%E6%96%B9%E5%BC%8F/","title":"\u5feb\u901f\u5efa\u7acb\u7b2c\u4e00\u4e2a EC2 \u5b9e\u4f8b - \u672c\u5730\u6388\u6743\u65b9\u5f0f","text":""},{"location":"4%E3%80%81%E5%BF%AB%E9%80%9F%E5%BB%BA%E7%AB%8B%E7%AC%AC%E4%B8%80%E4%B8%AA%20EC2%20%E5%AE%9E%E4%BE%8B%20-%20%E6%9C%AC%E5%9C%B0%E6%8E%88%E6%9D%83%E6%96%B9%E5%BC%8F/#_1","title":"\u77e5\u8bc6\u70b9","text":"<ul> <li>\u4f7f\u7528 Terraform \u5feb\u901f\u5efa\u7acb\u7b2c\u4e00\u4e2a EC2 \u5b9e\u4f8b</li> </ul>"},{"location":"4%E3%80%81%E5%BF%AB%E9%80%9F%E5%BB%BA%E7%AB%8B%E7%AC%AC%E4%B8%80%E4%B8%AA%20EC2%20%E5%AE%9E%E4%BE%8B%20-%20%E6%9C%AC%E5%9C%B0%E6%8E%88%E6%9D%83%E6%96%B9%E5%BC%8F/#_2","title":"\u5b98\u7f51","text":"<p>https://registry.terraform.io/</p> <ul> <li>Terraform Registry\u662fTerraform\u7684\u6ce8\u518c\u673a\uff0c\u76f8\u5f53\u4e8ejava\u7684maven\u3001Nodejs\u7684NPMjs\uff0c\u8fd9\u91cc\u96c6\u6210\u4e86\u6240\u4ee5Terraform\u7684\u4e2d\u95f4\u4ef6\uff0c\u4e3b\u8981\u5206\u4e3a\u4e24\u4e2a\u7c7b\u578b\uff1a</li> <li>Providers\uff1a\u63d0\u4f9b\u5668\uff0c\u51e0\u4e4e\u662f\u5b98\u65b9\u7ef4\u62a4\u3002\u4f8b\u5982\u8981\u5efa\u7acbAWS\u57fa\u4e8eTerraform\u7684\u5e73\u53f0\uff0c\u5c31\u9700\u8981AWS\u7684\u63d0\u4f9b\u5668\u6765\u652f\u6301\u540e\u7aef\u7684\u4e91\u5e73\u53f0\u3002</li> <li>Modules\uff1a\u6a21\u5757\uff0c\u51e0\u4e4e\u662f\u4e2a\u4eba\u6216\u7ec4\u7ec7\u7ef4\u62a4\u3002\u6709\u4e86\u4e0a\u9762\u5f88\u591a\u7684\u63d0\u4f9b\u5668\uff0c\u60f3\u9ad8\u6548\u7684\u4f7f\u7528\u5c31\u9700\u8981\u7528\u5230\u6a21\u5757\u3002</li> </ul>"},{"location":"4%E3%80%81%E5%BF%AB%E9%80%9F%E5%BB%BA%E7%AB%8B%E7%AC%AC%E4%B8%80%E4%B8%AA%20EC2%20%E5%AE%9E%E4%BE%8B%20-%20%E6%9C%AC%E5%9C%B0%E6%8E%88%E6%9D%83%E6%96%B9%E5%BC%8F/#_3","title":"\u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3","text":"<ul> <li>\u5efa\u7acb\u672c\u5730 Terraform \u6587\u4ef6, (\u7b80\u79f0 tf \u6587\u4ef6)</li> <li>\u9075\u5faa Terraform \u5de5\u4f5c\u6d41\u7a0b\u5b8c\u6210\u8d44\u6e90\u90e8\u7f72 - init\u3001validate\u3001plan\u3001apply\u3001destroy</li> <li>\u52a8\u4f5c\u786e\u8ba4</li> </ul>"},{"location":"4%E3%80%81%E5%BF%AB%E9%80%9F%E5%BB%BA%E7%AB%8B%E7%AC%AC%E4%B8%80%E4%B8%AA%20EC2%20%E5%AE%9E%E4%BE%8B%20-%20%E6%9C%AC%E5%9C%B0%E6%8E%88%E6%9D%83%E6%96%B9%E5%BC%8F/#_4","title":"\u64cd\u4f5c\u6b65\u9aa4","text":""},{"location":"4%E3%80%81%E5%BF%AB%E9%80%9F%E5%BB%BA%E7%AB%8B%E7%AC%AC%E4%B8%80%E4%B8%AA%20EC2%20%E5%AE%9E%E4%BE%8B%20-%20%E6%9C%AC%E5%9C%B0%E6%8E%88%E6%9D%83%E6%96%B9%E5%BC%8F/#terraform-tf","title":"\u5efa\u7acb\u672c\u5730 Terraform \u6587\u4ef6, (\u7b80\u79f0 tf \u6587\u4ef6)","text":"<pre><code>$ mkdir awstf\n$ cd awstf\n$ vim main.tf\n</code></pre> <p>main.tf</p> <pre><code>###########################################################\n# Terraform \u57fa\u672c\u8bbe\u7f6e\nterraform {\n# \u58f0\u660eprovider\nrequired_providers {\n# https://registry.terraform.io/browse/providers\naws = {\nsource  = \"hashicorp/aws\"\nversion = \"~&gt; 3.74\"\n}\n}\n# \u58f0\u660eTerraform\u7248\u672c\nrequired_version = \"&gt;= 1.1.4\"\n}\n\n###########################################################\n# \u63d0\u4f9b\u5546\u8bbe\u7f6e(\u4e91\u5e73\u53f0)\n# \u63cf\u8ff0AWS Provider\n# https://registry.terraform.io/providers/hashicorp/aws/latest\nprovider \"aws\" {\n# ~/.aws/credentials\u6587\u4ef6\u7684[name]\nprofile = \"learnaws\"\nregion  = \"ap-northeast-1\"\n}\n\n###########################################################\n# \u63cf\u8ff0\u8981\u751f\u6210\u7684\u8d44\u6e90\u8bbe\u7f6e\n# https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ami\n# https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance\nresource \"aws_instance\" \"myweb_server\" {\nami           = \"ami-0218d08a1f9dac831\"\ninstance_type = \"t3.micro\"\ntags = {\nName = \"learnaws-ec2-from-terraform\"\n}\n}\n</code></pre>"},{"location":"4%E3%80%81%E5%BF%AB%E9%80%9F%E5%BB%BA%E7%AB%8B%E7%AC%AC%E4%B8%80%E4%B8%AA%20EC2%20%E5%AE%9E%E4%BE%8B%20-%20%E6%9C%AC%E5%9C%B0%E6%8E%88%E6%9D%83%E6%96%B9%E5%BC%8F/#terraform","title":"\u9075\u5faa Terraform \u5de5\u4f5c\u6d41\u7a0b\u5b8c\u6210\u8d44\u6e90\u90e8\u7f72","text":"<pre><code># \u76ee\u5f55\u521d\u59cb\u5316\uff08\u4f1a\u73b0\u5728\u5fc5\u8981\u7684\u5b89\u88c5\u5305\u548cprovider\uff09\n$ terraform init\n# \u786e\u8ba4\u63d0\u4f9b\u5546\u7ba1\u7406\u6587\u4ef6, \u8be5\u6587\u4ef6\u8bb0\u5f55\u5177\u4f53\u7684\u63d0\u4f9b\u5546\u7248\u672c\u4fe1\u606f, \u5e94\u8be5\u5305\u542b\u5230\u6e90\u4ee3\u7801\u4fe1\u606f\u5e93\u4e2d\n$ ls -a\n$ cat .terraform.lock.hcl\n\n# \u68c0\u9a8c tf \u6587\u4ef6\n$ terraform validate\n\n# \u5b9e\u65bd\u8ba1\u5212, \u51c6\u5907\u8d44\u6e90\n$ terraform plan\n...\n&gt;Plan: 1 to add, 0 to change, 0 to destroy.\n\n# \u5e94\u7528\u90e8\u7f72\n$ terraform apply\n...\n&gt;Apply complete! Resources: 1 added, 0 changed, 0 destroyed.\n\n# \u6467\u6bc1\u7cfb\u7edf\uff0c\u5373\u628a\u5f53\u524dtf\u811a\u672c\u63cf\u8ff0\u7684\u6240\u6709\u8d44\u6e90\u5168\u90e8\u6467\u6bc1\n$ terraform destroy\n...\n&gt;Destroy complete! Resources: 1 destroyed.\n</code></pre>"},{"location":"4%E3%80%81%E5%BF%AB%E9%80%9F%E5%BB%BA%E7%AB%8B%E7%AC%AC%E4%B8%80%E4%B8%AA%20EC2%20%E5%AE%9E%E4%BE%8B%20-%20%E6%9C%AC%E5%9C%B0%E6%8E%88%E6%9D%83%E6%96%B9%E5%BC%8F/#_5","title":"\u52a8\u4f5c\u786e\u8ba4","text":"<p>Done.</p>"},{"location":"5%E3%80%81%E5%BF%AB%E9%80%9F%E5%BB%BA%E7%AB%8B%E7%AC%AC%E4%B8%80%E4%B8%AA%20EC2%20%E5%AE%9E%E4%BE%8B%20-%20EC2%E6%8E%88%E6%9D%83%E6%96%B9%E5%BC%8F.md/","title":"\u5feb\u901f\u5efa\u7acb\u7b2c\u4e00\u4e2a EC2 \u5b9e\u4f8b - EC2\u6388\u6743\u65b9\u5f0f","text":""},{"location":"5%E3%80%81%E5%BF%AB%E9%80%9F%E5%BB%BA%E7%AB%8B%E7%AC%AC%E4%B8%80%E4%B8%AA%20EC2%20%E5%AE%9E%E4%BE%8B%20-%20EC2%E6%8E%88%E6%9D%83%E6%96%B9%E5%BC%8F.md/#_1","title":"\u77e5\u8bc6\u70b9","text":"<ul> <li>\u4f7f\u7528 Terraform \u5728 Amazon Linux 2@EC2 \u4e0a\u5feb\u901f\u5efa\u7acb\u7b2c\u4e00\u4e2a EC2 \u5b9e\u4f8b</li> </ul>"},{"location":"5%E3%80%81%E5%BF%AB%E9%80%9F%E5%BB%BA%E7%AB%8B%E7%AC%AC%E4%B8%80%E4%B8%AA%20EC2%20%E5%AE%9E%E4%BE%8B%20-%20EC2%E6%8E%88%E6%9D%83%E6%96%B9%E5%BC%8F.md/#_2","title":"\u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3","text":"<ul> <li>\u51c6\u5907 tf \u6a21\u7248</li> <li>\u5728 EC2 \u4e0a\u6267\u884ctf\uff0c\u90e8\u7f72 EC2 \u5b9e\u4f8b</li> <li>\u52a8\u4f5c\u786e\u8ba4</li> </ul>"},{"location":"5%E3%80%81%E5%BF%AB%E9%80%9F%E5%BB%BA%E7%AB%8B%E7%AC%AC%E4%B8%80%E4%B8%AA%20EC2%20%E5%AE%9E%E4%BE%8B%20-%20EC2%E6%8E%88%E6%9D%83%E6%96%B9%E5%BC%8F.md/#_3","title":"\u64cd\u4f5c\u6b65\u9aa4","text":""},{"location":"5%E3%80%81%E5%BF%AB%E9%80%9F%E5%BB%BA%E7%AB%8B%E7%AC%AC%E4%B8%80%E4%B8%AA%20EC2%20%E5%AE%9E%E4%BE%8B%20-%20EC2%E6%8E%88%E6%9D%83%E6%96%B9%E5%BC%8F.md/#tf","title":"\u51c6\u5907 tf \u6a21\u7248","text":"<p>main.ts</p> <pre><code>###########################################################\n# Terraform \u57fa\u672c\u8bbe\u7f6e\nterraform {\nrequired_providers {\naws = {\nsource  = \"hashicorp/aws\"\nversion = \"~&gt; 3.74\"\n}\n}\nrequired_version = \"&gt;= 1.1.4\"\n}\n\n###########################################################\n# \u63d0\u4f9b\u5546\u8bbe\u7f6e(\u4e91\u5e73\u53f0)\nprovider \"aws\" {\n# \u8fd9\u91cc\u5199default\u5373\u53ef\uff0c\u56e0\u4e3a\u6211\u4eec\u7684EC2\u4e0a\u6ca1\u6709\u8bbe\u7f6eaws cli\uff0c\u800c\u662f\u7ed9\u8fd9\u53f0EC2\u8fdb\u884c\u4e86\u89d2\u8272\u6388\u6743\nprofile = \"default\"\nregion  = \"ap-northeast-1\"\n}\n\n###########################################################\n# \u751f\u6210\u7684\u8d44\u6e90\u8bbe\u7f6e\nresource \"aws_instance\" \"myweb_server\" {\nami           = \"ami-0218d08a1f9dac831\"\ninstance_type = \"t2.micro\"\n# \u589e\u52a0\u4e00\u4e2a KeyPair \u8bbe\u7f6e\nkey_name      = \"learnaws-ssh-key\"\ntags = {\nName = \"learnaws-ec2-from-terraform\"\n}\n}\n</code></pre>"},{"location":"5%E3%80%81%E5%BF%AB%E9%80%9F%E5%BB%BA%E7%AB%8B%E7%AC%AC%E4%B8%80%E4%B8%AA%20EC2%20%E5%AE%9E%E4%BE%8B%20-%20EC2%E6%8E%88%E6%9D%83%E6%96%B9%E5%BC%8F.md/#ec2-ec2_1","title":"\u5728 EC2 \u4e0a\u90e8\u7f72 EC2 \u5b9e\u4f8b","text":"<pre><code># \u76ee\u5f55\u521d\u59cb\u5316\n$ terraform init\n# \u68c0\u9a8c tf \u6587\u4ef6\n$ terraform validate\n# \u5b9e\u65bd\u8ba1\u5212, \u51c6\u5907\u8d44\u6e90\n$ terraform plan\n# \u5e94\u7528\u90e8\u7f72\n$ terraform apply\n# \u6467\u6bc1\u7cfb\u7edf\n$ terraform destroy\n</code></pre>"},{"location":"5%E3%80%81%E5%BF%AB%E9%80%9F%E5%BB%BA%E7%AB%8B%E7%AC%AC%E4%B8%80%E4%B8%AA%20EC2%20%E5%AE%9E%E4%BE%8B%20-%20EC2%E6%8E%88%E6%9D%83%E6%96%B9%E5%BC%8F.md/#_4","title":"\u52a8\u4f5c\u786e\u8ba4","text":"<p>Done.</p>"},{"location":"6%E3%80%81%E5%88%86%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86%20Terraform%20%E8%B5%84%E6%BA%90/","title":"\u5206\u6587\u4ef6\u7ba1\u7406\u8d44\u6e90","text":""},{"location":"6%E3%80%81%E5%88%86%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86%20Terraform%20%E8%B5%84%E6%BA%90/#_2","title":"\u77e5\u8bc6\u70b9","text":"<ul> <li>\u5206\u6587\u4ef6\u7ba1\u7406 Terraform \u8d44\u6e90</li> </ul>"},{"location":"6%E3%80%81%E5%88%86%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86%20Terraform%20%E8%B5%84%E6%BA%90/#_3","title":"\u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3","text":"<ul> <li>\u62c6\u5206 EC2 \u8d44\u6e90\u63cf\u8ff0\u6587\u4ef6</li> <li>\u90e8\u7f72\u786e\u8ba4</li> </ul>"},{"location":"6%E3%80%81%E5%88%86%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86%20Terraform%20%E8%B5%84%E6%BA%90/#_4","title":"\u64cd\u4f5c\u6b65\u9aa4","text":""},{"location":"6%E3%80%81%E5%88%86%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86%20Terraform%20%E8%B5%84%E6%BA%90/#maintf","title":"\u4fee\u6539main.tf\u6587\u4ef6\u4ec5\u4fdd\u7559\u57fa\u7840\u8bbe\u7f6e","text":"<p>main.tf</p> <pre><code>###########################################################\n# Terraform \u57fa\u672c\u8bbe\u7f6e\nterraform {\nrequired_providers {\naws = {\nsource  = \"hashicorp/aws\"\nversion = \"~&gt; 3.74\"\n}\n}\nrequired_version = \"&gt;= 1.1.4\"\n}\n\n###########################################################\n# \u63d0\u4f9b\u5546\u8bbe\u7f6e(\u4e91\u5e73\u53f0)\nprovider \"aws\" {\nprofile = \"learnaws\"\nregion  = \"ap-northeast-1\"\n}\n</code></pre>"},{"location":"6%E3%80%81%E5%88%86%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86%20Terraform%20%E8%B5%84%E6%BA%90/#ec2","title":"\u62c6\u5206 EC2 \u8d44\u6e90\u63cf\u8ff0\u6587\u4ef6","text":"<pre><code>$ vi ec2.tf\n</code></pre> <p>ec2.tf</p> <pre><code>###########################################################\n# EC2 \u8d44\u6e90\u8bbe\u7f6e\nresource \"aws_instance\" \"myweb_server2\" {\nami           = \"ami-0218d08a1f9dac831\"\ninstance_type = \"t3.micro\"\ntags = {\nName = \"learnaws-ec2-from-terraform2\"\n}\n}\n</code></pre>"},{"location":"6%E3%80%81%E5%88%86%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86%20Terraform%20%E8%B5%84%E6%BA%90/#_5","title":"\u90e8\u7f72\u786e\u8ba4","text":"<ul> <li>Terraform\u4f1a\u628a\u5f53\u524d\u5de5\u7a0b\u76ee\u5f55\u4e0b\u6240\u6709.tf\u6587\u4ef6\u90fd\u4f1a\u83b7\u53d6\uff0c\u4e0d\u5b58\u5728\u5165\u53e3\u6587\u4ef6\u4e00\u8bf4</li> </ul> <pre><code># \u76ee\u5f55\u521d\u59cb\u5316\n$ terraform init\n# \u68c0\u9a8c tf \u6587\u4ef6\n$ terraform validate\n# \u5b9e\u65bd\u8ba1\u5212, \u51c6\u5907\u8d44\u6e90\n$ terraform plan\n# \u5e94\u7528\u90e8\u7f72\n$ terraform apply\n# \u6467\u6bc1\u7cfb\u7edf\n$ terraform destroy\n</code></pre>"},{"location":"7%E3%80%81tf%E8%AE%BE%E7%BD%AEEC2%E8%B5%84%E6%BA%90%E7%9A%84%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE/","title":"\u4f7f\u7528 EC2 \u7528\u6237\u6570\u636e","text":""},{"location":"7%E3%80%81tf%E8%AE%BE%E7%BD%AEEC2%E8%B5%84%E6%BA%90%E7%9A%84%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE/#_1","title":"\u77e5\u8bc6\u70b9","text":"<ul> <li>\u542f\u52a8 EC2 \u65f6\u51c6\u5907\u7528\u6237\u6570\u636e</li> </ul>"},{"location":"7%E3%80%81tf%E8%AE%BE%E7%BD%AEEC2%E8%B5%84%E6%BA%90%E7%9A%84%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE/#_2","title":"\u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3","text":"<ul> <li>\u51c6\u5907\u7528\u6237\u6570\u636e\u6587\u4ef6</li> <li>\u4fee\u6539 EC2 \u8d44\u6e90\u914d\u7f6e\u6587\u4ef6</li> <li>\u90e8\u7f72\u786e\u8ba4</li> </ul>"},{"location":"7%E3%80%81tf%E8%AE%BE%E7%BD%AEEC2%E8%B5%84%E6%BA%90%E7%9A%84%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE/#_3","title":"\u64cd\u4f5c\u6b65\u9aa4","text":""},{"location":"7%E3%80%81tf%E8%AE%BE%E7%BD%AEEC2%E8%B5%84%E6%BA%90%E7%9A%84%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE/#_4","title":"\u76ee\u5f55\u7ed3\u6784","text":"<pre><code>.\n\u251c\u2500\u2500 ec2.tf\n\u251c\u2500\u2500 main.tf\n\u2514\u2500\u2500 ec2-userdata.sh\n</code></pre>"},{"location":"7%E3%80%81tf%E8%AE%BE%E7%BD%AEEC2%E8%B5%84%E6%BA%90%E7%9A%84%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE/#_5","title":"\u51c6\u5907\u7528\u6237\u6570\u636e\u6587\u4ef6","text":"<p>ec2-userdata.sh</p> <pre><code>#!/bin/bash\nyum update -y\n# \u8bbe\u7f6eec2\u533a\u57df\ntimedatectl set-timezone \"Asia/Tokyo\"\nlocalectl set-locale LANG=ja_JP.UTF-8\ntouch /home/ec2-user/.hushlogin\nchown ec2-user:ec2-user /home/ec2-user/.hushlogin\n# \u5b89\u88c5aws cli\u547d\u4ee4\u884c\u5de5\u5177\ncurl \"https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip\" -o \"/tmp/awscliv2.zip\"\nunzip /tmp/awscliv2.zip  -d /tmp/awscliv2/\n/tmp/awscliv2/aws/install\n# \u5b89\u88c5Nodejs\ncurl -sL https://rpm.nodesource.com/setup_14.x | bash -\nyum install -y gcc-c++ make\nyum install -y nodejs\n# \u5b89\u88c5Apache\u5f00\u542f80 http\u670d\u52a1\nyum install -y httpd\nsystemctl enable httpd\nservice httpd start  \nsudo echo '&lt;h1&gt;Terraform EC2.&lt;/h1&gt;' | sudo tee /var/www/html/index.html\n</code></pre>"},{"location":"7%E3%80%81tf%E8%AE%BE%E7%BD%AEEC2%E8%B5%84%E6%BA%90%E7%9A%84%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE/#ec2_1","title":"EC2 \u8d44\u6e90\u914d\u7f6e\u6587\u4ef6","text":"<p>ec2.tf</p> <pre><code>###########################################################\n# EC2 \u8d44\u6e90\u8bbe\u7f6e\nresource \"aws_instance\" \"myweb_server2\" {\nami           = \"ami-0218d08a1f9dac831\"\ninstance_type = \"t3.micro\"\n# \u7528\u6765ssh\u5bc6\u94a5\u767b\u9646\nkey_name      = \"learnaws-ssh-key\"\n# \u5f15\u7528ec2-userdata.sh\u811a\u672c\uff0c${path.module}\u662f\u5f53\u524d\u8def\u5f84\nuser_data     = file(\"${path.module}/ec2-userdata.sh\")\ntags = {\nName = \"learnaws-ec2-from-terraform2\"\n}\n}\n</code></pre>"},{"location":"7%E3%80%81tf%E8%AE%BE%E7%BD%AEEC2%E8%B5%84%E6%BA%90%E7%9A%84%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE/#_6","title":"\u9879\u76ee\u63cf\u8ff0\u6587\u4ef6","text":"<p>main.tf</p> <pre><code>###########################################################\n# Terraform \u57fa\u672c\u8bbe\u7f6e\nterraform {\nrequired_providers {\naws = {\nsource  = \"hashicorp/aws\"\nversion = \"~&gt; 3.74\"\n}\n}\nrequired_version = \"&gt;= 1.1.4\"\n}\n\n###########################################################\n# \u63d0\u4f9b\u5546\u8bbe\u7f6e(\u4e91\u5e73\u53f0)\nprovider \"aws\" {\nprofile = \"learnaws\"\nregion  = \"ap-northeast-1\"\n}\n</code></pre>"},{"location":"7%E3%80%81tf%E8%AE%BE%E7%BD%AEEC2%E8%B5%84%E6%BA%90%E7%9A%84%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE/#_7","title":"\u90e8\u7f72\u786e\u8ba4","text":"<pre><code># \u76ee\u5f55\u521d\u59cb\u5316\n$ terraform init\n# \u68c0\u9a8c tf \u6587\u4ef6\n$ terraform validate\n# \u5b9e\u65bd\u8ba1\u5212, \u51c6\u5907\u8d44\u6e90\n$ terraform plan\n# \u5e94\u7528\u90e8\u7f72\n$ terraform apply\n$ terraform apply -auto-approve # \u81ea\u52a8\u786e\u8ba4\uff0c\u4f1a\u81ea\u52a8\u8f93\u5165yes\n# \u6467\u6bc1\u7cfb\u7edf\n$ terraform destroy -auto-approve\n\n# \u8bbf\u95eeec2\u7684ip\uff0c\u7f51\u9875\u8f93\u51fa\u201cTerraform EC2.\u201d\u5373\u6210\u529f\n</code></pre>"},{"location":"8%E3%80%81%E7%8A%B6%E6%80%81%E6%96%87%E4%BB%B6%20-%20%22terraform.tfstate%22/","title":"\u72b6\u6001\u6587\u4ef6 - terraform.tfstate","text":""},{"location":"8%E3%80%81%E7%8A%B6%E6%80%81%E6%96%87%E4%BB%B6%20-%20%22terraform.tfstate%22/#_1","title":"\u77e5\u8bc6\u70b9","text":"<ul> <li>Terraform \u7684\u72b6\u6001\u6587\u4ef6 - terraform.tfstate</li> </ul>"},{"location":"8%E3%80%81%E7%8A%B6%E6%80%81%E6%96%87%E4%BB%B6%20-%20%22terraform.tfstate%22/#_2","title":"\u5b98\u7f51","text":"<p>https://www.terraform.io/language/state</p>"},{"location":"8%E3%80%81%E7%8A%B6%E6%80%81%E6%96%87%E4%BB%B6%20-%20%22terraform.tfstate%22/#_3","title":"\u8bf4\u660e\u8bb2\u89e3","text":""},{"location":"8%E3%80%81%E7%8A%B6%E6%80%81%E6%96%87%E4%BB%B6%20-%20%22terraform.tfstate%22/#tfstate","title":"tfstate \u662f\u4ec0\u4e48\uff1f","text":"<p>.tfstate \u6587\u4ef6\u662f Terraform \u7ba1\u7406\u73b0\u6709\u8d44\u6e90\u72b6\u6001\u7684\u6587\u4ef6\u3002</p>"},{"location":"8%E3%80%81%E7%8A%B6%E6%80%81%E6%96%87%E4%BB%B6%20-%20%22terraform.tfstate%22/#tfstate_1","title":"\u4e3a\u4ec0\u4e48\u8981\u6709 tfstate","text":"<p>\u6bcf\u5f53\u6267\u884c <code>terraform plan</code> \u7684\u65f6\u5019\uff0c Terraform \u90fd\u4f1a\u4e3a\u6211\u4eec\u6bd4\u8f83\u672c\u5730\u8d44\u6e90\u7684\u53d8\u5316\u548c\u670d\u52a1\u5668\u8d44\u6e90\u7684\u4e0d\u540c\u3002</p> <p>\u8fd9\u70b9\u548c CloudFormation \u4e0d\u4e00\u6837\uff0c CloudFormation \u662f\u5b58\u5728\u4e91\u7aef\u7684\u3002</p> <p>\u5927\u5bb6\u8bf7\u60f3\u4e00\u4e2a\u95ee\u9898, \u4e3a\u4ec0\u4e48\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 <code>terraform apply</code> \u5efa\u7acb\u51fa\u7684 EC2, \u9a6c\u4e0a\u53ef\u4ee5\u901a\u8fc7 <code>terraform destroy</code> \u8fdb\u884c\u9500\u6bc1\u5462\uff1f </p> <p>Terraform \u662f\u600e\u4e48\u77e5\u9053\u8be5\u9500\u6bc1\u54ea\u53f0 EC2 \u7684? \u4f1a\u4e0d\u4f1a\u5c06\u4e91\u4e2d\u7684\u5176\u4ed6 EC2 \u9500\u6bc1\u5462\uff1f </p> <p>\u5982\u679c\u6ca1\u6709\u72b6\u6001\u7ba1\u7406\uff0c \u8fd9\u5c31\u5f88\u5371\u9669\u3002</p>"},{"location":"8%E3%80%81%E7%8A%B6%E6%80%81%E6%96%87%E4%BB%B6%20-%20%22terraform.tfstate%22/#terraformtfstate","title":"terraform.tfstate\u6587\u4ef6\u7684\u4f5c\u7528","text":"<ul> <li>terraform.tfstate*\u8bb0\u5f55\u4e86**\u5f53\u524dtf\u7ba1\u7406\u7684\u8d44\u6e90\u7684\u72b6\u6001*\u3002</li> <li>\u5982\u679c\u6211\u4eec\u5728\u6b64\u4e4b\u524d\u6267\u884c\u4e86<code>terraform destroy</code> \u547d\u4ee4\uff0c\u628a\u8d44\u6e90\u90fd\u9500\u6bc1\u4e86\uff0c\u90a3\u4e48*terraform.tfstate*\u6587\u4ef6\u91cc\u9762\u662f\u770b\u4e0d\u5230\u4efb\u4f55resources\u4fe1\u606f\u7684\uff0c\u56e0\u4e3a\u8be5\u6587\u4ef6\u8bb0\u5f55\u7684\u662f\u5f53\u524d\u7684tf\u7ba1\u7406\u8d44\u6e90\u7684\u72b6\u6001\u3002</li> <li>\u4f46\u662f\uff0cTerraform\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u4e0a\u4e00\u6b21\u901a\u8fc7tf\u7ba1\u7406\u8d44\u6e90\u7684*terraform.tfstate.backup*\u6587\u4ef6\u3002</li> </ul>"},{"location":"8%E3%80%81%E7%8A%B6%E6%80%81%E6%96%87%E4%BB%B6%20-%20%22terraform.tfstate%22/#tfstate_2","title":"\u4e00\u8d77\u6765\u770b\u4e00\u4e0b tfstate \u6587\u4ef6\u6837\u4f8b","text":"<pre><code>$ cat terraform.tfstate\n</code></pre> <p>terraform.tfstate</p> <pre><code>{\n\"version\": 4,\n// \u91c7\u7528\u7248\u672c\n\"terraform_version\": \"1.1.4\",\n// \u8fd0\u884c\u6b21\u6570\n\"serial\": 9,\n// \u9879\u76ee\u552f\u4e00ID\u3002\u5982\u679c\u672c\u5730\u7528tf\u7ba1\u7406\u591a\u4e2a\u9879\u76ee\uff0c\u4f46\u662f\u56e0\u4e3aID\u662f\u552f\u4e00\u7684\uff0c\u8fd9\u4f1a\u786e\u4fdd\u4e0d\u540c\u7684tf\u4e0d\u4f1a\u5f71\u54cd\u5230\u4e91\u7aef\u7684\u540c\u4e00\u4e2a\u8d44\u6e90\n\"lineage\": \"a81e9642-ae12-9afc-ab52-1bb1ca1d5b66\",\n\"outputs\": {},\n\"resources\": [\n{\n\"mode\": \"managed\",\n// \u8d44\u6e90\u7c7b\u578b\n\"type\": \"aws_instance\",\n// \u8d44\u6e90\u540d\u79f0(TF\u4f7f\u7528)\n\"name\": \"myweb_server2\",\n\"provider\": \"provider[\\\"registry.terraform.io/hashicorp/aws\\\"]\",\n\"instances\": [\n{\n\"schema_version\": 1,\n\"attributes\": {\n// AMI-ID\n\"ami\": \"ami-0218d08a1f9dac831\",\n// EC2 ARN\n\"arn\": \"arn:aws:ec2:ap-northeast-1:168571836196:instance/i-06f67dc122136c534\",\n// EC2 \u5404\u79cd\u5c5e\u6027\u8bbe\u7f6e ...\n\"associate_public_ip_address\": true,\n\"availability_zone\": \"ap-northeast-1a\",\n\"capacity_reservation_specification\": [\n{\n\"capacity_reservation_preference\": \"open\",\n\"capacity_reservation_target\": []\n}\n],\n\"cpu_core_count\": 1,\n\"cpu_threads_per_core\": 1,\n\"credit_specification\": [\n{\n\"cpu_credits\": \"standard\"\n}\n],\n\"disable_api_termination\": false,\n\"ebs_block_device\": [],\n\"ebs_optimized\": false,\n\"enclave_options\": [\n{\n\"enabled\": false\n}\n],\n\"ephemeral_block_device\": [],\n\"get_password_data\": false,\n\"hibernation\": false,\n\"host_id\": null,\n\"iam_instance_profile\": \"\",\n\"id\": \"i-06f67dc122136c534\",\n\"instance_initiated_shutdown_behavior\": \"stop\",\n\"instance_state\": \"running\",\n\"instance_type\": \"t2.micro\",\n\"ipv6_address_count\": 0,\n\"ipv6_addresses\": [],\n\"key_name\": \"\",\n\"launch_template\": [],\n\"metadata_options\": [\n{\n\"http_endpoint\": \"enabled\",\n\"http_put_response_hop_limit\": 1,\n\"http_tokens\": \"optional\"\n}\n],\n\"monitoring\": false,\n\"network_interface\": [],\n\"outpost_arn\": \"\",\n\"password_data\": \"\",\n\"placement_group\": \"\",\n\"placement_partition_number\": null,\n\"primary_network_interface_id\": \"eni-04777e6b3d682c7e8\",\n\"private_dns\": \"ip-172-31-45-191.ap-northeast-1.compute.internal\",\n\"private_ip\": \"172.31.45.191\",\n\"public_dns\": \"ec2-13-231-129-70.ap-northeast-1.compute.amazonaws.com\",\n\"public_ip\": \"13.231.129.70\",\n\"root_block_device\": [\n{\n\"delete_on_termination\": true,\n\"device_name\": \"/dev/xvda\",\n\"encrypted\": false,\n\"iops\": 100,\n\"kms_key_id\": \"\",\n\"tags\": {},\n\"throughput\": 0,\n\"volume_id\": \"vol-013199e72886ccebd\",\n\"volume_size\": 8,\n\"volume_type\": \"gp2\"\n}\n],\n\"secondary_private_ips\": [],\n\"security_groups\": [\n\"default\"\n],\n\"source_dest_check\": true,\n\"subnet_id\": \"subnet-0647f7f6ae12f3d59\",\n\"tags\": {\n\"Name\": \"learnaws-ec2-from-terraform2\"\n},\n\"tags_all\": {\n\"Name\": \"learnaws-ec2-from-terraform2\"\n},\n\"tenancy\": \"default\",\n\"timeouts\": null,\n\"user_data\": \"4d496b03906764122c3ddb6f8bba0bddb432ec11\",\n\"user_data_base64\": null,\n\"volume_tags\": null,\n\"vpc_security_group_ids\": [\n\"sg-0e114289b84c9418a\"\n]\n},\n\"sensitive_attributes\": [],\n\"private\": \"eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6MTIwMDAwMDAwMDAwMCwidXBkYXRlIjo2MDAwMDAwMDAwMDB9LCJzY2hlbWFfdmVyc2lvbiI6IjEifQ==\"\n}\n]\n}\n]\n}\n</code></pre>"},{"location":"8%E3%80%81%E7%8A%B6%E6%80%81%E6%96%87%E4%BB%B6%20-%20%22terraform.tfstate%22/#_4","title":"\u5f3a\u70c8\u5efa\u8bae","text":"<ul> <li>\u5728\u8fdb\u884c\u6e90\u4ee3\u7801\u7ba1\u7406\u65f6\uff0c\u52a1\u5fc5\u628a*terraform.tfstate*\u6587\u4ef6\u4e5f\u7ba1\u7406\u8fdb\u53bb\u3002</li> <li>\u56e0\u4e3a\u4e00\u65e6*terraform.tfstate*\u6587\u4ef6\u4e22\u5931\uff0ctf\u5c31\u4e0d\u77e5\u9053\u8be5\u7ba1\u7406\u54ea\u4e9b\u8d44\u6e90</li> <li>*terraform.tfstate*\u867d\u7136\u662f\u81ea\u52a8\u751f\u6210\u81ea\u52a8\u7ef4\u62a4\uff0c\u4f46\u786e\u662f\u4f7f\u7528tf\u7ba1\u7406\u4e91\u8d44\u6e90\u6700\u6700\u91cd\u8981\u7684\u6587\u4ef6\uff0c\u4e00\u5b9a\u4e0d\u53ef\u4ee5\u4e22\u5931\u3002</li> </ul>"},{"location":"9%E3%80%81%E5%AE%9A%E4%B9%89%E5%BC%95%E7%94%A8%E5%8F%98%E9%87%8F/","title":"\u5b9a\u4e49\u5f15\u7528\u53d8\u91cf","text":""},{"location":"9%E3%80%81%E5%AE%9A%E4%B9%89%E5%BC%95%E7%94%A8%E5%8F%98%E9%87%8F/#_2","title":"\u77e5\u8bc6\u70b9","text":"<ul> <li>\u5c06 TF \u63cf\u8ff0\u6587\u4ef6\u4e2d\u5171\u540c\u7684\u5185\u5bb9\u62bd\u51fa\u4e3a\u53d8\u91cf\uff0c \u5c3d\u4eab\u7edf\u4e00\u7ba1\u7406</li> <li>\u4f8b\u5982\u5b9a\u4e49ec2\u65f6\u7684AMI\u662f\u4e00\u6837\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u628aAMI ID\u62bd\u8c61\u51fa\u6765\u4f5c\u4e3a\u53d8\u91cf</li> </ul>"},{"location":"9%E3%80%81%E5%AE%9A%E4%B9%89%E5%BC%95%E7%94%A8%E5%8F%98%E9%87%8F/#_3","title":"\u5b98\u7f51","text":"<p>https://www.terraform.io/language/values</p>"},{"location":"9%E3%80%81%E5%AE%9A%E4%B9%89%E5%BC%95%E7%94%A8%E5%8F%98%E9%87%8F/#_4","title":"\u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3","text":"<ul> <li>\u7f16\u5199\u53d8\u91cf\u5b9a\u4e49\u6587\u4ef6\uff0c \u62bd\u51fa\u5171\u540c\u7684\u8d44\u6e90\u5b9a\u4e49\u90e8\u5206</li> <li>\u7f16\u5199 TF \u8d44\u6e90\u63cf\u8ff0\u6587\u4ef6\uff0c \u5f15\u7528\u53d8\u91cf\u5b9a\u4e49</li> <li>\u90e8\u7f72\u786e\u8ba4</li> </ul>"},{"location":"9%E3%80%81%E5%AE%9A%E4%B9%89%E5%BC%95%E7%94%A8%E5%8F%98%E9%87%8F/#_5","title":"\u64cd\u4f5c\u6b65\u9aa4","text":""},{"location":"9%E3%80%81%E5%AE%9A%E4%B9%89%E5%BC%95%E7%94%A8%E5%8F%98%E9%87%8F/#_6","title":"\u76ee\u5f55\u7ed3\u6784","text":"<pre><code>.\n\u251c\u2500\u2500 ec2-variables.tf\n\u251c\u2500\u2500 ec2.tf\n\u2514\u2500\u2500 main.tf\n</code></pre>"},{"location":"9%E3%80%81%E5%AE%9A%E4%B9%89%E5%BC%95%E7%94%A8%E5%8F%98%E9%87%8F/#_7","title":"\u7f16\u5199\u53d8\u91cf\u5b9a\u4e49\u6587\u4ef6\uff0c \u62bd\u51fa\u5171\u540c\u7684\u8d44\u6e90\u5b9a\u4e49\u90e8\u5206","text":"<p>ec2-variables.tf</p> <pre><code># AWS Region\nvariable \"aws_region\" {\ndescription = \"AWS Region\"\ntype = string\n  default = \"ap-northeast-1\"\n}\n\n# AWS EC2 Instance Type\nvariable \"instance_type\" {\ndescription = \"EC2 Instance Type\"\ntype = string\n  default = \"t2.small\"  }\n\n# AWS EC2 Instance Key Pair\nvariable \"ami_id\" {\ndescription = \"AMI Image ID\"\ntype = string\n  default = \"ami-0218d08a1f9dac831\"\n}\n</code></pre>"},{"location":"9%E3%80%81%E5%AE%9A%E4%B9%89%E5%BC%95%E7%94%A8%E5%8F%98%E9%87%8F/#tf","title":"\u7f16\u5199 TF \u8d44\u6e90\u63cf\u8ff0\u6587\u4ef6\uff0c \u5f15\u7528\u53d8\u91cf\u5b9a\u4e49","text":"<p>main.tf</p> <pre><code>###########################################################\n# Terraform \u57fa\u672c\u8bbe\u7f6e\nterraform {\nrequired_providers {\naws = {\nsource  = \"hashicorp/aws\"\nversion = \"~&gt; 3.71\"\n}\n}\nrequired_version = \"&gt;= 1.1.3\"\n}\n\n###########################################################\n# \u63d0\u4f9b\u5546\u8bbe\u7f6e(\u4e91\u5e73\u53f0)\nprovider \"aws\" {\nprofile = \"learnaws\"\n# \u5f15\u7528\u53d8\u91cf\nregion  = var.aws_region\n}\n</code></pre> <p>ec2.tf</p> <pre><code>###########################################################\n# EC2 \u8d44\u6e90\u8bbe\u7f6e\nresource \"aws_instance\" \"myweb_server\" {\n# \u5f15\u7528\u53d8\u91cf\nami           = var.ami_id\n  # \u5f15\u7528\u53d8\u91cf\ninstance_type = var.instance_type\n\n  tags = {\nName = \"learnaws-ec2-from-terraform\"\n}\n}\n</code></pre>"},{"location":"9%E3%80%81%E5%AE%9A%E4%B9%89%E5%BC%95%E7%94%A8%E5%8F%98%E9%87%8F/#_8","title":"\u90e8\u7f72\u786e\u8ba4","text":"<pre><code># \u76ee\u5f55\u521d\u59cb\u5316\n$ terraform init\n# \u68c0\u9a8c tf \u6587\u4ef6\n$ terraform validate\n# \u5b9e\u65bd\u8ba1\u5212, \u51c6\u5907\u8d44\u6e90\n$ terraform plan\n# \u5e94\u7528\u90e8\u7f72\n$ terraform apply\n$ terraform apply -auto-approve\n# \u6467\u6bc1\u7cfb\u7edf\n$ terraform destroy\n</code></pre>"}]}
{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Terraform at AWS Guide \u00b6 1\u3001\u7b80\u4ecb 2\u3001\u5b89\u88c5\u53caAWS\u6388\u6743 3\u3001Terraform \u5de5\u4f5c\u6d41 4\u3001\u5feb\u901f\u5efa\u7acb\u7b2c\u4e00\u4e2a EC2 \u5b9e\u4f8b - \u672c\u5730\u6388\u6743\u65b9\u5f0f 5\u3001\u5feb\u901f\u5efa\u7acb\u7b2c\u4e00\u4e2a EC2 \u5b9e\u4f8b - EC2\u6388\u6743\u65b9\u5f0f.md 6\u3001\u5206\u6587\u4ef6\u7ba1\u7406 Terraform \u8d44\u6e90 7\u3001tf\u8bbe\u7f6eEC2\u8d44\u6e90\u7684\u7528\u6237\u6570\u636e 8\u3001\u72b6\u6001\u6587\u4ef6 - \"terraform.tfstate\" 9\u3001\u5b9a\u4e49\u5f15\u7528\u53d8\u91cf 10\u3001\u5b9a\u4e49AWS\u5b89\u5168\u7ec4 11\u3001EC2 \u6570\u636e\u6e90 - \u4f7f\u7528\u6700\u65b0\u7684 AMI \u6570\u636e\u6e90 12\u3001Output Values - \u5b9a\u4e49\u8f93\u51fa\u5185\u5bb9 13\u3001\u5b9a\u4e49 EC2 \u7684Size\u5217\u8868 14\u3001\u5b9a\u4e49 EC2 \u7684Size\u6620\u5c04 15\u3001\u540c\u65f6\u542f\u52a8\u591a\u53f0 EC2 \u5b9e\u4f8b 16\u3001\u67e5\u8be2\u53ef\u7528\u533a\u6570\u636e\u6e90, \u5206\u522b\u542f\u52a8 EC2","title":"Home"},{"location":"#terraform-at-aws-guide","text":"1\u3001\u7b80\u4ecb 2\u3001\u5b89\u88c5\u53caAWS\u6388\u6743 3\u3001Terraform \u5de5\u4f5c\u6d41 4\u3001\u5feb\u901f\u5efa\u7acb\u7b2c\u4e00\u4e2a EC2 \u5b9e\u4f8b - \u672c\u5730\u6388\u6743\u65b9\u5f0f 5\u3001\u5feb\u901f\u5efa\u7acb\u7b2c\u4e00\u4e2a EC2 \u5b9e\u4f8b - EC2\u6388\u6743\u65b9\u5f0f.md 6\u3001\u5206\u6587\u4ef6\u7ba1\u7406 Terraform \u8d44\u6e90 7\u3001tf\u8bbe\u7f6eEC2\u8d44\u6e90\u7684\u7528\u6237\u6570\u636e 8\u3001\u72b6\u6001\u6587\u4ef6 - \"terraform.tfstate\" 9\u3001\u5b9a\u4e49\u5f15\u7528\u53d8\u91cf 10\u3001\u5b9a\u4e49AWS\u5b89\u5168\u7ec4 11\u3001EC2 \u6570\u636e\u6e90 - \u4f7f\u7528\u6700\u65b0\u7684 AMI \u6570\u636e\u6e90 12\u3001Output Values - \u5b9a\u4e49\u8f93\u51fa\u5185\u5bb9 13\u3001\u5b9a\u4e49 EC2 \u7684Size\u5217\u8868 14\u3001\u5b9a\u4e49 EC2 \u7684Size\u6620\u5c04 15\u3001\u540c\u65f6\u542f\u52a8\u591a\u53f0 EC2 \u5b9e\u4f8b 16\u3001\u67e5\u8be2\u53ef\u7528\u533a\u6570\u636e\u6e90, \u5206\u522b\u542f\u52a8 EC2","title":"Terraform at AWS Guide"},{"location":"10%E3%80%81%E5%AE%9A%E4%B9%89AWS%E5%AE%89%E5%85%A8%E7%BB%84/","text":"\u4e3aEC2\u5b9a\u4e49AWS\u5b89\u5168\u7ec4 \u00b6 \u77e5\u8bc6\u70b9 \u00b6 \u4e4b\u524d\u6211\u4eec\u90e8\u7f72\u7684EC2\u90fd\u662f\u7528\u7684\u9ed8\u8ba4\u5b89\u5168\u7ec4\uff0c\u5728\u5b9e\u9645\u73af\u5883\u4e2d\uff0c\u8981\u6839\u636e\u6bcf\u53f0EC2\u7684\u804c\u80fd\u4f7f\u7528\u4e0d\u540c\u7684\u5b89\u5168\u7ec4 \u4f7f\u7528 Terraform \u5b9a\u4e49\u5b89\u5168\u7ec4 \u5b98\u7f51 \u00b6 https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group \u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3 \u00b6 \u7f16\u5199\u5b89\u5168\u7ec4\u5b9a\u4e49\u6587\u4ef6 \u7f16\u5199 TF \u8d44\u6e90\u63cf\u8ff0\u6587\u4ef6\uff0c \u5f15\u7528\u5b89\u5168\u7ec4\u5b9a\u4e49 \u90e8\u7f72\u786e\u8ba4 \u64cd\u4f5c\u6b65\u9aa4 \u00b6 \u76ee\u5f55\u7ed3\u6784 \u00b6 . \u251c\u2500\u2500 ec2-variables.tf \u251c\u2500\u2500 ec2-sg.tf \u251c\u2500\u2500 ec2.tf \u2514\u2500\u2500 main.tf \u7f16\u5199\u53d8\u91cf\u5b9a\u4e49\u6587\u4ef6 \u00b6 ec2-variables.tf # AWS Region variable \"aws_region\" { description = \"AWS Region\" type = string default = \"ap-northeast-1\" } # AWS EC2 Instance Type variable \"instance_type\" { description = \"EC2 Instance Type\" type = string default = \"t3.micro\" } # AWS EC2 Instance Key Pair variable \"ami_id\" { description = \"AMI Image ID\" type = string default = \"ami-0218d08a1f9dac831\" } \u7f16\u5199\u5b89\u5168\u7ec4\u5b9a\u4e49\u6587\u4ef6 \u00b6 ec2-sg.tf # Create Security Group resource \"aws_security_group\" \"learnaws-sg-web-ssh\" { # \u5b89\u5168\u7ec4\u7684\u540d\u79f0 name = \"learnaws-sg-web-ssh\" description = \"Web and SSH\" # \u5b89\u5168\u7ec4\u7684\u5165\u53e3\u63cf\u8ff0 ingress { description = \"Allow Port 80\" from_port = 80 to_port = 80 protocol = \"tcp\" # \u5141\u8bb8\u8303\u56f4\uff0c\u8fd9\u91cc\u662f\u6240\u6709ip\u90fd\u53ef\u8bbf\u95ee cidr_blocks = [ \"0.0.0.0/0\" ] } ingress { description = \"Allow Port 443\" from_port = 443 to_port = 443 protocol = \"tcp\" cidr_blocks = [ \"0.0.0.0/0\" ] } ingress { description = \"Allow Port 22\" from_port = 22 to_port = 22 protocol = \"tcp\" cidr_blocks = [ \"0.0.0.0/0\" ] # cidr_blocks = [\"12.15.55.32/32\"] } # \u5b89\u5168\u7ec4\u7684\u51fa\u53e3\u63cf\u8ff0 egress { description = \"Allow all ip and ports outbound\" from_port = 0 to_port = 0 protocol = \"-1\" cidr_blocks = [ \"0.0.0.0/0\" ] } tags = { Name = \"learnaws-sg-web-ssh\" } } \u7f16\u5199 TF \u8d44\u6e90\u63cf\u8ff0\u6587\u4ef6\uff0c \u5f15\u7528\u5b89\u5168\u7ec4\u5b9a\u4e49 \u00b6 ec2.tf ########################################################### # EC2 \u8d44\u6e90\u8bbe\u7f6e resource \"aws_instance\" \"myweb_server2\" { ami = var.ami_id instance_type = var.instance_type # \u4e3aEC2\u6307\u5b9a\u5b89\u5168\u7ec4\u7684ids vpc_security_group_ids = [ aws_security_group.learnaws-sg-web-ssh.id ] tags = { Name = \"learnaws-ec2-from-terraform-cli\" } } \u7f16\u5199 TF \u9879\u76ee\u63cf\u8ff0\u6587\u4ef6 \u00b6 main.tf ########################################################### # Terraform \u57fa\u672c\u8bbe\u7f6e terraform { required_providers { aws = { source = \"hashicorp/aws\" version = \"~> 3.71\" } } required_version = \">= 1.1.3\" } ########################################################### # \u63d0\u4f9b\u5546\u8bbe\u7f6e(\u4e91\u5e73\u53f0) provider \"aws\" { profile = \"learnaws\" region = var.aws_region } \u90e8\u7f72\u786e\u8ba4 \u00b6 # \u76ee\u5f55\u521d\u59cb\u5316 $ terraform init # \u68c0\u9a8c tf \u6587\u4ef6 $ terraform validate # \u5b9e\u65bd\u8ba1\u5212, \u51c6\u5907\u8d44\u6e90 $ terraform plan # \u5e94\u7528\u90e8\u7f72 $ terraform apply $ terraform apply -auto-approve # \u6467\u6bc1\u7cfb\u7edf $ terraform destroy $ terraform destroy -auto-approve","title":"10\u3001\u5b9a\u4e49AWS\u5b89\u5168\u7ec4"},{"location":"10%E3%80%81%E5%AE%9A%E4%B9%89AWS%E5%AE%89%E5%85%A8%E7%BB%84/#ec2aws","text":"","title":"\u4e3aEC2\u5b9a\u4e49AWS\u5b89\u5168\u7ec4"},{"location":"10%E3%80%81%E5%AE%9A%E4%B9%89AWS%E5%AE%89%E5%85%A8%E7%BB%84/#_1","text":"\u4e4b\u524d\u6211\u4eec\u90e8\u7f72\u7684EC2\u90fd\u662f\u7528\u7684\u9ed8\u8ba4\u5b89\u5168\u7ec4\uff0c\u5728\u5b9e\u9645\u73af\u5883\u4e2d\uff0c\u8981\u6839\u636e\u6bcf\u53f0EC2\u7684\u804c\u80fd\u4f7f\u7528\u4e0d\u540c\u7684\u5b89\u5168\u7ec4 \u4f7f\u7528 Terraform \u5b9a\u4e49\u5b89\u5168\u7ec4","title":"\u77e5\u8bc6\u70b9"},{"location":"10%E3%80%81%E5%AE%9A%E4%B9%89AWS%E5%AE%89%E5%85%A8%E7%BB%84/#_2","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group","title":"\u5b98\u7f51"},{"location":"10%E3%80%81%E5%AE%9A%E4%B9%89AWS%E5%AE%89%E5%85%A8%E7%BB%84/#_3","text":"\u7f16\u5199\u5b89\u5168\u7ec4\u5b9a\u4e49\u6587\u4ef6 \u7f16\u5199 TF \u8d44\u6e90\u63cf\u8ff0\u6587\u4ef6\uff0c \u5f15\u7528\u5b89\u5168\u7ec4\u5b9a\u4e49 \u90e8\u7f72\u786e\u8ba4","title":"\u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3"},{"location":"10%E3%80%81%E5%AE%9A%E4%B9%89AWS%E5%AE%89%E5%85%A8%E7%BB%84/#_4","text":"","title":"\u64cd\u4f5c\u6b65\u9aa4"},{"location":"10%E3%80%81%E5%AE%9A%E4%B9%89AWS%E5%AE%89%E5%85%A8%E7%BB%84/#_5","text":". \u251c\u2500\u2500 ec2-variables.tf \u251c\u2500\u2500 ec2-sg.tf \u251c\u2500\u2500 ec2.tf \u2514\u2500\u2500 main.tf","title":"\u76ee\u5f55\u7ed3\u6784"},{"location":"10%E3%80%81%E5%AE%9A%E4%B9%89AWS%E5%AE%89%E5%85%A8%E7%BB%84/#_6","text":"ec2-variables.tf # AWS Region variable \"aws_region\" { description = \"AWS Region\" type = string default = \"ap-northeast-1\" } # AWS EC2 Instance Type variable \"instance_type\" { description = \"EC2 Instance Type\" type = string default = \"t3.micro\" } # AWS EC2 Instance Key Pair variable \"ami_id\" { description = \"AMI Image ID\" type = string default = \"ami-0218d08a1f9dac831\" }","title":"\u7f16\u5199\u53d8\u91cf\u5b9a\u4e49\u6587\u4ef6"},{"location":"10%E3%80%81%E5%AE%9A%E4%B9%89AWS%E5%AE%89%E5%85%A8%E7%BB%84/#_7","text":"ec2-sg.tf # Create Security Group resource \"aws_security_group\" \"learnaws-sg-web-ssh\" { # \u5b89\u5168\u7ec4\u7684\u540d\u79f0 name = \"learnaws-sg-web-ssh\" description = \"Web and SSH\" # \u5b89\u5168\u7ec4\u7684\u5165\u53e3\u63cf\u8ff0 ingress { description = \"Allow Port 80\" from_port = 80 to_port = 80 protocol = \"tcp\" # \u5141\u8bb8\u8303\u56f4\uff0c\u8fd9\u91cc\u662f\u6240\u6709ip\u90fd\u53ef\u8bbf\u95ee cidr_blocks = [ \"0.0.0.0/0\" ] } ingress { description = \"Allow Port 443\" from_port = 443 to_port = 443 protocol = \"tcp\" cidr_blocks = [ \"0.0.0.0/0\" ] } ingress { description = \"Allow Port 22\" from_port = 22 to_port = 22 protocol = \"tcp\" cidr_blocks = [ \"0.0.0.0/0\" ] # cidr_blocks = [\"12.15.55.32/32\"] } # \u5b89\u5168\u7ec4\u7684\u51fa\u53e3\u63cf\u8ff0 egress { description = \"Allow all ip and ports outbound\" from_port = 0 to_port = 0 protocol = \"-1\" cidr_blocks = [ \"0.0.0.0/0\" ] } tags = { Name = \"learnaws-sg-web-ssh\" } }","title":"\u7f16\u5199\u5b89\u5168\u7ec4\u5b9a\u4e49\u6587\u4ef6"},{"location":"10%E3%80%81%E5%AE%9A%E4%B9%89AWS%E5%AE%89%E5%85%A8%E7%BB%84/#tf","text":"ec2.tf ########################################################### # EC2 \u8d44\u6e90\u8bbe\u7f6e resource \"aws_instance\" \"myweb_server2\" { ami = var.ami_id instance_type = var.instance_type # \u4e3aEC2\u6307\u5b9a\u5b89\u5168\u7ec4\u7684ids vpc_security_group_ids = [ aws_security_group.learnaws-sg-web-ssh.id ] tags = { Name = \"learnaws-ec2-from-terraform-cli\" } }","title":"\u7f16\u5199 TF \u8d44\u6e90\u63cf\u8ff0\u6587\u4ef6\uff0c \u5f15\u7528\u5b89\u5168\u7ec4\u5b9a\u4e49"},{"location":"10%E3%80%81%E5%AE%9A%E4%B9%89AWS%E5%AE%89%E5%85%A8%E7%BB%84/#tf_1","text":"main.tf ########################################################### # Terraform \u57fa\u672c\u8bbe\u7f6e terraform { required_providers { aws = { source = \"hashicorp/aws\" version = \"~> 3.71\" } } required_version = \">= 1.1.3\" } ########################################################### # \u63d0\u4f9b\u5546\u8bbe\u7f6e(\u4e91\u5e73\u53f0) provider \"aws\" { profile = \"learnaws\" region = var.aws_region }","title":"\u7f16\u5199 TF \u9879\u76ee\u63cf\u8ff0\u6587\u4ef6"},{"location":"10%E3%80%81%E5%AE%9A%E4%B9%89AWS%E5%AE%89%E5%85%A8%E7%BB%84/#_8","text":"# \u76ee\u5f55\u521d\u59cb\u5316 $ terraform init # \u68c0\u9a8c tf \u6587\u4ef6 $ terraform validate # \u5b9e\u65bd\u8ba1\u5212, \u51c6\u5907\u8d44\u6e90 $ terraform plan # \u5e94\u7528\u90e8\u7f72 $ terraform apply $ terraform apply -auto-approve # \u6467\u6bc1\u7cfb\u7edf $ terraform destroy $ terraform destroy -auto-approve","title":"\u90e8\u7f72\u786e\u8ba4"},{"location":"11%E3%80%81EC2%20%E6%95%B0%E6%8D%AE%E6%BA%90%20-%20%E4%BD%BF%E7%94%A8%E6%9C%80%E6%96%B0%E7%9A%84%20AMI%20%E6%95%B0%E6%8D%AE%E6%BA%90/","text":"EC2 \u6570\u636e\u6e90 - \u4f7f\u7528\u6700\u65b0\u7684 AMI \u6570\u636e\u6e90 \u00b6 \u77e5\u8bc6\u70b9 \u00b6 \u4e4b\u524d\u6211\u4eec\u901a\u8fc7TF\u542f\u52a8\u7684EC2\u90fd\u662f\u5199\u6b7b\u7684AMI\uff0c\u800camazon\u4e3a\u6211\u4eec\u7ef4\u62a4\u4e86\u4e00\u5957AMI\uff0c\u5e76\u4e14\u968f\u65f6\u53ef\u80fd\u4f1a\u53d1\u751f\u66f4\u65b0\uff0c\u4e00\u65e6amazon\u628aAMI ID\u8fdb\u884c\u66f4\u65b0\uff0c\u6b64\u65f6\u5982\u4f55\u53cd\u5e94\u5230\u672c\u5730\u7684TF\u7ef4\u62a4\u6587\u4ef6\u5f53\u4e2d\u5462\uff1f\u4e0d\u53ef\u80fd\u6bcf\u6b21\u90fd\u8981\u624b\u52a8\u8fdb\u884c\u4fee\u6539\u3002 \u90a3\u4e48\u6709\u6ca1\u6709\u4e00\u79cd\u65b9\u5f0f\uff0c\u53ea\u8981amazon\u7684\u4e91\u7aefAMI ID\u53d1\u751f\u66f4\u65b0\uff0c\u54b1\u4eec\u518d\u901a\u8fc7TF\u90e8\u7f72\u65f6\u81ea\u52a8\u5f15\u7528\u6700\u65b0\u7684AMI\uff1f \u5229\u7528 EC2 \u6570\u636e\u6e90\uff0c \u4fdd\u6301\u4f7f\u7528\u6700\u65b0\u7684 AMI \u955c\u50cf \u5b98\u7f51 \u00b6 https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/ami \u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3 \u00b6 \u7f16\u5199 EC2 AMI \u6570\u636e\u6e90\u6587\u4ef6\uff0c \u59cb\u7ec8\u4fdd\u6301\u4f7f\u7528\u6700\u65b0\u7684 AMI \u7f16\u5199 TF \u8d44\u6e90\u63cf\u8ff0\u6587\u4ef6\uff0c \u5f15\u7528\u6700\u65b0\u7684 AMI \u6570\u636e\u6e90 \u90e8\u7f72\u786e\u8ba4 \u64cd\u4f5c\u6b65\u9aa4 \u00b6 \u76ee\u5f55\u7ed3\u6784 \u00b6 . \u251c\u2500\u2500 ec2-variables.tf \u251c\u2500\u2500 ec2-aws_ami.tf \u251c\u2500\u2500 ec2-sg.tf \u251c\u2500\u2500 ec2.tf \u2514\u2500\u2500 main.tf \u7f16\u5199\u53d8\u91cf\u5b9a\u4e49\u6587\u4ef6 \u00b6 ec2-variables.tf # AWS Region variable \"aws_region\" { description = \"AWS Region\" type = string default = \"ap-northeast-1\" } # AWS EC2 Instance Type variable \"instance_type\" { description = \"EC2 Instance Type\" type = string default = \"t3.micro\" } \u7f16\u5199 EC2 AMI \u6570\u636e\u6e90\u6587\u4ef6\uff0c \u59cb\u7ec8\u4fdd\u6301\u4f7f\u7528\u6700\u65b0\u7684 AMI \u00b6 ec2-aws_ami.tf data \"aws_ami\" \"myami\" { # \u6700\u65b0\u4f7f\u7528 most_recent = true # amazon\u5b98\u65b9\u8ba4\u8bc1 owners = [ \"amazon\" ] # \u955c\u50cf\u6587\u4ef6\u540d\u79f0\u8fc7\u6ee4 filter { name = \"name\" values = [ \"amzn-ami-hvm-*-x86_64-gp2\" ] } # \u6839\u8bbe\u5907\u8fc7\u6ee4\u6761\u4ef6 filter { name = \"root-device-type\" values = [ \"ebs\" ] } } \u7f16\u5199\u5b89\u5168\u7ec4\u5b9a\u4e49\u6587\u4ef6 \u00b6 ec2-sg.tf # Create Security Group resource \"aws_security_group\" \"learnaws-sg-web-ssh\" { # \u5b89\u5168\u7ec4\u7684\u540d\u79f0 name = \"learnaws-sg-web-ssh\" description = \"Web and SSH\" # \u5b89\u5168\u7ec4\u7684\u5165\u53e3\u63cf\u8ff0 ingress { description = \"Allow Port 80\" from_port = 80 to_port = 80 protocol = \"tcp\" # \u5141\u8bb8\u8303\u56f4\uff0c\u8fd9\u91cc\u662f\u6240\u6709ip\u90fd\u53ef\u8bbf\u95ee cidr_blocks = [ \"0.0.0.0/0\" ] } ingress { description = \"Allow Port 443\" from_port = 443 to_port = 443 protocol = \"tcp\" cidr_blocks = [ \"0.0.0.0/0\" ] } ingress { description = \"Allow Port 22\" from_port = 22 to_port = 22 protocol = \"tcp\" cidr_blocks = [ \"0.0.0.0/0\" ] # cidr_blocks = [\"12.15.55.32/32\"] } # \u5b89\u5168\u7ec4\u7684\u51fa\u53e3\u63cf\u8ff0 egress { description = \"Allow all ip and ports outbound\" from_port = 0 to_port = 0 protocol = \"-1\" cidr_blocks = [ \"0.0.0.0/0\" ] } tags = { Name = \"learnaws-sg-web-ssh\" } } \u7f16\u5199 TF \u8d44\u6e90\u63cf\u8ff0\u6587\u4ef6\uff0c \u5f15\u7528\u6700\u65b0\u7684 AMI \u6570\u636e\u6e90 \u00b6 ec2.tf ########################################################### # EC2 \u8d44\u6e90\u8bbe\u7f6e resource \"aws_instance\" \"myweb_server2\" { # \u5f15\u7528 AMI \u6570\u636e\u6e90 ami = data.aws_ami.myami.id instance_type = var.instance_type vpc_security_group_ids = [ aws_security_group.learnaws-sg-web-ssh.id ] tags = { Name = \"learnaws-ec2-from-terraform\" } } \u7f16\u5199 TF \u9879\u76ee\u63cf\u8ff0\u6587\u4ef6 \u00b6 main.tf ########################################################### # Terraform \u57fa\u672c\u8bbe\u7f6e terraform { required_providers { aws = { source = \"hashicorp/aws\" version = \"~> 3.71\" } } required_version = \">= 1.1.3\" } ########################################################### # \u63d0\u4f9b\u5546\u8bbe\u7f6e(\u4e91\u5e73\u53f0) provider \"aws\" { profile = \"learnaws\" region = var.aws_region } \u90e8\u7f72\u786e\u8ba4 \u00b6 # \u76ee\u5f55\u521d\u59cb\u5316 $ terraform init # \u68c0\u9a8c tf \u6587\u4ef6 $ terraform validate # \u5b9e\u65bd\u8ba1\u5212, \u51c6\u5907\u8d44\u6e90 $ terraform plan # \u5e94\u7528\u90e8\u7f72 $ terraform apply $ terraform apply -auto-approve # \u6467\u6bc1\u7cfb\u7edf $ terraform destroy $ terraform destroy -auto-approve","title":"11\u3001EC2 \u6570\u636e\u6e90   \u4f7f\u7528\u6700\u65b0\u7684 AMI \u6570\u636e\u6e90"},{"location":"11%E3%80%81EC2%20%E6%95%B0%E6%8D%AE%E6%BA%90%20-%20%E4%BD%BF%E7%94%A8%E6%9C%80%E6%96%B0%E7%9A%84%20AMI%20%E6%95%B0%E6%8D%AE%E6%BA%90/#ec2-ami","text":"","title":"EC2 \u6570\u636e\u6e90 - \u4f7f\u7528\u6700\u65b0\u7684 AMI \u6570\u636e\u6e90"},{"location":"11%E3%80%81EC2%20%E6%95%B0%E6%8D%AE%E6%BA%90%20-%20%E4%BD%BF%E7%94%A8%E6%9C%80%E6%96%B0%E7%9A%84%20AMI%20%E6%95%B0%E6%8D%AE%E6%BA%90/#_1","text":"\u4e4b\u524d\u6211\u4eec\u901a\u8fc7TF\u542f\u52a8\u7684EC2\u90fd\u662f\u5199\u6b7b\u7684AMI\uff0c\u800camazon\u4e3a\u6211\u4eec\u7ef4\u62a4\u4e86\u4e00\u5957AMI\uff0c\u5e76\u4e14\u968f\u65f6\u53ef\u80fd\u4f1a\u53d1\u751f\u66f4\u65b0\uff0c\u4e00\u65e6amazon\u628aAMI ID\u8fdb\u884c\u66f4\u65b0\uff0c\u6b64\u65f6\u5982\u4f55\u53cd\u5e94\u5230\u672c\u5730\u7684TF\u7ef4\u62a4\u6587\u4ef6\u5f53\u4e2d\u5462\uff1f\u4e0d\u53ef\u80fd\u6bcf\u6b21\u90fd\u8981\u624b\u52a8\u8fdb\u884c\u4fee\u6539\u3002 \u90a3\u4e48\u6709\u6ca1\u6709\u4e00\u79cd\u65b9\u5f0f\uff0c\u53ea\u8981amazon\u7684\u4e91\u7aefAMI ID\u53d1\u751f\u66f4\u65b0\uff0c\u54b1\u4eec\u518d\u901a\u8fc7TF\u90e8\u7f72\u65f6\u81ea\u52a8\u5f15\u7528\u6700\u65b0\u7684AMI\uff1f \u5229\u7528 EC2 \u6570\u636e\u6e90\uff0c \u4fdd\u6301\u4f7f\u7528\u6700\u65b0\u7684 AMI \u955c\u50cf","title":"\u77e5\u8bc6\u70b9"},{"location":"11%E3%80%81EC2%20%E6%95%B0%E6%8D%AE%E6%BA%90%20-%20%E4%BD%BF%E7%94%A8%E6%9C%80%E6%96%B0%E7%9A%84%20AMI%20%E6%95%B0%E6%8D%AE%E6%BA%90/#_2","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/ami","title":"\u5b98\u7f51"},{"location":"11%E3%80%81EC2%20%E6%95%B0%E6%8D%AE%E6%BA%90%20-%20%E4%BD%BF%E7%94%A8%E6%9C%80%E6%96%B0%E7%9A%84%20AMI%20%E6%95%B0%E6%8D%AE%E6%BA%90/#_3","text":"\u7f16\u5199 EC2 AMI \u6570\u636e\u6e90\u6587\u4ef6\uff0c \u59cb\u7ec8\u4fdd\u6301\u4f7f\u7528\u6700\u65b0\u7684 AMI \u7f16\u5199 TF \u8d44\u6e90\u63cf\u8ff0\u6587\u4ef6\uff0c \u5f15\u7528\u6700\u65b0\u7684 AMI \u6570\u636e\u6e90 \u90e8\u7f72\u786e\u8ba4","title":"\u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3"},{"location":"11%E3%80%81EC2%20%E6%95%B0%E6%8D%AE%E6%BA%90%20-%20%E4%BD%BF%E7%94%A8%E6%9C%80%E6%96%B0%E7%9A%84%20AMI%20%E6%95%B0%E6%8D%AE%E6%BA%90/#_4","text":"","title":"\u64cd\u4f5c\u6b65\u9aa4"},{"location":"11%E3%80%81EC2%20%E6%95%B0%E6%8D%AE%E6%BA%90%20-%20%E4%BD%BF%E7%94%A8%E6%9C%80%E6%96%B0%E7%9A%84%20AMI%20%E6%95%B0%E6%8D%AE%E6%BA%90/#_5","text":". \u251c\u2500\u2500 ec2-variables.tf \u251c\u2500\u2500 ec2-aws_ami.tf \u251c\u2500\u2500 ec2-sg.tf \u251c\u2500\u2500 ec2.tf \u2514\u2500\u2500 main.tf","title":"\u76ee\u5f55\u7ed3\u6784"},{"location":"11%E3%80%81EC2%20%E6%95%B0%E6%8D%AE%E6%BA%90%20-%20%E4%BD%BF%E7%94%A8%E6%9C%80%E6%96%B0%E7%9A%84%20AMI%20%E6%95%B0%E6%8D%AE%E6%BA%90/#_6","text":"ec2-variables.tf # AWS Region variable \"aws_region\" { description = \"AWS Region\" type = string default = \"ap-northeast-1\" } # AWS EC2 Instance Type variable \"instance_type\" { description = \"EC2 Instance Type\" type = string default = \"t3.micro\" }","title":"\u7f16\u5199\u53d8\u91cf\u5b9a\u4e49\u6587\u4ef6"},{"location":"11%E3%80%81EC2%20%E6%95%B0%E6%8D%AE%E6%BA%90%20-%20%E4%BD%BF%E7%94%A8%E6%9C%80%E6%96%B0%E7%9A%84%20AMI%20%E6%95%B0%E6%8D%AE%E6%BA%90/#ec2-ami-ami","text":"ec2-aws_ami.tf data \"aws_ami\" \"myami\" { # \u6700\u65b0\u4f7f\u7528 most_recent = true # amazon\u5b98\u65b9\u8ba4\u8bc1 owners = [ \"amazon\" ] # \u955c\u50cf\u6587\u4ef6\u540d\u79f0\u8fc7\u6ee4 filter { name = \"name\" values = [ \"amzn-ami-hvm-*-x86_64-gp2\" ] } # \u6839\u8bbe\u5907\u8fc7\u6ee4\u6761\u4ef6 filter { name = \"root-device-type\" values = [ \"ebs\" ] } }","title":"\u7f16\u5199 EC2 AMI \u6570\u636e\u6e90\u6587\u4ef6\uff0c \u59cb\u7ec8\u4fdd\u6301\u4f7f\u7528\u6700\u65b0\u7684 AMI"},{"location":"11%E3%80%81EC2%20%E6%95%B0%E6%8D%AE%E6%BA%90%20-%20%E4%BD%BF%E7%94%A8%E6%9C%80%E6%96%B0%E7%9A%84%20AMI%20%E6%95%B0%E6%8D%AE%E6%BA%90/#_7","text":"ec2-sg.tf # Create Security Group resource \"aws_security_group\" \"learnaws-sg-web-ssh\" { # \u5b89\u5168\u7ec4\u7684\u540d\u79f0 name = \"learnaws-sg-web-ssh\" description = \"Web and SSH\" # \u5b89\u5168\u7ec4\u7684\u5165\u53e3\u63cf\u8ff0 ingress { description = \"Allow Port 80\" from_port = 80 to_port = 80 protocol = \"tcp\" # \u5141\u8bb8\u8303\u56f4\uff0c\u8fd9\u91cc\u662f\u6240\u6709ip\u90fd\u53ef\u8bbf\u95ee cidr_blocks = [ \"0.0.0.0/0\" ] } ingress { description = \"Allow Port 443\" from_port = 443 to_port = 443 protocol = \"tcp\" cidr_blocks = [ \"0.0.0.0/0\" ] } ingress { description = \"Allow Port 22\" from_port = 22 to_port = 22 protocol = \"tcp\" cidr_blocks = [ \"0.0.0.0/0\" ] # cidr_blocks = [\"12.15.55.32/32\"] } # \u5b89\u5168\u7ec4\u7684\u51fa\u53e3\u63cf\u8ff0 egress { description = \"Allow all ip and ports outbound\" from_port = 0 to_port = 0 protocol = \"-1\" cidr_blocks = [ \"0.0.0.0/0\" ] } tags = { Name = \"learnaws-sg-web-ssh\" } }","title":"\u7f16\u5199\u5b89\u5168\u7ec4\u5b9a\u4e49\u6587\u4ef6"},{"location":"11%E3%80%81EC2%20%E6%95%B0%E6%8D%AE%E6%BA%90%20-%20%E4%BD%BF%E7%94%A8%E6%9C%80%E6%96%B0%E7%9A%84%20AMI%20%E6%95%B0%E6%8D%AE%E6%BA%90/#tf-ami","text":"ec2.tf ########################################################### # EC2 \u8d44\u6e90\u8bbe\u7f6e resource \"aws_instance\" \"myweb_server2\" { # \u5f15\u7528 AMI \u6570\u636e\u6e90 ami = data.aws_ami.myami.id instance_type = var.instance_type vpc_security_group_ids = [ aws_security_group.learnaws-sg-web-ssh.id ] tags = { Name = \"learnaws-ec2-from-terraform\" } }","title":"\u7f16\u5199 TF \u8d44\u6e90\u63cf\u8ff0\u6587\u4ef6\uff0c \u5f15\u7528\u6700\u65b0\u7684 AMI \u6570\u636e\u6e90"},{"location":"11%E3%80%81EC2%20%E6%95%B0%E6%8D%AE%E6%BA%90%20-%20%E4%BD%BF%E7%94%A8%E6%9C%80%E6%96%B0%E7%9A%84%20AMI%20%E6%95%B0%E6%8D%AE%E6%BA%90/#tf","text":"main.tf ########################################################### # Terraform \u57fa\u672c\u8bbe\u7f6e terraform { required_providers { aws = { source = \"hashicorp/aws\" version = \"~> 3.71\" } } required_version = \">= 1.1.3\" } ########################################################### # \u63d0\u4f9b\u5546\u8bbe\u7f6e(\u4e91\u5e73\u53f0) provider \"aws\" { profile = \"learnaws\" region = var.aws_region }","title":"\u7f16\u5199 TF \u9879\u76ee\u63cf\u8ff0\u6587\u4ef6"},{"location":"11%E3%80%81EC2%20%E6%95%B0%E6%8D%AE%E6%BA%90%20-%20%E4%BD%BF%E7%94%A8%E6%9C%80%E6%96%B0%E7%9A%84%20AMI%20%E6%95%B0%E6%8D%AE%E6%BA%90/#_8","text":"# \u76ee\u5f55\u521d\u59cb\u5316 $ terraform init # \u68c0\u9a8c tf \u6587\u4ef6 $ terraform validate # \u5b9e\u65bd\u8ba1\u5212, \u51c6\u5907\u8d44\u6e90 $ terraform plan # \u5e94\u7528\u90e8\u7f72 $ terraform apply $ terraform apply -auto-approve # \u6467\u6bc1\u7cfb\u7edf $ terraform destroy $ terraform destroy -auto-approve","title":"\u90e8\u7f72\u786e\u8ba4"},{"location":"12%E3%80%81Output%20Values%20-%20%E5%AE%9A%E4%B9%89%E8%BE%93%E5%87%BA%E5%86%85%E5%AE%B9/","text":"Output Values - \u5b9a\u4e49\u8f93\u51fa\u5185\u5bb9 \u00b6 \u77e5\u8bc6\u70b9 \u00b6 \u5f53\u6211\u4eec\u6bcf\u6b21\u6267\u884c terraform apply \u547d\u4ee4\u540e\uff0c\u4f1a\u8f93\u51fa\u5f88\u591a\u65e5\u5fd7\uff0c\u6211\u4eec\u53ef\u4ee5\u8fdb\u884c\u5b9a\u4e49\u8f93\u51fa\u5185\u5bb9\uff0c\u628a\u6bd4\u8f83\u5173\u5fc3\u7684\u65e5\u5fd7\u8fdb\u884c\u8f93\u51fa \u5b9a\u4e49 Terraform \u7ba1\u7406\u7684\u4e91\u7aef\u8d44\u6e90\u7684\u8f93\u51fa\u5185\u5bb9 \u5b98\u7f51 \u00b6 https://www.terraform.io/language/values/outputs \u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3 \u00b6 \u5b9a\u4e8e\u8d44\u6e90\u8f93\u51fa\u663e\u793a\u7684\u5185\u5bb9 \u8fd0\u884c\u6a21\u7248\u786e\u8ba4\u52a8\u4f5c \u64cd\u4f5c\u6b65\u9aa4 \u00b6 \u76ee\u5f55\u7ed3\u6784 \u00b6 . \u251c\u2500\u2500 ec2-variables.tf \u251c\u2500\u2500 ec2-aws_ami.tf \u251c\u2500\u2500 ec2-sg.tf \u251c\u2500\u2500 ec2.tf \u251c\u2500\u2500 main.tf \u2514\u2500\u2500 ec2-outputs.tf \u7f16\u5199\u53d8\u91cf\u5b9a\u4e49\u6587\u4ef6 \u00b6 ec2-variables.tf # AWS Region variable \"aws_region\" { description = \"AWS Region\" type = string default = \"ap-northeast-1\" } # AWS EC2 Instance Type variable \"instance_type\" { description = \"EC2 Instance Type\" type = string default = \"t3.micro\" } \u7f16\u5199 EC2 AMI \u6570\u636e\u6e90\u6587\u4ef6\uff0c \u59cb\u7ec8\u4fdd\u6301\u4f7f\u7528\u6700\u65b0\u7684 AMI \u00b6 ec2-aws_ami.tf data \"aws_ami\" \"myami\" { # \u6700\u65b0\u4f7f\u7528 most_recent = true # amazon\u5b98\u65b9\u8ba4\u8bc1 owners = [ \"amazon\" ] # \u955c\u50cf\u6587\u4ef6\u540d\u79f0\u8fc7\u6ee4 filter { name = \"name\" values = [ \"amzn-ami-hvm-*-x86_64-gp2\" ] } # \u6839\u8bbe\u5907\u8fc7\u6ee4\u6761\u4ef6 filter { name = \"root-device-type\" values = [ \"ebs\" ] } } \u7f16\u5199\u5b89\u5168\u7ec4\u5b9a\u4e49\u6587\u4ef6 \u00b6 ec2-sg.tf # Create Security Group resource \"aws_security_group\" \"learnaws-sg-web-ssh\" { # \u5b89\u5168\u7ec4\u7684\u540d\u79f0 name = \"learnaws-sg-web-ssh\" description = \"Web and SSH\" # \u5b89\u5168\u7ec4\u7684\u5165\u53e3\u63cf\u8ff0 ingress { description = \"Allow Port 80\" from_port = 80 to_port = 80 protocol = \"tcp\" # \u5141\u8bb8\u8303\u56f4\uff0c\u8fd9\u91cc\u662f\u6240\u6709ip\u90fd\u53ef\u8bbf\u95ee cidr_blocks = [ \"0.0.0.0/0\" ] } ingress { description = \"Allow Port 443\" from_port = 443 to_port = 443 protocol = \"tcp\" cidr_blocks = [ \"0.0.0.0/0\" ] } ingress { description = \"Allow Port 22\" from_port = 22 to_port = 22 protocol = \"tcp\" cidr_blocks = [ \"0.0.0.0/0\" ] # cidr_blocks = [\"12.15.55.32/32\"] } # \u5b89\u5168\u7ec4\u7684\u51fa\u53e3\u63cf\u8ff0 egress { description = \"Allow all ip and ports outbound\" from_port = 0 to_port = 0 protocol = \"-1\" cidr_blocks = [ \"0.0.0.0/0\" ] } tags = { Name = \"learnaws-sg-web-ssh\" } } \u7f16\u5199 TF \u8d44\u6e90\u63cf\u8ff0\u6587\u4ef6 \u00b6 ec2.tf ########################################################### # EC2 \u8d44\u6e90\u8bbe\u7f6e resource \"aws_instance\" \"myweb_server2\" { # \u5f15\u7528 AMI \u6570\u636e\u6e90 ami = data.aws_ami.myami.id instance_type = var.instance_type vpc_security_group_ids = [ aws_security_group.learnaws-sg-web-ssh.id ] tags = { Name = \"learnaws-ec2-from-terraform\" } } \u7f16\u5199 TF \u9879\u76ee\u63cf\u8ff0\u6587\u4ef6 \u00b6 main.tf ########################################################### # Terraform \u57fa\u672c\u8bbe\u7f6e terraform { required_providers { aws = { source = \"hashicorp/aws\" version = \"~> 3.71\" } } required_version = \">= 1.1.3\" } ########################################################### # \u63d0\u4f9b\u5546\u8bbe\u7f6e(\u4e91\u5e73\u53f0) provider \"aws\" { profile = \"learnaws\" region = var.aws_region } \u5b9a\u4e49\u8d44\u6e90\u8f93\u51fa\u663e\u793a\u7684\u5185\u5bb9 \u00b6 ec2-outputs.tf output \"instance_publicip\" { # EC2 \u516c\u6709IP value = aws_instance.myweb_server2.public_ip } output \"instance_availability_zone\" { # \u90e8\u7f72\u7684\u53ef\u7528\u533a value = aws_instance.myweb_server2.availability_zone } output \"instance_ami\" { # \u4f7f\u7528\u7684 AMI value = aws_instance.myweb_server2.ami } output \"instance_private_ip\" { # EC2 \u79c1\u6709\u7f51\u65ad IP value = aws_instance.myweb_server2.private_ip } output \"instance_cpu_core_count\" { # EC2 CPU \u6838\u5fc3\u6570 value = aws_instance.myweb_server2.cpu_core_count } output \"instance_instance_type\" { # EC2 \u5b9e\u4f8b\u7c7b\u578b value = aws_instance.myweb_server2.instance_type } # \u6700\u540e\u8f93\u51fa\u7684\u6837\u5f0f\u5982\u4e0b: # instance_ami = \"ami-0d9f3ffed238c343f\" # instance_availability_zone = \"ap-northeast-1c\" # instance_cpu_core_count = \"1\" # instance_instance_type = \"t3.micro\" # instance_private_ip = \"172.31.13.114\" # instance_publicip = \"18.183.155.128\" EC2\u8d44\u6e90\u5c5e\u6027\u53c2\u7167 https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance \u8fd0\u884c\u6a21\u7248\u786e\u8ba4\u52a8\u4f5c \u00b6 # \u76ee\u5f55\u521d\u59cb\u5316 $ terraform init # \u68c0\u9a8c tf \u6587\u4ef6 $ terraform validate # \u5b9e\u65bd\u8ba1\u5212, \u51c6\u5907\u8d44\u6e90 $ terraform plan # \u5e94\u7528\u90e8\u7f72 $ terraform apply $ terraform apply -auto-approve # \u6467\u6bc1\u7cfb\u7edf $ terraform destroy","title":"12\u3001Output Values   \u5b9a\u4e49\u8f93\u51fa\u5185\u5bb9"},{"location":"12%E3%80%81Output%20Values%20-%20%E5%AE%9A%E4%B9%89%E8%BE%93%E5%87%BA%E5%86%85%E5%AE%B9/#output-values-","text":"","title":"Output Values - \u5b9a\u4e49\u8f93\u51fa\u5185\u5bb9"},{"location":"12%E3%80%81Output%20Values%20-%20%E5%AE%9A%E4%B9%89%E8%BE%93%E5%87%BA%E5%86%85%E5%AE%B9/#_1","text":"\u5f53\u6211\u4eec\u6bcf\u6b21\u6267\u884c terraform apply \u547d\u4ee4\u540e\uff0c\u4f1a\u8f93\u51fa\u5f88\u591a\u65e5\u5fd7\uff0c\u6211\u4eec\u53ef\u4ee5\u8fdb\u884c\u5b9a\u4e49\u8f93\u51fa\u5185\u5bb9\uff0c\u628a\u6bd4\u8f83\u5173\u5fc3\u7684\u65e5\u5fd7\u8fdb\u884c\u8f93\u51fa \u5b9a\u4e49 Terraform \u7ba1\u7406\u7684\u4e91\u7aef\u8d44\u6e90\u7684\u8f93\u51fa\u5185\u5bb9","title":"\u77e5\u8bc6\u70b9"},{"location":"12%E3%80%81Output%20Values%20-%20%E5%AE%9A%E4%B9%89%E8%BE%93%E5%87%BA%E5%86%85%E5%AE%B9/#_2","text":"https://www.terraform.io/language/values/outputs","title":"\u5b98\u7f51"},{"location":"12%E3%80%81Output%20Values%20-%20%E5%AE%9A%E4%B9%89%E8%BE%93%E5%87%BA%E5%86%85%E5%AE%B9/#_3","text":"\u5b9a\u4e8e\u8d44\u6e90\u8f93\u51fa\u663e\u793a\u7684\u5185\u5bb9 \u8fd0\u884c\u6a21\u7248\u786e\u8ba4\u52a8\u4f5c","title":"\u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3"},{"location":"12%E3%80%81Output%20Values%20-%20%E5%AE%9A%E4%B9%89%E8%BE%93%E5%87%BA%E5%86%85%E5%AE%B9/#_4","text":"","title":"\u64cd\u4f5c\u6b65\u9aa4"},{"location":"12%E3%80%81Output%20Values%20-%20%E5%AE%9A%E4%B9%89%E8%BE%93%E5%87%BA%E5%86%85%E5%AE%B9/#_5","text":". \u251c\u2500\u2500 ec2-variables.tf \u251c\u2500\u2500 ec2-aws_ami.tf \u251c\u2500\u2500 ec2-sg.tf \u251c\u2500\u2500 ec2.tf \u251c\u2500\u2500 main.tf \u2514\u2500\u2500 ec2-outputs.tf","title":"\u76ee\u5f55\u7ed3\u6784"},{"location":"12%E3%80%81Output%20Values%20-%20%E5%AE%9A%E4%B9%89%E8%BE%93%E5%87%BA%E5%86%85%E5%AE%B9/#_6","text":"ec2-variables.tf # AWS Region variable \"aws_region\" { description = \"AWS Region\" type = string default = \"ap-northeast-1\" } # AWS EC2 Instance Type variable \"instance_type\" { description = \"EC2 Instance Type\" type = string default = \"t3.micro\" }","title":"\u7f16\u5199\u53d8\u91cf\u5b9a\u4e49\u6587\u4ef6"},{"location":"12%E3%80%81Output%20Values%20-%20%E5%AE%9A%E4%B9%89%E8%BE%93%E5%87%BA%E5%86%85%E5%AE%B9/#ec2-ami-ami","text":"ec2-aws_ami.tf data \"aws_ami\" \"myami\" { # \u6700\u65b0\u4f7f\u7528 most_recent = true # amazon\u5b98\u65b9\u8ba4\u8bc1 owners = [ \"amazon\" ] # \u955c\u50cf\u6587\u4ef6\u540d\u79f0\u8fc7\u6ee4 filter { name = \"name\" values = [ \"amzn-ami-hvm-*-x86_64-gp2\" ] } # \u6839\u8bbe\u5907\u8fc7\u6ee4\u6761\u4ef6 filter { name = \"root-device-type\" values = [ \"ebs\" ] } }","title":"\u7f16\u5199 EC2 AMI \u6570\u636e\u6e90\u6587\u4ef6\uff0c \u59cb\u7ec8\u4fdd\u6301\u4f7f\u7528\u6700\u65b0\u7684 AMI"},{"location":"12%E3%80%81Output%20Values%20-%20%E5%AE%9A%E4%B9%89%E8%BE%93%E5%87%BA%E5%86%85%E5%AE%B9/#_7","text":"ec2-sg.tf # Create Security Group resource \"aws_security_group\" \"learnaws-sg-web-ssh\" { # \u5b89\u5168\u7ec4\u7684\u540d\u79f0 name = \"learnaws-sg-web-ssh\" description = \"Web and SSH\" # \u5b89\u5168\u7ec4\u7684\u5165\u53e3\u63cf\u8ff0 ingress { description = \"Allow Port 80\" from_port = 80 to_port = 80 protocol = \"tcp\" # \u5141\u8bb8\u8303\u56f4\uff0c\u8fd9\u91cc\u662f\u6240\u6709ip\u90fd\u53ef\u8bbf\u95ee cidr_blocks = [ \"0.0.0.0/0\" ] } ingress { description = \"Allow Port 443\" from_port = 443 to_port = 443 protocol = \"tcp\" cidr_blocks = [ \"0.0.0.0/0\" ] } ingress { description = \"Allow Port 22\" from_port = 22 to_port = 22 protocol = \"tcp\" cidr_blocks = [ \"0.0.0.0/0\" ] # cidr_blocks = [\"12.15.55.32/32\"] } # \u5b89\u5168\u7ec4\u7684\u51fa\u53e3\u63cf\u8ff0 egress { description = \"Allow all ip and ports outbound\" from_port = 0 to_port = 0 protocol = \"-1\" cidr_blocks = [ \"0.0.0.0/0\" ] } tags = { Name = \"learnaws-sg-web-ssh\" } }","title":"\u7f16\u5199\u5b89\u5168\u7ec4\u5b9a\u4e49\u6587\u4ef6"},{"location":"12%E3%80%81Output%20Values%20-%20%E5%AE%9A%E4%B9%89%E8%BE%93%E5%87%BA%E5%86%85%E5%AE%B9/#tf","text":"ec2.tf ########################################################### # EC2 \u8d44\u6e90\u8bbe\u7f6e resource \"aws_instance\" \"myweb_server2\" { # \u5f15\u7528 AMI \u6570\u636e\u6e90 ami = data.aws_ami.myami.id instance_type = var.instance_type vpc_security_group_ids = [ aws_security_group.learnaws-sg-web-ssh.id ] tags = { Name = \"learnaws-ec2-from-terraform\" } }","title":"\u7f16\u5199 TF \u8d44\u6e90\u63cf\u8ff0\u6587\u4ef6"},{"location":"12%E3%80%81Output%20Values%20-%20%E5%AE%9A%E4%B9%89%E8%BE%93%E5%87%BA%E5%86%85%E5%AE%B9/#tf_1","text":"main.tf ########################################################### # Terraform \u57fa\u672c\u8bbe\u7f6e terraform { required_providers { aws = { source = \"hashicorp/aws\" version = \"~> 3.71\" } } required_version = \">= 1.1.3\" } ########################################################### # \u63d0\u4f9b\u5546\u8bbe\u7f6e(\u4e91\u5e73\u53f0) provider \"aws\" { profile = \"learnaws\" region = var.aws_region }","title":"\u7f16\u5199 TF \u9879\u76ee\u63cf\u8ff0\u6587\u4ef6"},{"location":"12%E3%80%81Output%20Values%20-%20%E5%AE%9A%E4%B9%89%E8%BE%93%E5%87%BA%E5%86%85%E5%AE%B9/#_8","text":"ec2-outputs.tf output \"instance_publicip\" { # EC2 \u516c\u6709IP value = aws_instance.myweb_server2.public_ip } output \"instance_availability_zone\" { # \u90e8\u7f72\u7684\u53ef\u7528\u533a value = aws_instance.myweb_server2.availability_zone } output \"instance_ami\" { # \u4f7f\u7528\u7684 AMI value = aws_instance.myweb_server2.ami } output \"instance_private_ip\" { # EC2 \u79c1\u6709\u7f51\u65ad IP value = aws_instance.myweb_server2.private_ip } output \"instance_cpu_core_count\" { # EC2 CPU \u6838\u5fc3\u6570 value = aws_instance.myweb_server2.cpu_core_count } output \"instance_instance_type\" { # EC2 \u5b9e\u4f8b\u7c7b\u578b value = aws_instance.myweb_server2.instance_type } # \u6700\u540e\u8f93\u51fa\u7684\u6837\u5f0f\u5982\u4e0b: # instance_ami = \"ami-0d9f3ffed238c343f\" # instance_availability_zone = \"ap-northeast-1c\" # instance_cpu_core_count = \"1\" # instance_instance_type = \"t3.micro\" # instance_private_ip = \"172.31.13.114\" # instance_publicip = \"18.183.155.128\" EC2\u8d44\u6e90\u5c5e\u6027\u53c2\u7167 https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance","title":"\u5b9a\u4e49\u8d44\u6e90\u8f93\u51fa\u663e\u793a\u7684\u5185\u5bb9"},{"location":"12%E3%80%81Output%20Values%20-%20%E5%AE%9A%E4%B9%89%E8%BE%93%E5%87%BA%E5%86%85%E5%AE%B9/#_9","text":"# \u76ee\u5f55\u521d\u59cb\u5316 $ terraform init # \u68c0\u9a8c tf \u6587\u4ef6 $ terraform validate # \u5b9e\u65bd\u8ba1\u5212, \u51c6\u5907\u8d44\u6e90 $ terraform plan # \u5e94\u7528\u90e8\u7f72 $ terraform apply $ terraform apply -auto-approve # \u6467\u6bc1\u7cfb\u7edf $ terraform destroy","title":"\u8fd0\u884c\u6a21\u7248\u786e\u8ba4\u52a8\u4f5c"},{"location":"13%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E5%88%97%E8%A1%A8/","text":"\u5b9a\u4e49 EC2 \u7684Size\u5217\u8868 \u00b6 \u77e5\u8bc6\u70b9 \u00b6 \u4f7f\u7528 list \u5217\u8868\u7c7b\u578b, \u5b9a\u4e49\u591a\u79cd EC2 \u542f\u52a8\u5b9e\u4f8b \u5b98\u7f51 \u00b6 https://www.terraform.io/language/functions/list \u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3 \u00b6 \u5b9a\u4e49 EC2 \u542f\u52a8\u7c7b\u578b\u5217\u8868 \u5728 EC2 \u5b9a\u4e49\u6587\u4ef6\u4e2d\u5f15\u7528\u5217\u8868\u7c7b\u578b \u8fd0\u884c\u6a21\u7248\u786e\u8ba4\u52a8\u4f5c \u64cd\u4f5c\u6b65\u9aa4 \u00b6 \u76ee\u5f55\u7ed3\u6784 \u00b6 . \u251c\u2500\u2500 ec2-aws_ami.tf \u251c\u2500\u2500 ec2-sg.tf \u251c\u2500\u2500 ec2-variables.tf \u251c\u2500\u2500 ec2.tf \u251c\u2500\u2500 main.tf \u2514\u2500\u2500 ec2-outputs.tf \u7f16\u5199 EC2 AMI \u6570\u636e\u6e90\u6587\u4ef6\uff0c \u59cb\u7ec8\u4fdd\u6301\u4f7f\u7528\u6700\u65b0\u7684 AMI \u00b6 ec2-aws_ami.tf data \"aws_ami\" \"myami\" { # \u6700\u65b0\u4f7f\u7528 most_recent = true # amazon\u5b98\u65b9\u8ba4\u8bc1 owners = [ \"amazon\" ] # \u955c\u50cf\u6587\u4ef6\u540d\u79f0\u8fc7\u6ee4 filter { name = \"name\" values = [ \"amzn-ami-hvm-*-x86_64-gp2\" ] } # \u6839\u8bbe\u5907\u8fc7\u6ee4\u6761\u4ef6 filter { name = \"root-device-type\" values = [ \"ebs\" ] } } \u7f16\u5199\u5b89\u5168\u7ec4\u5b9a\u4e49\u6587\u4ef6 \u00b6 ec2-sg.tf # Create Security Group resource \"aws_security_group\" \"learnaws-sg-web-ssh\" { # \u5b89\u5168\u7ec4\u7684\u540d\u79f0 name = \"learnaws-sg-web-ssh\" description = \"Web and SSH\" # \u5b89\u5168\u7ec4\u7684\u5165\u53e3\u63cf\u8ff0 ingress { description = \"Allow Port 80\" from_port = 80 to_port = 80 protocol = \"tcp\" # \u5141\u8bb8\u8303\u56f4\uff0c\u8fd9\u91cc\u662f\u6240\u6709ip\u90fd\u53ef\u8bbf\u95ee cidr_blocks = [ \"0.0.0.0/0\" ] } ingress { description = \"Allow Port 443\" from_port = 443 to_port = 443 protocol = \"tcp\" cidr_blocks = [ \"0.0.0.0/0\" ] } ingress { description = \"Allow Port 22\" from_port = 22 to_port = 22 protocol = \"tcp\" cidr_blocks = [ \"0.0.0.0/0\" ] # cidr_blocks = [\"12.15.55.32/32\"] } # \u5b89\u5168\u7ec4\u7684\u51fa\u53e3\u63cf\u8ff0 egress { description = \"Allow all ip and ports outbound\" from_port = 0 to_port = 0 protocol = \"-1\" cidr_blocks = [ \"0.0.0.0/0\" ] } tags = { Name = \"learnaws-sg-web-ssh\" } } \u5b9a\u4e49 EC2 \u542f\u52a8\u7c7b\u578b\u5217\u8868 \u00b6 ec2-variables.tf # AWS Region variable \"aws_region\" { description = \"AWS Region\" type = string default = \"ap-northeast-1\" } # \u4e4b\u524d\u4f7f\u7528\u7684: AWS EC2 Instance Type # variable \"instance_type\" { # description = \"EC2 Instance Type\" # type = string # default = \"t2.micro\" # } # AWS EC2 Instance Type List variable \"instance_type_list\" { description = \"EC2 Instnace Type\" type = list ( string ) default = [ \"t2.micro\" , \"t3.micro\" , \"t3.small\" ] } \u5728 EC2 \u5b9a\u4e49\u6587\u4ef6\u4e2d\u5f15\u7528\u5217\u8868\u7c7b\u578b \u00b6 ec2.tf ########################################################### # EC2 \u8d44\u6e90\u8bbe\u7f6e resource \"aws_instance\" \"myweb_server2\" { ami = data.aws_ami.myami.id # \u5f15\u7528 EC2 \u542f\u52a8\u7c7b\u578b\u7684list\u5217\u8868\uff0c\u8fd9\u91cc\u5bf9\u5e94\"t3.small\"\u7c7b\u578b instance_type = var.instance_type_list [ 2 ] vpc_security_group_ids = [ aws_security_group.learnaws-sg-web-ssh.id ] tags = { Name = \"learnaws-ec2-from-terraform-cli\" } } \u7f16\u5199 TF \u9879\u76ee\u63cf\u8ff0\u6587\u4ef6 \u00b6 main.tf ########################################################### # Terraform \u57fa\u672c\u8bbe\u7f6e terraform { required_providers { aws = { source = \"hashicorp/aws\" version = \"~> 3.71\" } } required_version = \">= 1.1.3\" } ########################################################### # \u63d0\u4f9b\u5546\u8bbe\u7f6e(\u4e91\u5e73\u53f0) provider \"aws\" { profile = \"learnaws\" region = var.aws_region } \u5b9a\u4e49\u8d44\u6e90\u8f93\u51fa\u663e\u793a\u7684\u5185\u5bb9 \u00b6 ec2-outputs.tf output \"instance_publicip\" { # EC2 \u516c\u6709IP value = aws_instance.myweb_server2.public_ip } output \"instance_availability_zone\" { # \u90e8\u7f72\u7684\u53ef\u7528\u533a value = aws_instance.myweb_server2.availability_zone } output \"instance_ami\" { # \u4f7f\u7528\u7684 AMI value = aws_instance.myweb_server2.ami } output \"instance_private_ip\" { # EC2 \u79c1\u6709\u7f51\u65ad IP value = aws_instance.myweb_server2.private_ip } output \"instance_cpu_core_count\" { # EC2 CPU \u6838\u5fc3\u6570 value = aws_instance.myweb_server2.cpu_core_count } output \"instance_instance_type\" { # EC2 \u5b9e\u4f8b\u7c7b\u578b value = aws_instance.myweb_server2.instance_type } # \u6700\u540e\u8f93\u51fa\u7684\u6837\u5f0f\u5982\u4e0b: # instance_ami = \"ami-0d9f3ffed238c343f\" # instance_availability_zone = \"ap-northeast-1c\" # instance_cpu_core_count = \"1\" # instance_instance_type = \"t3.small\" # instance_private_ip = \"172.31.13.114\" # instance_publicip = \"18.183.155.128\" EC2\u8d44\u6e90\u5c5e\u6027\u53c2\u7167 https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance \u8fd0\u884c\u6a21\u7248\u786e\u8ba4\u52a8\u4f5c \u00b6 # \u76ee\u5f55\u521d\u59cb\u5316 $ terraform init # \u68c0\u9a8c tf \u6587\u4ef6 $ terraform validate # \u5b9e\u65bd\u8ba1\u5212, \u51c6\u5907\u8d44\u6e90 $ terraform plan # \u5e94\u7528\u90e8\u7f72 $ terraform apply $ terraform apply -auto-approve # \u6467\u6bc1\u7cfb\u7edf $ terraform destroy $ terraform destroy -auto-approve","title":"13\u3001\u5b9a\u4e49 EC2 \u7684Size\u5217\u8868"},{"location":"13%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E5%88%97%E8%A1%A8/#ec2-size","text":"","title":"\u5b9a\u4e49 EC2 \u7684Size\u5217\u8868"},{"location":"13%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E5%88%97%E8%A1%A8/#_1","text":"\u4f7f\u7528 list \u5217\u8868\u7c7b\u578b, \u5b9a\u4e49\u591a\u79cd EC2 \u542f\u52a8\u5b9e\u4f8b","title":"\u77e5\u8bc6\u70b9"},{"location":"13%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E5%88%97%E8%A1%A8/#_2","text":"https://www.terraform.io/language/functions/list","title":"\u5b98\u7f51"},{"location":"13%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E5%88%97%E8%A1%A8/#_3","text":"\u5b9a\u4e49 EC2 \u542f\u52a8\u7c7b\u578b\u5217\u8868 \u5728 EC2 \u5b9a\u4e49\u6587\u4ef6\u4e2d\u5f15\u7528\u5217\u8868\u7c7b\u578b \u8fd0\u884c\u6a21\u7248\u786e\u8ba4\u52a8\u4f5c","title":"\u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3"},{"location":"13%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E5%88%97%E8%A1%A8/#_4","text":"","title":"\u64cd\u4f5c\u6b65\u9aa4"},{"location":"13%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E5%88%97%E8%A1%A8/#_5","text":". \u251c\u2500\u2500 ec2-aws_ami.tf \u251c\u2500\u2500 ec2-sg.tf \u251c\u2500\u2500 ec2-variables.tf \u251c\u2500\u2500 ec2.tf \u251c\u2500\u2500 main.tf \u2514\u2500\u2500 ec2-outputs.tf","title":"\u76ee\u5f55\u7ed3\u6784"},{"location":"13%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E5%88%97%E8%A1%A8/#ec2-ami-ami","text":"ec2-aws_ami.tf data \"aws_ami\" \"myami\" { # \u6700\u65b0\u4f7f\u7528 most_recent = true # amazon\u5b98\u65b9\u8ba4\u8bc1 owners = [ \"amazon\" ] # \u955c\u50cf\u6587\u4ef6\u540d\u79f0\u8fc7\u6ee4 filter { name = \"name\" values = [ \"amzn-ami-hvm-*-x86_64-gp2\" ] } # \u6839\u8bbe\u5907\u8fc7\u6ee4\u6761\u4ef6 filter { name = \"root-device-type\" values = [ \"ebs\" ] } }","title":"\u7f16\u5199 EC2 AMI \u6570\u636e\u6e90\u6587\u4ef6\uff0c \u59cb\u7ec8\u4fdd\u6301\u4f7f\u7528\u6700\u65b0\u7684 AMI"},{"location":"13%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E5%88%97%E8%A1%A8/#_6","text":"ec2-sg.tf # Create Security Group resource \"aws_security_group\" \"learnaws-sg-web-ssh\" { # \u5b89\u5168\u7ec4\u7684\u540d\u79f0 name = \"learnaws-sg-web-ssh\" description = \"Web and SSH\" # \u5b89\u5168\u7ec4\u7684\u5165\u53e3\u63cf\u8ff0 ingress { description = \"Allow Port 80\" from_port = 80 to_port = 80 protocol = \"tcp\" # \u5141\u8bb8\u8303\u56f4\uff0c\u8fd9\u91cc\u662f\u6240\u6709ip\u90fd\u53ef\u8bbf\u95ee cidr_blocks = [ \"0.0.0.0/0\" ] } ingress { description = \"Allow Port 443\" from_port = 443 to_port = 443 protocol = \"tcp\" cidr_blocks = [ \"0.0.0.0/0\" ] } ingress { description = \"Allow Port 22\" from_port = 22 to_port = 22 protocol = \"tcp\" cidr_blocks = [ \"0.0.0.0/0\" ] # cidr_blocks = [\"12.15.55.32/32\"] } # \u5b89\u5168\u7ec4\u7684\u51fa\u53e3\u63cf\u8ff0 egress { description = \"Allow all ip and ports outbound\" from_port = 0 to_port = 0 protocol = \"-1\" cidr_blocks = [ \"0.0.0.0/0\" ] } tags = { Name = \"learnaws-sg-web-ssh\" } }","title":"\u7f16\u5199\u5b89\u5168\u7ec4\u5b9a\u4e49\u6587\u4ef6"},{"location":"13%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E5%88%97%E8%A1%A8/#ec2","text":"ec2-variables.tf # AWS Region variable \"aws_region\" { description = \"AWS Region\" type = string default = \"ap-northeast-1\" } # \u4e4b\u524d\u4f7f\u7528\u7684: AWS EC2 Instance Type # variable \"instance_type\" { # description = \"EC2 Instance Type\" # type = string # default = \"t2.micro\" # } # AWS EC2 Instance Type List variable \"instance_type_list\" { description = \"EC2 Instnace Type\" type = list ( string ) default = [ \"t2.micro\" , \"t3.micro\" , \"t3.small\" ] }","title":"\u5b9a\u4e49 EC2 \u542f\u52a8\u7c7b\u578b\u5217\u8868"},{"location":"13%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E5%88%97%E8%A1%A8/#ec2_1","text":"ec2.tf ########################################################### # EC2 \u8d44\u6e90\u8bbe\u7f6e resource \"aws_instance\" \"myweb_server2\" { ami = data.aws_ami.myami.id # \u5f15\u7528 EC2 \u542f\u52a8\u7c7b\u578b\u7684list\u5217\u8868\uff0c\u8fd9\u91cc\u5bf9\u5e94\"t3.small\"\u7c7b\u578b instance_type = var.instance_type_list [ 2 ] vpc_security_group_ids = [ aws_security_group.learnaws-sg-web-ssh.id ] tags = { Name = \"learnaws-ec2-from-terraform-cli\" } }","title":"\u5728 EC2 \u5b9a\u4e49\u6587\u4ef6\u4e2d\u5f15\u7528\u5217\u8868\u7c7b\u578b"},{"location":"13%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E5%88%97%E8%A1%A8/#tf","text":"main.tf ########################################################### # Terraform \u57fa\u672c\u8bbe\u7f6e terraform { required_providers { aws = { source = \"hashicorp/aws\" version = \"~> 3.71\" } } required_version = \">= 1.1.3\" } ########################################################### # \u63d0\u4f9b\u5546\u8bbe\u7f6e(\u4e91\u5e73\u53f0) provider \"aws\" { profile = \"learnaws\" region = var.aws_region }","title":"\u7f16\u5199 TF \u9879\u76ee\u63cf\u8ff0\u6587\u4ef6"},{"location":"13%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E5%88%97%E8%A1%A8/#_7","text":"ec2-outputs.tf output \"instance_publicip\" { # EC2 \u516c\u6709IP value = aws_instance.myweb_server2.public_ip } output \"instance_availability_zone\" { # \u90e8\u7f72\u7684\u53ef\u7528\u533a value = aws_instance.myweb_server2.availability_zone } output \"instance_ami\" { # \u4f7f\u7528\u7684 AMI value = aws_instance.myweb_server2.ami } output \"instance_private_ip\" { # EC2 \u79c1\u6709\u7f51\u65ad IP value = aws_instance.myweb_server2.private_ip } output \"instance_cpu_core_count\" { # EC2 CPU \u6838\u5fc3\u6570 value = aws_instance.myweb_server2.cpu_core_count } output \"instance_instance_type\" { # EC2 \u5b9e\u4f8b\u7c7b\u578b value = aws_instance.myweb_server2.instance_type } # \u6700\u540e\u8f93\u51fa\u7684\u6837\u5f0f\u5982\u4e0b: # instance_ami = \"ami-0d9f3ffed238c343f\" # instance_availability_zone = \"ap-northeast-1c\" # instance_cpu_core_count = \"1\" # instance_instance_type = \"t3.small\" # instance_private_ip = \"172.31.13.114\" # instance_publicip = \"18.183.155.128\" EC2\u8d44\u6e90\u5c5e\u6027\u53c2\u7167 https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance","title":"\u5b9a\u4e49\u8d44\u6e90\u8f93\u51fa\u663e\u793a\u7684\u5185\u5bb9"},{"location":"13%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E5%88%97%E8%A1%A8/#_8","text":"# \u76ee\u5f55\u521d\u59cb\u5316 $ terraform init # \u68c0\u9a8c tf \u6587\u4ef6 $ terraform validate # \u5b9e\u65bd\u8ba1\u5212, \u51c6\u5907\u8d44\u6e90 $ terraform plan # \u5e94\u7528\u90e8\u7f72 $ terraform apply $ terraform apply -auto-approve # \u6467\u6bc1\u7cfb\u7edf $ terraform destroy $ terraform destroy -auto-approve","title":"\u8fd0\u884c\u6a21\u7248\u786e\u8ba4\u52a8\u4f5c"},{"location":"14%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E6%98%A0%E5%B0%84/","text":"\u5b9a\u4e49 EC2 \u7684Size\u6620\u5c04 \u00b6 \u77e5\u8bc6\u70b9 \u00b6 \u4f7f\u7528 map \u6620\u5c04\u7c7b\u578b, \u5b9a\u4e49\u591a\u79cd EC2 \u542f\u52a8\u5b9e\u4f8b \u5b98\u7f51 \u00b6 https://www.terraform.io/language/functions/map \u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3 \u00b6 \u5b9a\u4e49 EC2 \u542f\u52a8\u73af\u5883\u5217\u8868 \u5728 EC2 \u5b9a\u4e49\u6587\u4ef6\u4e2d\u5f15\u7528\u73af\u5883\u7c7b\u578b, \u542f\u52a8 EC2 \u8fd0\u884c\u6a21\u7248\u786e\u8ba4\u52a8\u4f5c \u64cd\u4f5c\u6b65\u9aa4 \u00b6 \u76ee\u5f55\u7ed3\u6784 \u00b6 . \u251c\u2500\u2500 ec2-aws_ami.tf \u251c\u2500\u2500 ec2-sg.tf \u251c\u2500\u2500 ec2-variables.tf \u251c\u2500\u2500 ec2.tf \u251c\u2500\u2500 main.tf \u2514\u2500\u2500 ec2-outputs.tf \u7f16\u5199 EC2 AMI \u6570\u636e\u6e90\u6587\u4ef6\uff0c \u59cb\u7ec8\u4fdd\u6301\u4f7f\u7528\u6700\u65b0\u7684 AMI \u00b6 ec2-aws_ami.tf data \"aws_ami\" \"myami\" { # \u6700\u65b0\u4f7f\u7528 most_recent = true # amazon\u5b98\u65b9\u8ba4\u8bc1 owners = [ \"amazon\" ] # \u955c\u50cf\u6587\u4ef6\u540d\u79f0\u8fc7\u6ee4 filter { name = \"name\" values = [ \"amzn-ami-hvm-*-x86_64-gp2\" ] } # \u6839\u8bbe\u5907\u8fc7\u6ee4\u6761\u4ef6 filter { name = \"root-device-type\" values = [ \"ebs\" ] } } \u7f16\u5199\u5b89\u5168\u7ec4\u5b9a\u4e49\u6587\u4ef6 \u00b6 ec2-sg.tf # Create Security Group resource \"aws_security_group\" \"learnaws-sg-web-ssh\" { # \u5b89\u5168\u7ec4\u7684\u540d\u79f0 name = \"learnaws-sg-web-ssh\" description = \"Web and SSH\" # \u5b89\u5168\u7ec4\u7684\u5165\u53e3\u63cf\u8ff0 ingress { description = \"Allow Port 80\" from_port = 80 to_port = 80 protocol = \"tcp\" # \u5141\u8bb8\u8303\u56f4\uff0c\u8fd9\u91cc\u662f\u6240\u6709ip\u90fd\u53ef\u8bbf\u95ee cidr_blocks = [ \"0.0.0.0/0\" ] } ingress { description = \"Allow Port 443\" from_port = 443 to_port = 443 protocol = \"tcp\" cidr_blocks = [ \"0.0.0.0/0\" ] } ingress { description = \"Allow Port 22\" from_port = 22 to_port = 22 protocol = \"tcp\" cidr_blocks = [ \"0.0.0.0/0\" ] # cidr_blocks = [\"12.15.55.32/32\"] } # \u5b89\u5168\u7ec4\u7684\u51fa\u53e3\u63cf\u8ff0 egress { description = \"Allow all ip and ports outbound\" from_port = 0 to_port = 0 protocol = \"-1\" cidr_blocks = [ \"0.0.0.0/0\" ] } tags = { Name = \"learnaws-sg-web-ssh\" } } \u5b9a\u4e49 EC2 \u542f\u52a8\u73af\u5883\u6620\u5c04 \u00b6 ec2-variables.tf # AWS Region variable \"aws_region\" { description = \"AWS Region\" type = string default = \"ap-northeast-1\" } # AWS EC2 Instance Env variable \"instance_type_env\" { description = \"EC2 Instnace Type Env\" type = map ( string ) default = { \"dev\" = \"t2.micro\" \"prod\" = \"t2.large\" } } \u5728 EC2 \u5b9a\u4e49\u6587\u4ef6\u4e2d\u5f15\u7528\u73af\u5883\u7c7b\u578b, \u542f\u52a8 EC2 \u00b6 ec2.tf ########################################################### # EC2 \u8d44\u6e90\u8bbe\u7f6e resource \"aws_instance\" \"myweb_server2\" { ami = data.aws_ami.myami.id # \u5f15\u7528 EC2 \u542f\u52a8\u7c7b\u578b\u5217\u8868 instance_type = var.instance_type_env [ \"dev\" ] vpc_security_group_ids = [ aws_security_group.learnaws-sg-web-ssh.id ] tags = { Name = \"learnaws-ec2-from-terraform-cli\" } } \u7f16\u5199 TF \u9879\u76ee\u63cf\u8ff0\u6587\u4ef6 \u00b6 main.tf ########################################################### # Terraform \u57fa\u672c\u8bbe\u7f6e terraform { required_providers { aws = { source = \"hashicorp/aws\" version = \"~> 3.71\" } } required_version = \">= 1.1.3\" } ########################################################### # \u63d0\u4f9b\u5546\u8bbe\u7f6e(\u4e91\u5e73\u53f0) provider \"aws\" { profile = \"learnaws\" region = var.aws_region } \u5b9a\u4e49\u8d44\u6e90\u8f93\u51fa\u663e\u793a\u7684\u5185\u5bb9 \u00b6 ec2-outputs.tf output \"instance_publicip\" { # EC2 \u516c\u6709IP value = aws_instance.myweb_server2.public_ip } output \"instance_availability_zone\" { # \u90e8\u7f72\u7684\u53ef\u7528\u533a value = aws_instance.myweb_server2.availability_zone } output \"instance_ami\" { # \u4f7f\u7528\u7684 AMI value = aws_instance.myweb_server2.ami } output \"instance_private_ip\" { # EC2 \u79c1\u6709\u7f51\u65ad IP value = aws_instance.myweb_server2.private_ip } output \"instance_cpu_core_count\" { # EC2 CPU \u6838\u5fc3\u6570 value = aws_instance.myweb_server2.cpu_core_count } output \"instance_instance_type\" { # EC2 \u5b9e\u4f8b\u7c7b\u578b value = aws_instance.myweb_server2.instance_type } # \u6700\u540e\u8f93\u51fa\u7684\u6837\u5f0f\u5982\u4e0b: # instance_ami = \"ami-0d9f3ffed238c343f\" # instance_availability_zone = \"ap-northeast-1c\" # instance_cpu_core_count = \"1\" # instance_instance_type = \"t3.small\" # instance_private_ip = \"172.31.13.114\" # instance_publicip = \"18.183.155.128\" EC2\u8d44\u6e90\u5c5e\u6027\u53c2\u7167 https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance \u8fd0\u884c\u6a21\u7248\u786e\u8ba4\u52a8\u4f5c \u00b6 # \u76ee\u5f55\u521d\u59cb\u5316 $ terraform init # \u68c0\u9a8c tf \u6587\u4ef6 $ terraform validate # \u5b9e\u65bd\u8ba1\u5212, \u51c6\u5907\u8d44\u6e90 $ terraform plan # \u5e94\u7528\u90e8\u7f72 $ terraform apply $ terraform apply -auto-approve # \u6467\u6bc1\u7cfb\u7edf $ terraform destroy $ terraform destroy -auto-approve","title":"14\u3001\u5b9a\u4e49 EC2 \u7684Size\u6620\u5c04"},{"location":"14%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E6%98%A0%E5%B0%84/#ec2-size","text":"","title":"\u5b9a\u4e49 EC2 \u7684Size\u6620\u5c04"},{"location":"14%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E6%98%A0%E5%B0%84/#_1","text":"\u4f7f\u7528 map \u6620\u5c04\u7c7b\u578b, \u5b9a\u4e49\u591a\u79cd EC2 \u542f\u52a8\u5b9e\u4f8b","title":"\u77e5\u8bc6\u70b9"},{"location":"14%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E6%98%A0%E5%B0%84/#_2","text":"https://www.terraform.io/language/functions/map","title":"\u5b98\u7f51"},{"location":"14%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E6%98%A0%E5%B0%84/#_3","text":"\u5b9a\u4e49 EC2 \u542f\u52a8\u73af\u5883\u5217\u8868 \u5728 EC2 \u5b9a\u4e49\u6587\u4ef6\u4e2d\u5f15\u7528\u73af\u5883\u7c7b\u578b, \u542f\u52a8 EC2 \u8fd0\u884c\u6a21\u7248\u786e\u8ba4\u52a8\u4f5c","title":"\u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3"},{"location":"14%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E6%98%A0%E5%B0%84/#_4","text":"","title":"\u64cd\u4f5c\u6b65\u9aa4"},{"location":"14%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E6%98%A0%E5%B0%84/#_5","text":". \u251c\u2500\u2500 ec2-aws_ami.tf \u251c\u2500\u2500 ec2-sg.tf \u251c\u2500\u2500 ec2-variables.tf \u251c\u2500\u2500 ec2.tf \u251c\u2500\u2500 main.tf \u2514\u2500\u2500 ec2-outputs.tf","title":"\u76ee\u5f55\u7ed3\u6784"},{"location":"14%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E6%98%A0%E5%B0%84/#ec2-ami-ami","text":"ec2-aws_ami.tf data \"aws_ami\" \"myami\" { # \u6700\u65b0\u4f7f\u7528 most_recent = true # amazon\u5b98\u65b9\u8ba4\u8bc1 owners = [ \"amazon\" ] # \u955c\u50cf\u6587\u4ef6\u540d\u79f0\u8fc7\u6ee4 filter { name = \"name\" values = [ \"amzn-ami-hvm-*-x86_64-gp2\" ] } # \u6839\u8bbe\u5907\u8fc7\u6ee4\u6761\u4ef6 filter { name = \"root-device-type\" values = [ \"ebs\" ] } }","title":"\u7f16\u5199 EC2 AMI \u6570\u636e\u6e90\u6587\u4ef6\uff0c \u59cb\u7ec8\u4fdd\u6301\u4f7f\u7528\u6700\u65b0\u7684 AMI"},{"location":"14%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E6%98%A0%E5%B0%84/#_6","text":"ec2-sg.tf # Create Security Group resource \"aws_security_group\" \"learnaws-sg-web-ssh\" { # \u5b89\u5168\u7ec4\u7684\u540d\u79f0 name = \"learnaws-sg-web-ssh\" description = \"Web and SSH\" # \u5b89\u5168\u7ec4\u7684\u5165\u53e3\u63cf\u8ff0 ingress { description = \"Allow Port 80\" from_port = 80 to_port = 80 protocol = \"tcp\" # \u5141\u8bb8\u8303\u56f4\uff0c\u8fd9\u91cc\u662f\u6240\u6709ip\u90fd\u53ef\u8bbf\u95ee cidr_blocks = [ \"0.0.0.0/0\" ] } ingress { description = \"Allow Port 443\" from_port = 443 to_port = 443 protocol = \"tcp\" cidr_blocks = [ \"0.0.0.0/0\" ] } ingress { description = \"Allow Port 22\" from_port = 22 to_port = 22 protocol = \"tcp\" cidr_blocks = [ \"0.0.0.0/0\" ] # cidr_blocks = [\"12.15.55.32/32\"] } # \u5b89\u5168\u7ec4\u7684\u51fa\u53e3\u63cf\u8ff0 egress { description = \"Allow all ip and ports outbound\" from_port = 0 to_port = 0 protocol = \"-1\" cidr_blocks = [ \"0.0.0.0/0\" ] } tags = { Name = \"learnaws-sg-web-ssh\" } }","title":"\u7f16\u5199\u5b89\u5168\u7ec4\u5b9a\u4e49\u6587\u4ef6"},{"location":"14%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E6%98%A0%E5%B0%84/#ec2","text":"ec2-variables.tf # AWS Region variable \"aws_region\" { description = \"AWS Region\" type = string default = \"ap-northeast-1\" } # AWS EC2 Instance Env variable \"instance_type_env\" { description = \"EC2 Instnace Type Env\" type = map ( string ) default = { \"dev\" = \"t2.micro\" \"prod\" = \"t2.large\" } }","title":"\u5b9a\u4e49 EC2 \u542f\u52a8\u73af\u5883\u6620\u5c04"},{"location":"14%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E6%98%A0%E5%B0%84/#ec2-ec2","text":"ec2.tf ########################################################### # EC2 \u8d44\u6e90\u8bbe\u7f6e resource \"aws_instance\" \"myweb_server2\" { ami = data.aws_ami.myami.id # \u5f15\u7528 EC2 \u542f\u52a8\u7c7b\u578b\u5217\u8868 instance_type = var.instance_type_env [ \"dev\" ] vpc_security_group_ids = [ aws_security_group.learnaws-sg-web-ssh.id ] tags = { Name = \"learnaws-ec2-from-terraform-cli\" } }","title":"\u5728 EC2 \u5b9a\u4e49\u6587\u4ef6\u4e2d\u5f15\u7528\u73af\u5883\u7c7b\u578b, \u542f\u52a8 EC2"},{"location":"14%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E6%98%A0%E5%B0%84/#tf","text":"main.tf ########################################################### # Terraform \u57fa\u672c\u8bbe\u7f6e terraform { required_providers { aws = { source = \"hashicorp/aws\" version = \"~> 3.71\" } } required_version = \">= 1.1.3\" } ########################################################### # \u63d0\u4f9b\u5546\u8bbe\u7f6e(\u4e91\u5e73\u53f0) provider \"aws\" { profile = \"learnaws\" region = var.aws_region }","title":"\u7f16\u5199 TF \u9879\u76ee\u63cf\u8ff0\u6587\u4ef6"},{"location":"14%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E6%98%A0%E5%B0%84/#_7","text":"ec2-outputs.tf output \"instance_publicip\" { # EC2 \u516c\u6709IP value = aws_instance.myweb_server2.public_ip } output \"instance_availability_zone\" { # \u90e8\u7f72\u7684\u53ef\u7528\u533a value = aws_instance.myweb_server2.availability_zone } output \"instance_ami\" { # \u4f7f\u7528\u7684 AMI value = aws_instance.myweb_server2.ami } output \"instance_private_ip\" { # EC2 \u79c1\u6709\u7f51\u65ad IP value = aws_instance.myweb_server2.private_ip } output \"instance_cpu_core_count\" { # EC2 CPU \u6838\u5fc3\u6570 value = aws_instance.myweb_server2.cpu_core_count } output \"instance_instance_type\" { # EC2 \u5b9e\u4f8b\u7c7b\u578b value = aws_instance.myweb_server2.instance_type } # \u6700\u540e\u8f93\u51fa\u7684\u6837\u5f0f\u5982\u4e0b: # instance_ami = \"ami-0d9f3ffed238c343f\" # instance_availability_zone = \"ap-northeast-1c\" # instance_cpu_core_count = \"1\" # instance_instance_type = \"t3.small\" # instance_private_ip = \"172.31.13.114\" # instance_publicip = \"18.183.155.128\" EC2\u8d44\u6e90\u5c5e\u6027\u53c2\u7167 https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance","title":"\u5b9a\u4e49\u8d44\u6e90\u8f93\u51fa\u663e\u793a\u7684\u5185\u5bb9"},{"location":"14%E3%80%81%E5%AE%9A%E4%B9%89%20EC2%20%E7%9A%84Size%E6%98%A0%E5%B0%84/#_8","text":"# \u76ee\u5f55\u521d\u59cb\u5316 $ terraform init # \u68c0\u9a8c tf \u6587\u4ef6 $ terraform validate # \u5b9e\u65bd\u8ba1\u5212, \u51c6\u5907\u8d44\u6e90 $ terraform plan # \u5e94\u7528\u90e8\u7f72 $ terraform apply $ terraform apply -auto-approve # \u6467\u6bc1\u7cfb\u7edf $ terraform destroy $ terraform destroy -auto-approve","title":"\u8fd0\u884c\u6a21\u7248\u786e\u8ba4\u52a8\u4f5c"},{"location":"15%E3%80%81%E5%90%8C%E6%97%B6%E5%90%AF%E5%8A%A8%E5%A4%9A%E5%8F%B0%20EC2%20%E5%AE%9E%E4%BE%8B/","text":"\u540c\u65f6\u542f\u52a8\u591a\u53f0 EC2 \u5b9e\u4f8b \u00b6 \u77e5\u8bc6\u70b9 \u00b6 \u540c\u65f6\u542f\u52a8\u6307\u5b9a\u53f0\u6570\u7684\u540c\u6837\u914d\u7f6e\u7684 EC2 \u5b9e\u4f8b \u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3 \u00b6 \u4fee\u6539 EC2 \u8d44\u6e90\u914d\u7f6e\uff0c \u8bbe\u7f6e\u542f\u52a8\u6570\u91cf \u4fee\u6539 Outputs \u8f93\u51fa\u5b9a\u4e49(\u7531\u4e8e\u751f\u6210\u591a\u53f0EC2) \u8fd0\u884c\u6a21\u7248\u786e\u8ba4\u52a8\u4f5c \u64cd\u4f5c\u6b65\u9aa4 \u00b6 \u76ee\u5f55\u7ed3\u6784 \u00b6 . \u251c\u2500\u2500 ec2-aws_ami.tf \u251c\u2500\u2500 ec2-sg.tf \u251c\u2500\u2500 ec2-variables.tf \u251c\u2500\u2500 ec2.tf \u251c\u2500\u2500 main.tf \u2514\u2500\u2500 ec2-outputs.tf \u7f16\u5199 EC2 AMI \u6570\u636e\u6e90\u6587\u4ef6\uff0c \u59cb\u7ec8\u4fdd\u6301\u4f7f\u7528\u6700\u65b0\u7684 AMI \u00b6 ec2-aws_ami.tf data \"aws_ami\" \"myami\" { # \u6700\u65b0\u4f7f\u7528 most_recent = true # amazon\u5b98\u65b9\u8ba4\u8bc1 owners = [ \"amazon\" ] # \u955c\u50cf\u6587\u4ef6\u540d\u79f0\u8fc7\u6ee4 filter { name = \"name\" values = [ \"amzn-ami-hvm-*-x86_64-gp2\" ] } # \u6839\u8bbe\u5907\u8fc7\u6ee4\u6761\u4ef6 filter { name = \"root-device-type\" values = [ \"ebs\" ] } } \u7f16\u5199\u5b89\u5168\u7ec4\u5b9a\u4e49\u6587\u4ef6 \u00b6 ec2-sg.tf # Create Security Group resource \"aws_security_group\" \"learnaws-sg-web-ssh\" { # \u5b89\u5168\u7ec4\u7684\u540d\u79f0 name = \"learnaws-sg-web-ssh\" description = \"Web and SSH\" # \u5b89\u5168\u7ec4\u7684\u5165\u53e3\u63cf\u8ff0 ingress { description = \"Allow Port 80\" from_port = 80 to_port = 80 protocol = \"tcp\" # \u5141\u8bb8\u8303\u56f4\uff0c\u8fd9\u91cc\u662f\u6240\u6709ip\u90fd\u53ef\u8bbf\u95ee cidr_blocks = [ \"0.0.0.0/0\" ] } ingress { description = \"Allow Port 443\" from_port = 443 to_port = 443 protocol = \"tcp\" cidr_blocks = [ \"0.0.0.0/0\" ] } ingress { description = \"Allow Port 22\" from_port = 22 to_port = 22 protocol = \"tcp\" cidr_blocks = [ \"0.0.0.0/0\" ] # cidr_blocks = [\"12.15.55.32/32\"] } # \u5b89\u5168\u7ec4\u7684\u51fa\u53e3\u63cf\u8ff0 egress { description = \"Allow all ip and ports outbound\" from_port = 0 to_port = 0 protocol = \"-1\" cidr_blocks = [ \"0.0.0.0/0\" ] } tags = { Name = \"learnaws-sg-web-ssh\" } } \u5b9a\u4e49 EC2 \u542f\u52a8\u73af\u5883\u6620\u5c04 \u00b6 ec2-variables.tf # AWS Region variable \"aws_region\" { description = \"AWS Region\" type = string default = \"ap-northeast-1\" } # AWS EC2 Instance Env variable \"instance_type_env\" { description = \"EC2 Instnace Type Env\" type = map ( string ) default = { \"dev\" = \"t2.micro\" \"prod\" = \"t2.large\" } } \u4fee\u6539 EC2 \u8d44\u6e90\u914d\u7f6e\uff0c \u8bbe\u7f6e\u542f\u52a8\u6570\u91cf \u00b6 ec2.tf ########################################################### # EC2 \u8d44\u6e90\u8bbe\u7f6e resource \"aws_instance\" \"myweb_server2\" { ami = data.aws_ami.myami.id instance_type = var.instance_type_env [ \"dev\" ] vpc_security_group_ids = [ aws_security_group.learnaws-sg-web-ssh.id ] # \u8bbe\u7f6e\u542f\u52a8\u53f0\u6570 count = 3 tags = { # \u4e3a\u751f\u6210\u7684 EC2 \u52a0\u5165\u6807\u7b7e\u7d22\u5f15 Name = \"learnaws-tf-ec2- ${ count .index } \" } } \u7f16\u5199 TF \u9879\u76ee\u63cf\u8ff0\u6587\u4ef6 \u00b6 main.tf ########################################################### # Terraform \u57fa\u672c\u8bbe\u7f6e terraform { required_providers { aws = { source = \"hashicorp/aws\" version = \"~> 3.71\" } } required_version = \">= 1.1.3\" } ########################################################### # \u63d0\u4f9b\u5546\u8bbe\u7f6e(\u4e91\u5e73\u53f0) provider \"aws\" { profile = \"learnaws\" region = var.aws_region } \u4fee\u6539 Outputs \u8f93\u51fa\u5b9a\u4e49(\u7531\u4e8e\u751f\u6210\u591a\u53f0EC2) \u00b6 ec2-outputs.tf output \"instance_instance_type\" { # EC2 \u5b9e\u4f8b\u7c7b\u578b\uff0c\u56e0\u4e3a\u6240\u6709\u7684EC2\u90fd\u662f\u4e00\u6837\u7684\uff0c\u53d6\u7b2c\u4e00\u4e2a\u8f93\u51fa\u5373\u53ef value = aws_instance.myweb_server2 [ 0 ] .instance_type } output \"instance_ami\" { # \u4f7f\u7528\u7684 AMI\uff0c\u56e0\u4e3a\u6240\u6709\u7684EC2\u90fd\u662f\u4e00\u6837\u7684\uff0c\u53d6\u7b2c\u4e00\u4e2a\u8f93\u51fa\u5373\u53ef value = aws_instance.myweb_server2 [ 0 ] .ami } # \u8f93\u51fa\u6240\u6709 EC2 ips output \"instance_publicip\" { description = \"EC2 ips\" value = [ for instance in aws_instance.myweb_server2 : instance.public_ip ] } # \u8f93\u51fa\u6240\u6709 EC2 \u90e8\u7f72\u7684\u53ef\u7528\u533a output \"instance_availability_zone\" { value = aws_instance.myweb_server2 [ * ] .availability_zone } # \u901a\u8fc7 map \u65b9\u5f0f\u8f93\u51fa\u5185\u7f51ip output \"instance_privateip_map\" { value = { for instance in aws_instance.myweb_server2 : instance.id = > instance.private_ip } } # \u901a\u8fc7 map \u65b9\u5f0f\u8f93\u51fa EC2 TagName output \"instance_tagName\" { value = { for instance in aws_instance.myweb_server2 : instance.id = > lookup ( instance.tags, \"Name\" ) } } # \u6700\u540e\u8f93\u51fa\u7684\u6837\u5f0f\u5982\u4e0b: # instance_ami = \"ami-0204e434dddffa5cf\" # instance_availability_zone = [ # \"ap-northeast-1c\", # \"ap-northeast-1c\", # \"ap-northeast-1c\", # ] # instance_instance_type = \"t2.micro\" # instance_privateip_map = { # \"i-03c0f40ee9e65b268\" = \"172.31.5.141\" # \"i-0b4b99fa322384d4e\" = \"172.31.14.184\" # \"i-0f4535c49c555b4c2\" = \"172.31.14.125\" # } # instance_publicip = [ # \"18.183.163.231\", # \"3.115.19.20\", # \"35.78.86.26\", # ] # instance_tagName = { # \"i-03c0f40ee9e65b268\" = \"learnaws-tf-ec2-0\" # \"i-0b4b99fa322384d4e\" = \"learnaws-tf-ec2-2\" # \"i-0f4535c49c555b4c2\" = \"learnaws-tf-ec2-1\" # } EC2\u8d44\u6e90\u5c5e\u6027\u53c2\u7167 https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance \u8fd0\u884c\u6a21\u7248\u786e\u8ba4\u52a8\u4f5c \u00b6 # \u76ee\u5f55\u521d\u59cb\u5316 $ terraform init # \u68c0\u9a8c tf \u6587\u4ef6 $ terraform validate # \u5b9e\u65bd\u8ba1\u5212, \u51c6\u5907\u8d44\u6e90 $ terraform plan # \u5e94\u7528\u90e8\u7f72 $ terraform apply $ terraform apply -auto-approve # \u6467\u6bc1\u7cfb\u7edf $ terraform destroy $ terraform destroy -auto-approve","title":"15\u3001\u540c\u65f6\u542f\u52a8\u591a\u53f0 EC2 \u5b9e\u4f8b"},{"location":"15%E3%80%81%E5%90%8C%E6%97%B6%E5%90%AF%E5%8A%A8%E5%A4%9A%E5%8F%B0%20EC2%20%E5%AE%9E%E4%BE%8B/#ec2","text":"","title":"\u540c\u65f6\u542f\u52a8\u591a\u53f0 EC2 \u5b9e\u4f8b"},{"location":"15%E3%80%81%E5%90%8C%E6%97%B6%E5%90%AF%E5%8A%A8%E5%A4%9A%E5%8F%B0%20EC2%20%E5%AE%9E%E4%BE%8B/#_1","text":"\u540c\u65f6\u542f\u52a8\u6307\u5b9a\u53f0\u6570\u7684\u540c\u6837\u914d\u7f6e\u7684 EC2 \u5b9e\u4f8b","title":"\u77e5\u8bc6\u70b9"},{"location":"15%E3%80%81%E5%90%8C%E6%97%B6%E5%90%AF%E5%8A%A8%E5%A4%9A%E5%8F%B0%20EC2%20%E5%AE%9E%E4%BE%8B/#_2","text":"\u4fee\u6539 EC2 \u8d44\u6e90\u914d\u7f6e\uff0c \u8bbe\u7f6e\u542f\u52a8\u6570\u91cf \u4fee\u6539 Outputs \u8f93\u51fa\u5b9a\u4e49(\u7531\u4e8e\u751f\u6210\u591a\u53f0EC2) \u8fd0\u884c\u6a21\u7248\u786e\u8ba4\u52a8\u4f5c","title":"\u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3"},{"location":"15%E3%80%81%E5%90%8C%E6%97%B6%E5%90%AF%E5%8A%A8%E5%A4%9A%E5%8F%B0%20EC2%20%E5%AE%9E%E4%BE%8B/#_3","text":"","title":"\u64cd\u4f5c\u6b65\u9aa4"},{"location":"15%E3%80%81%E5%90%8C%E6%97%B6%E5%90%AF%E5%8A%A8%E5%A4%9A%E5%8F%B0%20EC2%20%E5%AE%9E%E4%BE%8B/#_4","text":". \u251c\u2500\u2500 ec2-aws_ami.tf \u251c\u2500\u2500 ec2-sg.tf \u251c\u2500\u2500 ec2-variables.tf \u251c\u2500\u2500 ec2.tf \u251c\u2500\u2500 main.tf \u2514\u2500\u2500 ec2-outputs.tf","title":"\u76ee\u5f55\u7ed3\u6784"},{"location":"15%E3%80%81%E5%90%8C%E6%97%B6%E5%90%AF%E5%8A%A8%E5%A4%9A%E5%8F%B0%20EC2%20%E5%AE%9E%E4%BE%8B/#ec2-ami-ami","text":"ec2-aws_ami.tf data \"aws_ami\" \"myami\" { # \u6700\u65b0\u4f7f\u7528 most_recent = true # amazon\u5b98\u65b9\u8ba4\u8bc1 owners = [ \"amazon\" ] # \u955c\u50cf\u6587\u4ef6\u540d\u79f0\u8fc7\u6ee4 filter { name = \"name\" values = [ \"amzn-ami-hvm-*-x86_64-gp2\" ] } # \u6839\u8bbe\u5907\u8fc7\u6ee4\u6761\u4ef6 filter { name = \"root-device-type\" values = [ \"ebs\" ] } }","title":"\u7f16\u5199 EC2 AMI \u6570\u636e\u6e90\u6587\u4ef6\uff0c \u59cb\u7ec8\u4fdd\u6301\u4f7f\u7528\u6700\u65b0\u7684 AMI"},{"location":"15%E3%80%81%E5%90%8C%E6%97%B6%E5%90%AF%E5%8A%A8%E5%A4%9A%E5%8F%B0%20EC2%20%E5%AE%9E%E4%BE%8B/#_5","text":"ec2-sg.tf # Create Security Group resource \"aws_security_group\" \"learnaws-sg-web-ssh\" { # \u5b89\u5168\u7ec4\u7684\u540d\u79f0 name = \"learnaws-sg-web-ssh\" description = \"Web and SSH\" # \u5b89\u5168\u7ec4\u7684\u5165\u53e3\u63cf\u8ff0 ingress { description = \"Allow Port 80\" from_port = 80 to_port = 80 protocol = \"tcp\" # \u5141\u8bb8\u8303\u56f4\uff0c\u8fd9\u91cc\u662f\u6240\u6709ip\u90fd\u53ef\u8bbf\u95ee cidr_blocks = [ \"0.0.0.0/0\" ] } ingress { description = \"Allow Port 443\" from_port = 443 to_port = 443 protocol = \"tcp\" cidr_blocks = [ \"0.0.0.0/0\" ] } ingress { description = \"Allow Port 22\" from_port = 22 to_port = 22 protocol = \"tcp\" cidr_blocks = [ \"0.0.0.0/0\" ] # cidr_blocks = [\"12.15.55.32/32\"] } # \u5b89\u5168\u7ec4\u7684\u51fa\u53e3\u63cf\u8ff0 egress { description = \"Allow all ip and ports outbound\" from_port = 0 to_port = 0 protocol = \"-1\" cidr_blocks = [ \"0.0.0.0/0\" ] } tags = { Name = \"learnaws-sg-web-ssh\" } }","title":"\u7f16\u5199\u5b89\u5168\u7ec4\u5b9a\u4e49\u6587\u4ef6"},{"location":"15%E3%80%81%E5%90%8C%E6%97%B6%E5%90%AF%E5%8A%A8%E5%A4%9A%E5%8F%B0%20EC2%20%E5%AE%9E%E4%BE%8B/#ec2_1","text":"ec2-variables.tf # AWS Region variable \"aws_region\" { description = \"AWS Region\" type = string default = \"ap-northeast-1\" } # AWS EC2 Instance Env variable \"instance_type_env\" { description = \"EC2 Instnace Type Env\" type = map ( string ) default = { \"dev\" = \"t2.micro\" \"prod\" = \"t2.large\" } }","title":"\u5b9a\u4e49 EC2 \u542f\u52a8\u73af\u5883\u6620\u5c04"},{"location":"15%E3%80%81%E5%90%8C%E6%97%B6%E5%90%AF%E5%8A%A8%E5%A4%9A%E5%8F%B0%20EC2%20%E5%AE%9E%E4%BE%8B/#ec2_2","text":"ec2.tf ########################################################### # EC2 \u8d44\u6e90\u8bbe\u7f6e resource \"aws_instance\" \"myweb_server2\" { ami = data.aws_ami.myami.id instance_type = var.instance_type_env [ \"dev\" ] vpc_security_group_ids = [ aws_security_group.learnaws-sg-web-ssh.id ] # \u8bbe\u7f6e\u542f\u52a8\u53f0\u6570 count = 3 tags = { # \u4e3a\u751f\u6210\u7684 EC2 \u52a0\u5165\u6807\u7b7e\u7d22\u5f15 Name = \"learnaws-tf-ec2- ${ count .index } \" } }","title":"\u4fee\u6539 EC2 \u8d44\u6e90\u914d\u7f6e\uff0c \u8bbe\u7f6e\u542f\u52a8\u6570\u91cf"},{"location":"15%E3%80%81%E5%90%8C%E6%97%B6%E5%90%AF%E5%8A%A8%E5%A4%9A%E5%8F%B0%20EC2%20%E5%AE%9E%E4%BE%8B/#tf","text":"main.tf ########################################################### # Terraform \u57fa\u672c\u8bbe\u7f6e terraform { required_providers { aws = { source = \"hashicorp/aws\" version = \"~> 3.71\" } } required_version = \">= 1.1.3\" } ########################################################### # \u63d0\u4f9b\u5546\u8bbe\u7f6e(\u4e91\u5e73\u53f0) provider \"aws\" { profile = \"learnaws\" region = var.aws_region }","title":"\u7f16\u5199 TF \u9879\u76ee\u63cf\u8ff0\u6587\u4ef6"},{"location":"15%E3%80%81%E5%90%8C%E6%97%B6%E5%90%AF%E5%8A%A8%E5%A4%9A%E5%8F%B0%20EC2%20%E5%AE%9E%E4%BE%8B/#outputs-ec2","text":"ec2-outputs.tf output \"instance_instance_type\" { # EC2 \u5b9e\u4f8b\u7c7b\u578b\uff0c\u56e0\u4e3a\u6240\u6709\u7684EC2\u90fd\u662f\u4e00\u6837\u7684\uff0c\u53d6\u7b2c\u4e00\u4e2a\u8f93\u51fa\u5373\u53ef value = aws_instance.myweb_server2 [ 0 ] .instance_type } output \"instance_ami\" { # \u4f7f\u7528\u7684 AMI\uff0c\u56e0\u4e3a\u6240\u6709\u7684EC2\u90fd\u662f\u4e00\u6837\u7684\uff0c\u53d6\u7b2c\u4e00\u4e2a\u8f93\u51fa\u5373\u53ef value = aws_instance.myweb_server2 [ 0 ] .ami } # \u8f93\u51fa\u6240\u6709 EC2 ips output \"instance_publicip\" { description = \"EC2 ips\" value = [ for instance in aws_instance.myweb_server2 : instance.public_ip ] } # \u8f93\u51fa\u6240\u6709 EC2 \u90e8\u7f72\u7684\u53ef\u7528\u533a output \"instance_availability_zone\" { value = aws_instance.myweb_server2 [ * ] .availability_zone } # \u901a\u8fc7 map \u65b9\u5f0f\u8f93\u51fa\u5185\u7f51ip output \"instance_privateip_map\" { value = { for instance in aws_instance.myweb_server2 : instance.id = > instance.private_ip } } # \u901a\u8fc7 map \u65b9\u5f0f\u8f93\u51fa EC2 TagName output \"instance_tagName\" { value = { for instance in aws_instance.myweb_server2 : instance.id = > lookup ( instance.tags, \"Name\" ) } } # \u6700\u540e\u8f93\u51fa\u7684\u6837\u5f0f\u5982\u4e0b: # instance_ami = \"ami-0204e434dddffa5cf\" # instance_availability_zone = [ # \"ap-northeast-1c\", # \"ap-northeast-1c\", # \"ap-northeast-1c\", # ] # instance_instance_type = \"t2.micro\" # instance_privateip_map = { # \"i-03c0f40ee9e65b268\" = \"172.31.5.141\" # \"i-0b4b99fa322384d4e\" = \"172.31.14.184\" # \"i-0f4535c49c555b4c2\" = \"172.31.14.125\" # } # instance_publicip = [ # \"18.183.163.231\", # \"3.115.19.20\", # \"35.78.86.26\", # ] # instance_tagName = { # \"i-03c0f40ee9e65b268\" = \"learnaws-tf-ec2-0\" # \"i-0b4b99fa322384d4e\" = \"learnaws-tf-ec2-2\" # \"i-0f4535c49c555b4c2\" = \"learnaws-tf-ec2-1\" # } EC2\u8d44\u6e90\u5c5e\u6027\u53c2\u7167 https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance","title":"\u4fee\u6539 Outputs \u8f93\u51fa\u5b9a\u4e49(\u7531\u4e8e\u751f\u6210\u591a\u53f0EC2)"},{"location":"15%E3%80%81%E5%90%8C%E6%97%B6%E5%90%AF%E5%8A%A8%E5%A4%9A%E5%8F%B0%20EC2%20%E5%AE%9E%E4%BE%8B/#_6","text":"# \u76ee\u5f55\u521d\u59cb\u5316 $ terraform init # \u68c0\u9a8c tf \u6587\u4ef6 $ terraform validate # \u5b9e\u65bd\u8ba1\u5212, \u51c6\u5907\u8d44\u6e90 $ terraform plan # \u5e94\u7528\u90e8\u7f72 $ terraform apply $ terraform apply -auto-approve # \u6467\u6bc1\u7cfb\u7edf $ terraform destroy $ terraform destroy -auto-approve","title":"\u8fd0\u884c\u6a21\u7248\u786e\u8ba4\u52a8\u4f5c"},{"location":"16%E3%80%81%E6%9F%A5%E8%AF%A2%E5%8F%AF%E7%94%A8%E5%8C%BA%E6%95%B0%E6%8D%AE%E6%BA%90%2C%20%E5%88%86%E5%88%AB%E5%90%AF%E5%8A%A8%20EC2/","text":"\u67e5\u8be2\u53ef\u7528\u533a\u6570\u636e\u6e90, \u5206\u522b\u542f\u52a8 EC2 \u00b6 \u77e5\u8bc6\u70b9 \u00b6 \u5efa\u7acb\u53ef\u7528\u533a\u6570\u636e\u6e90, \u4e3a\u6bcf\u4e2a\u53ef\u7528\u533a\u542f\u7528\u4e00\u4e2a EC2 \u5b98\u7f51 \u00b6 https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/availability_zones \u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3 \u00b6 \u5efa\u7acb\u53ef\u7528\u533a\u6570\u636e\u6e90 \u5728 EC2 \u8d44\u6e90\u63cf\u8ff0\u4e2d\u5e94\u7528\u53ef\u7528\u533a\u6570\u636e\u6e90 \u8fd0\u884c\u6a21\u7248\u786e\u8ba4\u52a8\u4f5c \u64cd\u4f5c\u6b65\u9aa4 \u00b6 \u5efa\u7acb\u53ef\u7528\u533a\u6570\u636e\u6e90 \u00b6 ec2-aws_availability_zones.tf # \u53d6\u5f97\u5df2\u542f\u7528\u7684\u53ef\u7528\u533a\u8d44\u6e90 data \"aws_availability_zones\" \"deeplearnaws_azones\" { filter { # \u533a\u57df\u72b6\u6001 name = \"opt-in-status\" # opt-in-not-required: \u5df2\u542f\u7528\u533a\u57df # not-opted-in: \u672a\u542f\u7528\u533a\u57df # opted-in: \u542f\u7528\u9009\u62e9\u52a0\u5165\u7684\u533a\u57df values = [ \"opt-in-not-required\" ] } } \u7ba1\u7406 AWS \u533a\u57df - \u53c2\u7167\u7f51\u9875 https://docs.aws.amazon.com/zh_cn/general/latest/gr/rande-manage.html $ aws ec2 describe-regions \\ --all-regions \\ --query \"Regions[].[RegionName, OptInStatus]\" \\ --output table \\ --profile deeplearnaws \\ --region ap-northeast-1 \u8f93\u51fa\u53ef\u7528\u533a\u4e00\u89c8 \u00b6 ec2-outputs.tf output \"deeplearnaws_azones\" { # \u8f93\u51fa\u53ef\u7528\u533a\u4e00\u89c8 value = data.aws_availability_zones.deeplearnaws_azones.names } $ terraform plan \u5728 EC2 \u8d44\u6e90\u63cf\u8ff0\u4e2d\u5e94\u7528\u53ef\u7528\u533a\u6570\u636e\u6e90 \u00b6 ec2.tf ########################################################### # EC2 \u8d44\u6e90\u8bbe\u7f6e resource \"aws_instance\" \"myweb_server2\" { ami = data.aws_ami.komaami.id instance_type = var.instance_type_env [ \"dev\" ] vpc_security_group_ids = [ aws_security_group.deeplearnaws-sg-web-ssh.id ] # \u5faa\u73af\u53ef\u7528\u533a\u6570\u636e\u6e90 for_each = toset ( data.aws_availability_zones.deeplearnaws_azones.names ) # \u53d6\u5f97\u6570\u636e\u6e90\u8d4b\u4e88\u53ef\u7528\u533a\u5c5e\u6027 availability_zone = each.key tags = { # \u8d4b\u4e88 tagName \u6807\u7b7e \"Name\" = \"deeplearnaws-tf-ec2- ${ each .key } \" } } \u8fd0\u884c\u6a21\u7248\u786e\u8ba4\u52a8\u4f5c \u00b6 # \u76ee\u5f55\u521d\u59cb\u5316 $ terraform init # \u68c0\u9a8c tf \u6587\u4ef6 $ terraform validate # \u5b9e\u65bd\u8ba1\u5212, \u51c6\u5907\u8d44\u6e90 $ terraform plan # \u5e94\u7528\u90e8\u7f72 $ terraform apply $ terraform apply -auto-approve # \u6467\u6bc1\u7cfb\u7edf $ terraform destroy $ terraform destroy -auto-approve","title":"16\u3001\u67e5\u8be2\u53ef\u7528\u533a\u6570\u636e\u6e90, \u5206\u522b\u542f\u52a8 EC2"},{"location":"16%E3%80%81%E6%9F%A5%E8%AF%A2%E5%8F%AF%E7%94%A8%E5%8C%BA%E6%95%B0%E6%8D%AE%E6%BA%90%2C%20%E5%88%86%E5%88%AB%E5%90%AF%E5%8A%A8%20EC2/#ec2","text":"","title":"\u67e5\u8be2\u53ef\u7528\u533a\u6570\u636e\u6e90, \u5206\u522b\u542f\u52a8 EC2"},{"location":"16%E3%80%81%E6%9F%A5%E8%AF%A2%E5%8F%AF%E7%94%A8%E5%8C%BA%E6%95%B0%E6%8D%AE%E6%BA%90%2C%20%E5%88%86%E5%88%AB%E5%90%AF%E5%8A%A8%20EC2/#_1","text":"\u5efa\u7acb\u53ef\u7528\u533a\u6570\u636e\u6e90, \u4e3a\u6bcf\u4e2a\u53ef\u7528\u533a\u542f\u7528\u4e00\u4e2a EC2","title":"\u77e5\u8bc6\u70b9"},{"location":"16%E3%80%81%E6%9F%A5%E8%AF%A2%E5%8F%AF%E7%94%A8%E5%8C%BA%E6%95%B0%E6%8D%AE%E6%BA%90%2C%20%E5%88%86%E5%88%AB%E5%90%AF%E5%8A%A8%20EC2/#_2","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/availability_zones","title":"\u5b98\u7f51"},{"location":"16%E3%80%81%E6%9F%A5%E8%AF%A2%E5%8F%AF%E7%94%A8%E5%8C%BA%E6%95%B0%E6%8D%AE%E6%BA%90%2C%20%E5%88%86%E5%88%AB%E5%90%AF%E5%8A%A8%20EC2/#_3","text":"\u5efa\u7acb\u53ef\u7528\u533a\u6570\u636e\u6e90 \u5728 EC2 \u8d44\u6e90\u63cf\u8ff0\u4e2d\u5e94\u7528\u53ef\u7528\u533a\u6570\u636e\u6e90 \u8fd0\u884c\u6a21\u7248\u786e\u8ba4\u52a8\u4f5c","title":"\u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3"},{"location":"16%E3%80%81%E6%9F%A5%E8%AF%A2%E5%8F%AF%E7%94%A8%E5%8C%BA%E6%95%B0%E6%8D%AE%E6%BA%90%2C%20%E5%88%86%E5%88%AB%E5%90%AF%E5%8A%A8%20EC2/#_4","text":"","title":"\u64cd\u4f5c\u6b65\u9aa4"},{"location":"16%E3%80%81%E6%9F%A5%E8%AF%A2%E5%8F%AF%E7%94%A8%E5%8C%BA%E6%95%B0%E6%8D%AE%E6%BA%90%2C%20%E5%88%86%E5%88%AB%E5%90%AF%E5%8A%A8%20EC2/#_5","text":"ec2-aws_availability_zones.tf # \u53d6\u5f97\u5df2\u542f\u7528\u7684\u53ef\u7528\u533a\u8d44\u6e90 data \"aws_availability_zones\" \"deeplearnaws_azones\" { filter { # \u533a\u57df\u72b6\u6001 name = \"opt-in-status\" # opt-in-not-required: \u5df2\u542f\u7528\u533a\u57df # not-opted-in: \u672a\u542f\u7528\u533a\u57df # opted-in: \u542f\u7528\u9009\u62e9\u52a0\u5165\u7684\u533a\u57df values = [ \"opt-in-not-required\" ] } } \u7ba1\u7406 AWS \u533a\u57df - \u53c2\u7167\u7f51\u9875 https://docs.aws.amazon.com/zh_cn/general/latest/gr/rande-manage.html $ aws ec2 describe-regions \\ --all-regions \\ --query \"Regions[].[RegionName, OptInStatus]\" \\ --output table \\ --profile deeplearnaws \\ --region ap-northeast-1","title":"\u5efa\u7acb\u53ef\u7528\u533a\u6570\u636e\u6e90"},{"location":"16%E3%80%81%E6%9F%A5%E8%AF%A2%E5%8F%AF%E7%94%A8%E5%8C%BA%E6%95%B0%E6%8D%AE%E6%BA%90%2C%20%E5%88%86%E5%88%AB%E5%90%AF%E5%8A%A8%20EC2/#_6","text":"ec2-outputs.tf output \"deeplearnaws_azones\" { # \u8f93\u51fa\u53ef\u7528\u533a\u4e00\u89c8 value = data.aws_availability_zones.deeplearnaws_azones.names } $ terraform plan","title":"\u8f93\u51fa\u53ef\u7528\u533a\u4e00\u89c8"},{"location":"16%E3%80%81%E6%9F%A5%E8%AF%A2%E5%8F%AF%E7%94%A8%E5%8C%BA%E6%95%B0%E6%8D%AE%E6%BA%90%2C%20%E5%88%86%E5%88%AB%E5%90%AF%E5%8A%A8%20EC2/#ec2_1","text":"ec2.tf ########################################################### # EC2 \u8d44\u6e90\u8bbe\u7f6e resource \"aws_instance\" \"myweb_server2\" { ami = data.aws_ami.komaami.id instance_type = var.instance_type_env [ \"dev\" ] vpc_security_group_ids = [ aws_security_group.deeplearnaws-sg-web-ssh.id ] # \u5faa\u73af\u53ef\u7528\u533a\u6570\u636e\u6e90 for_each = toset ( data.aws_availability_zones.deeplearnaws_azones.names ) # \u53d6\u5f97\u6570\u636e\u6e90\u8d4b\u4e88\u53ef\u7528\u533a\u5c5e\u6027 availability_zone = each.key tags = { # \u8d4b\u4e88 tagName \u6807\u7b7e \"Name\" = \"deeplearnaws-tf-ec2- ${ each .key } \" } }","title":"\u5728 EC2 \u8d44\u6e90\u63cf\u8ff0\u4e2d\u5e94\u7528\u53ef\u7528\u533a\u6570\u636e\u6e90"},{"location":"16%E3%80%81%E6%9F%A5%E8%AF%A2%E5%8F%AF%E7%94%A8%E5%8C%BA%E6%95%B0%E6%8D%AE%E6%BA%90%2C%20%E5%88%86%E5%88%AB%E5%90%AF%E5%8A%A8%20EC2/#_7","text":"# \u76ee\u5f55\u521d\u59cb\u5316 $ terraform init # \u68c0\u9a8c tf \u6587\u4ef6 $ terraform validate # \u5b9e\u65bd\u8ba1\u5212, \u51c6\u5907\u8d44\u6e90 $ terraform plan # \u5e94\u7528\u90e8\u7f72 $ terraform apply $ terraform apply -auto-approve # \u6467\u6bc1\u7cfb\u7edf $ terraform destroy $ terraform destroy -auto-approve","title":"\u8fd0\u884c\u6a21\u7248\u786e\u8ba4\u52a8\u4f5c"},{"location":"1%E3%80%81%E7%AE%80%E4%BB%8B/","text":"Terraform \u4e91\u5e73\u53f0\u7ba1\u7406\u5de5\u5177 \u00b6 \u4f7f\u7528\u7edf\u4e00\u7684\u4e91\u5e73\u53f0\u7ba1\u7406\u5de5\u5177\uff0c\u5b9e\u73b0\u6211\u4eec\u7684\u7406\u5ff5\uff0c\u5373\uff1a \u57fa\u7840\u8bbe\u65bd\u5373\u4ee3\u7801(IaC) \u652f\u6301\u5e73\u53f0 \u00b6 \u4e09\u5927\u4e91\u5e73\u53f0 \u00b6 Amazon Web Services Microsoft Azure Google Cloud Platform \u66f4\u591a\u7684\u5e73\u53f0 \u00b6 https://registry.terraform.io/browse/providers \u5b98\u7f51 \u00b6 https://www.terraform.io/","title":"Terraform \u4e91\u5e73\u53f0\u7ba1\u7406\u5de5\u5177"},{"location":"1%E3%80%81%E7%AE%80%E4%BB%8B/#terraform","text":"\u4f7f\u7528\u7edf\u4e00\u7684\u4e91\u5e73\u53f0\u7ba1\u7406\u5de5\u5177\uff0c\u5b9e\u73b0\u6211\u4eec\u7684\u7406\u5ff5\uff0c\u5373\uff1a \u57fa\u7840\u8bbe\u65bd\u5373\u4ee3\u7801(IaC)","title":"Terraform \u4e91\u5e73\u53f0\u7ba1\u7406\u5de5\u5177"},{"location":"1%E3%80%81%E7%AE%80%E4%BB%8B/#_1","text":"","title":"\u652f\u6301\u5e73\u53f0"},{"location":"1%E3%80%81%E7%AE%80%E4%BB%8B/#_2","text":"Amazon Web Services Microsoft Azure Google Cloud Platform","title":"\u4e09\u5927\u4e91\u5e73\u53f0"},{"location":"1%E3%80%81%E7%AE%80%E4%BB%8B/#_3","text":"https://registry.terraform.io/browse/providers","title":"\u66f4\u591a\u7684\u5e73\u53f0"},{"location":"1%E3%80%81%E7%AE%80%E4%BB%8B/#_4","text":"https://www.terraform.io/","title":"\u5b98\u7f51"},{"location":"2%E3%80%81%E5%AE%89%E8%A3%85%E5%8F%8AAWS%E6%8E%88%E6%9D%83/","text":"\u4e00\u3001Terraform CLI \u5de5\u5177\u7684\u5b89\u88c5 \u00b6 \u77e5\u8bc6\u70b9 \u00b6 Terraform CLI \u5de5\u5177\u7684\u5b89\u88c5 - @macOS @Linux \u5b98\u7f51 \u00b6 https://www.terraform.io/downloads \u64cd\u4f5c\u6b65\u9aa4 \u00b6 \u4ece\u5b98\u7f51\u4e0b\u8f7d\u5b89\u88c5 \u00b6 https://releases.hashicorp.com/terraform/ \u8fd9\u91cc\u9009\u62e9\uff1a terraform_1.3.8_darwin_amd64.zip $ unzip terraform_x.xx.x_darwin_amd64.zip $ mv terraform /usr/local/bin \u5728 macOS \u4e0a\u5b89\u88c5 Terraform CLI \u547d\u4ee4\u884c\u5de5\u5177 \u00b6 https://learn.hashicorp.com/tutorials/terraform/install-cli?in=terraform/aws-get-started ####################################### # \u4f7f\u7528 Homebrew \u5b89\u88c5 Terraform CLI $ brew tap hashicorp/tap # \u6ce8\u518chashicorp\u4fe1\u606f\u5e93 $ brew install hashicorp/tap/terraform # \u5b89\u88c5terraform # \u786e\u8ba4\u5b89\u88c5 $ terraform -help $ terraform version # \u5404\u79cd\u5b50\u547d\u4ee4\u786e\u8ba4 $ terraform -help init # \u521d\u59cb\u5316 $ terraform -help validate # \u9a8c\u8bc1Terraform\u914d\u7f6e\u6587\u4ef6\u7684\u8bed\u6cd5\u662f\u5426\u6b63\u786e $ terraform -help plan # $ terraform -help apply $ terraform -help destroy ####################################### # Homebrew \u672c\u4f53\u66f4\u65b0 $ brew update # \u66f4\u65b0 Terraform CLI $ brew upgrade hashicorp/tap/terraform ####################################### # Tab \u81ea\u52a8\u5b8c\u6210(\u53ef\u9009\u5b89\u88c5, \u6709\u5b89\u5168\u9690\u60a3, \u53ef\u8df3\u8fc7) ## Bash \u7684\u573a\u5408 # $ touch ~/.bashrc ## Zsh \u7684\u573a\u5408 $ touch ~/.zshrc # \u5b89\u88c5 Terraform \u81ea\u52a8\u5b8c\u6210\u5305 $ terraform -install-autocomplete macos\u7cfb\u7edf\u7684Homebrew\u5305\u7ba1\u7406\u5de5\u5177\u5b98\u7f51 \u5728 Linux \u4e0a\u5b89\u88c5 Terraform CLI \u547d\u4ee4\u884c\u5de5\u5177 \u00b6 # \u5b89\u88c5 yum \u7ba1\u7406\u5de5\u5177 - yum-config-manager $ sudo yum install -y yum-utils # \u6ce8\u518c HashiCorp \u4fe1\u606f\u5e93 $ sudo yum-config-manager --add-repo https://rpm.releases.hashicorp.com/AmazonLinux/hashicorp.repo # \u5b89\u88c5 terraform $ sudo yum -y install terraform # \u786e\u8ba4\u5b89\u88c5 $ terraform -help $ terraform version \u4e8c\u3001AWS CLI \u547d\u4ee4\u884c\u5de5\u5177\u5b89\u88c5\u53ca\u8bbe\u7f6e \u00b6 \u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3 \u00b6 \u5b89\u88c5 AWS CLI \u547d\u4ee4\u884c\u5de5\u5177 \u8bbe\u7f6e\u6388\u6743\uff08\u65b9\u5f0f\u4e00\uff09 - \u672c\u5730\u6388\u6743 \u8bbe\u7f6e\u6388\u6743\uff08\u65b9\u5f0f\u4e8c\uff09 - EC2 \u89d2\u8272\u6388\u6743 \u64cd\u4f5c\u6b65\u9aa4 \u00b6 \u5b89\u88c5 AWS CLI \u547d\u4ee4\u884c\u5de5\u5177 \u00b6 https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/install-cliv2.html Docker Linux macOS Windows # \u7248\u672c\u786e\u8ba4 $ aws --version # \u786e\u8ba4\u672c\u5730\u6388\u6743\u6587\u4ef6 $ cat ~/.aws/credentials \u8bbe\u7f6e\u6388\u6743\uff08\u65b9\u5f0f\u4e00\uff09 - \u672c\u5730\u6388\u6743 \u00b6 \u767b\u9646AWS console\uff0c\u8fdb\u5165\u201cIAM\u201d\u9875\u9762\uff0c\u70b9\u51fb \u201c\u7528\u6237\u201d \uff0c\u6dfb\u52a0\u201c\u7528\u6237\u201d\u5e76\u8bbe\u7f6e\u52fe\u9009\u8bbf\u95ee\u7c7b\u578b\u201c\u7f16\u7a0b\u8bbf\u95ee\u201d \u8bbe\u7f6e\u76f8\u5e94\u6743\u9650 \u521b\u5efa\u7528\u6237\uff0c\u5e76\u4fdd\u5b58\u8bbf\u95ee\u5bc6\u94a5\u5bf9\uff08\u6ce8\u610f\u53ea\u663e\u793a\u4e00\u6b21\uff09 \u6388\u6743CLI\u8eab\u4efd ```bash # \u6388\u6743CLI\u8eab\u4efd(\u6307\u5b9aprofile\u65b9\u5f0f - AWS Best Practices) $ aws configure --profile learnaws AWS Access Key ID [None]: FFUff89898u89vxv AWS Secret Access Key [None]: Ahy789yvhjxlFDoajsdflajia90sdfjsaa Default region name [None]: ap-northeast-1 Default output format [None]: json # \u6388\u6743\u8eab\u4efd\u5b58\u50a8\u4f4d\u7f6e( * *\u5185\u5bb9\u6d89\u53ca\u654f\u611f\u4fe1\u606f ****) $ ls ~/.aws # \u5217\u51fa\u6240\u6709\u914d\u7f6e\u6570\u636e $ aws configure list --profile learnaws # \u5217\u51fa\u53ef\u7528\u914d\u7f6e\u6587\u4ef6\u540d\u79f0 $ aws configure list-profiles # \u5217\u51fa\u5f53\u524d\u533a\u7684VPC $ aws ec2 describe-vpcs --profile learnaws # \u67e5\u8be2\u8fc7\u6ee4\u663e\u793a $ aws ec2 describe-vpcs --profile learnaws --query 'Vpcs[].VpcId' # \u5217\u51faS3\u5b58\u50a8\u6876 $ aws s3 ls --profile learnaws ``` bash # \u6b64\u547d\u4ee4\u6765\u9a8c\u8bc1\u60a8\u7684 AWS \u8bbf\u95ee\u5bc6\u94a5\u662f\u5426\u6b63\u786e\uff0c\u4ee5\u53ca\u60a8\u662f\u5426\u5df2\u83b7\u5f97\u5fc5\u8981\u7684 AWS \u8d44\u6e90\u8bbf\u95ee\u6743\u9650\u3002\u5982\u679c\u8be5\u547d\u4ee4\u8fd4\u56de\u60a8\u7684\u8eab\u4efd\u4fe1\u606f(\u8d26\u6237ID\u3001\u7528\u6237ID\u3001ARN)\uff0c\u8868\u793a\u60a8\u5df2\u901a\u8fc7\u8eab\u4efd\u9a8c\u8bc1\uff0c\u5e76\u4e14\u53ef\u4ee5\u5728 AWS \u4e0a\u6267\u884c\u5176\u4ed6\u64cd\u4f5c\u3002\u5982\u679c\u51fa\u73b0\u9519\u8bef\uff0c\u8bf4\u660e\u60a8\u7684\u8bbf\u95ee\u5bc6\u94a5\u65e0\u6548\u6216\u60a8\u6ca1\u6709\u5fc5\u8981\u7684 AWS \u8d44\u6e90\u8bbf\u95ee\u6743\u9650\u3002 $ aws sts get-caller-identity \u8bbe\u7f6e\u6388\u6743\uff08\u65b9\u5f0f\u4e8c\uff09 - \u7ed9EC2\u8fdb\u884c\u89d2\u8272\u6388\u6743 \u00b6 \u4f7f\u7528\u4e0b\u9762\u7684AWS CloudFormation \u6a21\u7248 awsNodeJSEC2.yml \uff0c\u5df2\u7ecf\u8bbe\u7f6e\u597d EC2 \u6743\u9650 Parameters : MyKeyName : Description : Name of EC2 KeyPair Type : AWS::EC2::KeyPair::KeyName Default : learn-aws-ssh-key ConstraintDescription : must input Resources : awsNodeJSEC2 : Type : AWS::EC2::Instance Properties : KeyName : !Ref MyKeyName AvailabilityZone : { \"Fn::Select\" : [ \"0\" , { \"Fn::GetAZs\" : { \"Ref\" : \"AWS::Region\" } }] } ImageId : ami-0218d08a1f9dac831 InstanceType : t3.micro SecurityGroups : - !Ref awsNodeJSSSHWEBSG IamInstanceProfile : !Ref awsNodeJSMyInstanceProfile BlockDeviceMappings : - DeviceName : /dev/xvda Ebs : VolumeType : gp2 VolumeSize : 8 DeleteOnTermination : true Encrypted : false UserData : Fn::Base64 : | #!/bin/bash yum update -y timedatectl set-timezone \"Asia/Tokyo\" localectl set-locale LANG=ja_JP.UTF-8 touch /home/ec2-user/.hushlogin chown ec2-user:ec2-user /home/ec2-user/.hushlogin curl \"https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip\" -o \"/tmp/awscliv2.zip\" unzip /tmp/awscliv2.zip -d /tmp/awscliv2/ /tmp/awscliv2/aws/install curl -sL https://rpm.nodesource.com/setup_14.x | bash - yum install -y gcc-c++ make yum install -y nodejs awsNodeJSSSHWEBSG : Type : AWS::EC2::SecurityGroup Properties : GroupDescription : SSH and Web PORT SecurityGroupIngress : - IpProtocol : tcp FromPort : 22 ToPort : 22 CidrIp : 0.0.0.0/0 - IpProtocol : tcp FromPort : 80 ToPort : 80 CidrIp : 0.0.0.0/0 awsNodeJSAccessRole : Type : \"AWS::IAM::Role\" Properties : AssumeRolePolicyDocument : Version : \"2012-10-17\" Statement : - Effect : \"Allow\" Principal : Service : - \"ec2.amazonaws.com\" Action : - \"sts:AssumeRole\" Path : \"/\" ManagedPolicyArns : - arn:aws:iam::aws:policy/AdministratorAccess awsNodeJSMyInstanceProfile : Type : \"AWS::IAM::InstanceProfile\" Properties : Path : \"/\" Roles : - !Ref awsNodeJSAccessRole awsNodeJSEIP : Type : AWS::EC2::EIP Properties : InstanceId : !Ref awsNodeJSEC2 \u4e09\u3001VSCode \u63d2\u4ef6\u5b89\u88c5 \u00b6 \u5728 VSCode \u4e2d\u5b89\u88c5 Terraform \u63d2\u4ef6 \u5b98\u7f51 \u00b6 https://marketplace.visualstudio.com/items?itemName=HashiCorp.terraform \u64cd\u4f5c\u6b65\u9aa4 \u00b6 \u5728 VSCode \u4e2d\u5b89\u88c5 Terraform \u63d2\u4ef6 \u00b6 \u5728 VSCode \u4e2d\u641c\u7d22\u6269\u5c55 HashiCorp Terraform\uff0c \u7136\u540e\u5b89\u88c5\u3002","title":"2\u3001\u5b89\u88c5\u53caAWS\u6388\u6743"},{"location":"2%E3%80%81%E5%AE%89%E8%A3%85%E5%8F%8AAWS%E6%8E%88%E6%9D%83/#terraform-cli","text":"","title":"\u4e00\u3001Terraform CLI \u5de5\u5177\u7684\u5b89\u88c5"},{"location":"2%E3%80%81%E5%AE%89%E8%A3%85%E5%8F%8AAWS%E6%8E%88%E6%9D%83/#_1","text":"Terraform CLI \u5de5\u5177\u7684\u5b89\u88c5 - @macOS @Linux","title":"\u77e5\u8bc6\u70b9"},{"location":"2%E3%80%81%E5%AE%89%E8%A3%85%E5%8F%8AAWS%E6%8E%88%E6%9D%83/#_2","text":"https://www.terraform.io/downloads","title":"\u5b98\u7f51"},{"location":"2%E3%80%81%E5%AE%89%E8%A3%85%E5%8F%8AAWS%E6%8E%88%E6%9D%83/#_3","text":"","title":"\u64cd\u4f5c\u6b65\u9aa4"},{"location":"2%E3%80%81%E5%AE%89%E8%A3%85%E5%8F%8AAWS%E6%8E%88%E6%9D%83/#_4","text":"https://releases.hashicorp.com/terraform/ \u8fd9\u91cc\u9009\u62e9\uff1a terraform_1.3.8_darwin_amd64.zip $ unzip terraform_x.xx.x_darwin_amd64.zip $ mv terraform /usr/local/bin","title":"\u4ece\u5b98\u7f51\u4e0b\u8f7d\u5b89\u88c5"},{"location":"2%E3%80%81%E5%AE%89%E8%A3%85%E5%8F%8AAWS%E6%8E%88%E6%9D%83/#macos-terraform-cli","text":"https://learn.hashicorp.com/tutorials/terraform/install-cli?in=terraform/aws-get-started ####################################### # \u4f7f\u7528 Homebrew \u5b89\u88c5 Terraform CLI $ brew tap hashicorp/tap # \u6ce8\u518chashicorp\u4fe1\u606f\u5e93 $ brew install hashicorp/tap/terraform # \u5b89\u88c5terraform # \u786e\u8ba4\u5b89\u88c5 $ terraform -help $ terraform version # \u5404\u79cd\u5b50\u547d\u4ee4\u786e\u8ba4 $ terraform -help init # \u521d\u59cb\u5316 $ terraform -help validate # \u9a8c\u8bc1Terraform\u914d\u7f6e\u6587\u4ef6\u7684\u8bed\u6cd5\u662f\u5426\u6b63\u786e $ terraform -help plan # $ terraform -help apply $ terraform -help destroy ####################################### # Homebrew \u672c\u4f53\u66f4\u65b0 $ brew update # \u66f4\u65b0 Terraform CLI $ brew upgrade hashicorp/tap/terraform ####################################### # Tab \u81ea\u52a8\u5b8c\u6210(\u53ef\u9009\u5b89\u88c5, \u6709\u5b89\u5168\u9690\u60a3, \u53ef\u8df3\u8fc7) ## Bash \u7684\u573a\u5408 # $ touch ~/.bashrc ## Zsh \u7684\u573a\u5408 $ touch ~/.zshrc # \u5b89\u88c5 Terraform \u81ea\u52a8\u5b8c\u6210\u5305 $ terraform -install-autocomplete macos\u7cfb\u7edf\u7684Homebrew\u5305\u7ba1\u7406\u5de5\u5177\u5b98\u7f51","title":"\u5728 macOS \u4e0a\u5b89\u88c5 Terraform CLI \u547d\u4ee4\u884c\u5de5\u5177"},{"location":"2%E3%80%81%E5%AE%89%E8%A3%85%E5%8F%8AAWS%E6%8E%88%E6%9D%83/#linux-terraform-cli","text":"# \u5b89\u88c5 yum \u7ba1\u7406\u5de5\u5177 - yum-config-manager $ sudo yum install -y yum-utils # \u6ce8\u518c HashiCorp \u4fe1\u606f\u5e93 $ sudo yum-config-manager --add-repo https://rpm.releases.hashicorp.com/AmazonLinux/hashicorp.repo # \u5b89\u88c5 terraform $ sudo yum -y install terraform # \u786e\u8ba4\u5b89\u88c5 $ terraform -help $ terraform version","title":"\u5728 Linux \u4e0a\u5b89\u88c5 Terraform CLI \u547d\u4ee4\u884c\u5de5\u5177"},{"location":"2%E3%80%81%E5%AE%89%E8%A3%85%E5%8F%8AAWS%E6%8E%88%E6%9D%83/#aws-cli","text":"","title":"\u4e8c\u3001AWS CLI \u547d\u4ee4\u884c\u5de5\u5177\u5b89\u88c5\u53ca\u8bbe\u7f6e"},{"location":"2%E3%80%81%E5%AE%89%E8%A3%85%E5%8F%8AAWS%E6%8E%88%E6%9D%83/#_5","text":"\u5b89\u88c5 AWS CLI \u547d\u4ee4\u884c\u5de5\u5177 \u8bbe\u7f6e\u6388\u6743\uff08\u65b9\u5f0f\u4e00\uff09 - \u672c\u5730\u6388\u6743 \u8bbe\u7f6e\u6388\u6743\uff08\u65b9\u5f0f\u4e8c\uff09 - EC2 \u89d2\u8272\u6388\u6743","title":"\u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3"},{"location":"2%E3%80%81%E5%AE%89%E8%A3%85%E5%8F%8AAWS%E6%8E%88%E6%9D%83/#_6","text":"","title":"\u64cd\u4f5c\u6b65\u9aa4"},{"location":"2%E3%80%81%E5%AE%89%E8%A3%85%E5%8F%8AAWS%E6%8E%88%E6%9D%83/#aws-cli_1","text":"https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/install-cliv2.html Docker Linux macOS Windows # \u7248\u672c\u786e\u8ba4 $ aws --version # \u786e\u8ba4\u672c\u5730\u6388\u6743\u6587\u4ef6 $ cat ~/.aws/credentials","title":"\u5b89\u88c5 AWS CLI \u547d\u4ee4\u884c\u5de5\u5177"},{"location":"2%E3%80%81%E5%AE%89%E8%A3%85%E5%8F%8AAWS%E6%8E%88%E6%9D%83/#-","text":"\u767b\u9646AWS console\uff0c\u8fdb\u5165\u201cIAM\u201d\u9875\u9762\uff0c\u70b9\u51fb \u201c\u7528\u6237\u201d \uff0c\u6dfb\u52a0\u201c\u7528\u6237\u201d\u5e76\u8bbe\u7f6e\u52fe\u9009\u8bbf\u95ee\u7c7b\u578b\u201c\u7f16\u7a0b\u8bbf\u95ee\u201d \u8bbe\u7f6e\u76f8\u5e94\u6743\u9650 \u521b\u5efa\u7528\u6237\uff0c\u5e76\u4fdd\u5b58\u8bbf\u95ee\u5bc6\u94a5\u5bf9\uff08\u6ce8\u610f\u53ea\u663e\u793a\u4e00\u6b21\uff09 \u6388\u6743CLI\u8eab\u4efd ```bash # \u6388\u6743CLI\u8eab\u4efd(\u6307\u5b9aprofile\u65b9\u5f0f - AWS Best Practices) $ aws configure --profile learnaws AWS Access Key ID [None]: FFUff89898u89vxv AWS Secret Access Key [None]: Ahy789yvhjxlFDoajsdflajia90sdfjsaa Default region name [None]: ap-northeast-1 Default output format [None]: json # \u6388\u6743\u8eab\u4efd\u5b58\u50a8\u4f4d\u7f6e( * *\u5185\u5bb9\u6d89\u53ca\u654f\u611f\u4fe1\u606f ****) $ ls ~/.aws # \u5217\u51fa\u6240\u6709\u914d\u7f6e\u6570\u636e $ aws configure list --profile learnaws # \u5217\u51fa\u53ef\u7528\u914d\u7f6e\u6587\u4ef6\u540d\u79f0 $ aws configure list-profiles # \u5217\u51fa\u5f53\u524d\u533a\u7684VPC $ aws ec2 describe-vpcs --profile learnaws # \u67e5\u8be2\u8fc7\u6ee4\u663e\u793a $ aws ec2 describe-vpcs --profile learnaws --query 'Vpcs[].VpcId' # \u5217\u51faS3\u5b58\u50a8\u6876 $ aws s3 ls --profile learnaws ``` bash # \u6b64\u547d\u4ee4\u6765\u9a8c\u8bc1\u60a8\u7684 AWS \u8bbf\u95ee\u5bc6\u94a5\u662f\u5426\u6b63\u786e\uff0c\u4ee5\u53ca\u60a8\u662f\u5426\u5df2\u83b7\u5f97\u5fc5\u8981\u7684 AWS \u8d44\u6e90\u8bbf\u95ee\u6743\u9650\u3002\u5982\u679c\u8be5\u547d\u4ee4\u8fd4\u56de\u60a8\u7684\u8eab\u4efd\u4fe1\u606f(\u8d26\u6237ID\u3001\u7528\u6237ID\u3001ARN)\uff0c\u8868\u793a\u60a8\u5df2\u901a\u8fc7\u8eab\u4efd\u9a8c\u8bc1\uff0c\u5e76\u4e14\u53ef\u4ee5\u5728 AWS \u4e0a\u6267\u884c\u5176\u4ed6\u64cd\u4f5c\u3002\u5982\u679c\u51fa\u73b0\u9519\u8bef\uff0c\u8bf4\u660e\u60a8\u7684\u8bbf\u95ee\u5bc6\u94a5\u65e0\u6548\u6216\u60a8\u6ca1\u6709\u5fc5\u8981\u7684 AWS \u8d44\u6e90\u8bbf\u95ee\u6743\u9650\u3002 $ aws sts get-caller-identity","title":"\u8bbe\u7f6e\u6388\u6743\uff08\u65b9\u5f0f\u4e00\uff09 - \u672c\u5730\u6388\u6743"},{"location":"2%E3%80%81%E5%AE%89%E8%A3%85%E5%8F%8AAWS%E6%8E%88%E6%9D%83/#-ec2","text":"\u4f7f\u7528\u4e0b\u9762\u7684AWS CloudFormation \u6a21\u7248 awsNodeJSEC2.yml \uff0c\u5df2\u7ecf\u8bbe\u7f6e\u597d EC2 \u6743\u9650 Parameters : MyKeyName : Description : Name of EC2 KeyPair Type : AWS::EC2::KeyPair::KeyName Default : learn-aws-ssh-key ConstraintDescription : must input Resources : awsNodeJSEC2 : Type : AWS::EC2::Instance Properties : KeyName : !Ref MyKeyName AvailabilityZone : { \"Fn::Select\" : [ \"0\" , { \"Fn::GetAZs\" : { \"Ref\" : \"AWS::Region\" } }] } ImageId : ami-0218d08a1f9dac831 InstanceType : t3.micro SecurityGroups : - !Ref awsNodeJSSSHWEBSG IamInstanceProfile : !Ref awsNodeJSMyInstanceProfile BlockDeviceMappings : - DeviceName : /dev/xvda Ebs : VolumeType : gp2 VolumeSize : 8 DeleteOnTermination : true Encrypted : false UserData : Fn::Base64 : | #!/bin/bash yum update -y timedatectl set-timezone \"Asia/Tokyo\" localectl set-locale LANG=ja_JP.UTF-8 touch /home/ec2-user/.hushlogin chown ec2-user:ec2-user /home/ec2-user/.hushlogin curl \"https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip\" -o \"/tmp/awscliv2.zip\" unzip /tmp/awscliv2.zip -d /tmp/awscliv2/ /tmp/awscliv2/aws/install curl -sL https://rpm.nodesource.com/setup_14.x | bash - yum install -y gcc-c++ make yum install -y nodejs awsNodeJSSSHWEBSG : Type : AWS::EC2::SecurityGroup Properties : GroupDescription : SSH and Web PORT SecurityGroupIngress : - IpProtocol : tcp FromPort : 22 ToPort : 22 CidrIp : 0.0.0.0/0 - IpProtocol : tcp FromPort : 80 ToPort : 80 CidrIp : 0.0.0.0/0 awsNodeJSAccessRole : Type : \"AWS::IAM::Role\" Properties : AssumeRolePolicyDocument : Version : \"2012-10-17\" Statement : - Effect : \"Allow\" Principal : Service : - \"ec2.amazonaws.com\" Action : - \"sts:AssumeRole\" Path : \"/\" ManagedPolicyArns : - arn:aws:iam::aws:policy/AdministratorAccess awsNodeJSMyInstanceProfile : Type : \"AWS::IAM::InstanceProfile\" Properties : Path : \"/\" Roles : - !Ref awsNodeJSAccessRole awsNodeJSEIP : Type : AWS::EC2::EIP Properties : InstanceId : !Ref awsNodeJSEC2","title":"\u8bbe\u7f6e\u6388\u6743\uff08\u65b9\u5f0f\u4e8c\uff09 - \u7ed9EC2\u8fdb\u884c\u89d2\u8272\u6388\u6743"},{"location":"2%E3%80%81%E5%AE%89%E8%A3%85%E5%8F%8AAWS%E6%8E%88%E6%9D%83/#vscode","text":"\u5728 VSCode \u4e2d\u5b89\u88c5 Terraform \u63d2\u4ef6","title":"\u4e09\u3001VSCode \u63d2\u4ef6\u5b89\u88c5"},{"location":"2%E3%80%81%E5%AE%89%E8%A3%85%E5%8F%8AAWS%E6%8E%88%E6%9D%83/#_7","text":"https://marketplace.visualstudio.com/items?itemName=HashiCorp.terraform","title":"\u5b98\u7f51"},{"location":"2%E3%80%81%E5%AE%89%E8%A3%85%E5%8F%8AAWS%E6%8E%88%E6%9D%83/#_8","text":"","title":"\u64cd\u4f5c\u6b65\u9aa4"},{"location":"2%E3%80%81%E5%AE%89%E8%A3%85%E5%8F%8AAWS%E6%8E%88%E6%9D%83/#vscode-terraform","text":"\u5728 VSCode \u4e2d\u641c\u7d22\u6269\u5c55 HashiCorp Terraform\uff0c \u7136\u540e\u5b89\u88c5\u3002","title":"\u5728 VSCode \u4e2d\u5b89\u88c5 Terraform \u63d2\u4ef6"},{"location":"3%E3%80%81Terraform%20%E5%B7%A5%E4%BD%9C%E6%B5%81/","text":"Terraform \u5de5\u4f5c\u6d41 \u00b6 \u5b98\u7f51 \u00b6 https://www.terraform.io/intro/core-workflow \u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3 \u00b6 \u770b\u56fe\u8bf4\u8bdd \u521d\u59cb\u5316 - init \u6821\u9a8c\u6587\u4ef6 - validate \u8ba1\u5212\u5b9e\u65bd - plan \u5e94\u7528\u90e8\u7f72 - apply \u6467\u6bc1\u7cfb\u7edf - destroy \u64cd\u4f5c\u6b65\u9aa4 \u00b6 \u521d\u59cb\u5316 - init \u00b6 $ terraform init \u521d\u59cb\u5316\u5de5\u4f5c\u6587\u4ef6\u5939 \u51c6\u5907\u63d0\u4f9b\u5546\u7ec4\u4ef6 \u6821\u9a8c\u6587\u4ef6 - validate \u00b6 $ terraform validate \u7f16\u8bd1\u6821\u9a8c\u672c\u5730\u90e8\u7f72\u6587\u4ef6\uff0c \u786e\u4fdd\u6b63\u786e\u65e0\u8bef \u8ba1\u5212\u5b9e\u65bd - plan \u00b6 $ terraform plan \u6839\u636e\u672c\u5730\u90e8\u7f72\u6587\u4ef6\uff0c \u6839\u636e\u4e0d\u540c\u7684\u4e91\u63d0\u4f9b\u5546\uff0c \u5efa\u7acb\u4e0d\u540c\u7684\u90e8\u7f72\u5b9e\u65bd\u8ba1\u5212 \u5e94\u7528\u90e8\u7f72 - apply \u00b6 $ terraform apply \u5e94\u7528\u90e8\u7f72\u5230\u5404\u4e2a\u4e91\u5e73\u53f0 \u6467\u6bc1\u7cfb\u7edf - destroy \u00b6 $ terraform destroy \u7cfb\u7edf\u5468\u671f\u5b8c\u6210\u65f6\uff0c \u6467\u6bc1\u7cfb\u7edf","title":"Terraform \u5de5\u4f5c\u6d41"},{"location":"3%E3%80%81Terraform%20%E5%B7%A5%E4%BD%9C%E6%B5%81/#terraform","text":"","title":"Terraform \u5de5\u4f5c\u6d41"},{"location":"3%E3%80%81Terraform%20%E5%B7%A5%E4%BD%9C%E6%B5%81/#_1","text":"https://www.terraform.io/intro/core-workflow","title":"\u5b98\u7f51"},{"location":"3%E3%80%81Terraform%20%E5%B7%A5%E4%BD%9C%E6%B5%81/#_2","text":"\u770b\u56fe\u8bf4\u8bdd \u521d\u59cb\u5316 - init \u6821\u9a8c\u6587\u4ef6 - validate \u8ba1\u5212\u5b9e\u65bd - plan \u5e94\u7528\u90e8\u7f72 - apply \u6467\u6bc1\u7cfb\u7edf - destroy","title":"\u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3"},{"location":"3%E3%80%81Terraform%20%E5%B7%A5%E4%BD%9C%E6%B5%81/#_3","text":"","title":"\u64cd\u4f5c\u6b65\u9aa4"},{"location":"3%E3%80%81Terraform%20%E5%B7%A5%E4%BD%9C%E6%B5%81/#-init","text":"$ terraform init \u521d\u59cb\u5316\u5de5\u4f5c\u6587\u4ef6\u5939 \u51c6\u5907\u63d0\u4f9b\u5546\u7ec4\u4ef6","title":"\u521d\u59cb\u5316 - init"},{"location":"3%E3%80%81Terraform%20%E5%B7%A5%E4%BD%9C%E6%B5%81/#-validate","text":"$ terraform validate \u7f16\u8bd1\u6821\u9a8c\u672c\u5730\u90e8\u7f72\u6587\u4ef6\uff0c \u786e\u4fdd\u6b63\u786e\u65e0\u8bef","title":"\u6821\u9a8c\u6587\u4ef6 - validate"},{"location":"3%E3%80%81Terraform%20%E5%B7%A5%E4%BD%9C%E6%B5%81/#-plan","text":"$ terraform plan \u6839\u636e\u672c\u5730\u90e8\u7f72\u6587\u4ef6\uff0c \u6839\u636e\u4e0d\u540c\u7684\u4e91\u63d0\u4f9b\u5546\uff0c \u5efa\u7acb\u4e0d\u540c\u7684\u90e8\u7f72\u5b9e\u65bd\u8ba1\u5212","title":"\u8ba1\u5212\u5b9e\u65bd - plan"},{"location":"3%E3%80%81Terraform%20%E5%B7%A5%E4%BD%9C%E6%B5%81/#-apply","text":"$ terraform apply \u5e94\u7528\u90e8\u7f72\u5230\u5404\u4e2a\u4e91\u5e73\u53f0","title":"\u5e94\u7528\u90e8\u7f72 - apply"},{"location":"3%E3%80%81Terraform%20%E5%B7%A5%E4%BD%9C%E6%B5%81/#-destroy","text":"$ terraform destroy \u7cfb\u7edf\u5468\u671f\u5b8c\u6210\u65f6\uff0c \u6467\u6bc1\u7cfb\u7edf","title":"\u6467\u6bc1\u7cfb\u7edf - destroy"},{"location":"4%E3%80%81%E5%BF%AB%E9%80%9F%E5%BB%BA%E7%AB%8B%E7%AC%AC%E4%B8%80%E4%B8%AA%20EC2%20%E5%AE%9E%E4%BE%8B%20-%20%E6%9C%AC%E5%9C%B0%E6%8E%88%E6%9D%83%E6%96%B9%E5%BC%8F/","text":"\u5feb\u901f\u5efa\u7acb\u7b2c\u4e00\u4e2a EC2 \u5b9e\u4f8b - \u672c\u5730\u6388\u6743\u65b9\u5f0f \u00b6 \u77e5\u8bc6\u70b9 \u00b6 \u4f7f\u7528 Terraform \u5feb\u901f\u5efa\u7acb\u7b2c\u4e00\u4e2a EC2 \u5b9e\u4f8b \u5b98\u7f51 \u00b6 https://registry.terraform.io/ Terraform Registry\u662fTerraform\u7684\u6ce8\u518c\u673a\uff0c\u76f8\u5f53\u4e8ejava\u7684maven\u3001Nodejs\u7684NPMjs\uff0c\u8fd9\u91cc\u96c6\u6210\u4e86\u6240\u4ee5Terraform\u7684\u4e2d\u95f4\u4ef6\uff0c\u4e3b\u8981\u5206\u4e3a\u4e24\u4e2a\u7c7b\u578b\uff1a Providers\uff1a\u63d0\u4f9b\u5668\uff0c\u51e0\u4e4e\u662f\u5b98\u65b9\u7ef4\u62a4\u3002\u4f8b\u5982\u8981\u5efa\u7acbAWS\u57fa\u4e8eTerraform\u7684\u5e73\u53f0\uff0c\u5c31\u9700\u8981AWS\u7684\u63d0\u4f9b\u5668\u6765\u652f\u6301\u540e\u7aef\u7684\u4e91\u5e73\u53f0\u3002 Modules\uff1a\u6a21\u5757\uff0c\u51e0\u4e4e\u662f\u4e2a\u4eba\u6216\u7ec4\u7ec7\u7ef4\u62a4\u3002\u6709\u4e86\u4e0a\u9762\u5f88\u591a\u7684\u63d0\u4f9b\u5668\uff0c\u60f3\u9ad8\u6548\u7684\u4f7f\u7528\u5c31\u9700\u8981\u7528\u5230\u6a21\u5757\u3002 \u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3 \u00b6 \u5efa\u7acb\u672c\u5730 Terraform \u6587\u4ef6, (\u7b80\u79f0 tf \u6587\u4ef6) \u9075\u5faa Terraform \u5de5\u4f5c\u6d41\u7a0b\u5b8c\u6210\u8d44\u6e90\u90e8\u7f72 - init\u3001validate\u3001plan\u3001apply\u3001destroy \u52a8\u4f5c\u786e\u8ba4 \u64cd\u4f5c\u6b65\u9aa4 \u00b6 \u5efa\u7acb\u672c\u5730 Terraform \u6587\u4ef6, (\u7b80\u79f0 tf \u6587\u4ef6) \u00b6 $ mkdir awstf $ cd awstf $ vim main.tf main.tf ########################################################### # Terraform \u57fa\u672c\u8bbe\u7f6e terraform { # \u58f0\u660eprovider required_providers { # https://registry.terraform.io/browse/providers aws = { source = \"hashicorp/aws\" version = \"~> 3.74\" } } # \u58f0\u660eTerraform\u7248\u672c required_version = \">= 1.1.4\" } ########################################################### # \u63d0\u4f9b\u5546\u8bbe\u7f6e(\u4e91\u5e73\u53f0) # \u63cf\u8ff0AWS Provider # https://registry.terraform.io/providers/hashicorp/aws/latest provider \"aws\" { # ~/.aws/credentials\u6587\u4ef6\u7684[name] profile = \"learnaws\" region = \"ap-northeast-1\" } ########################################################### # \u63cf\u8ff0\u8981\u751f\u6210\u7684\u8d44\u6e90\u8bbe\u7f6e # https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ami # https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance resource \"aws_instance\" \"myweb_server\" { ami = \"ami-0218d08a1f9dac831\" instance_type = \"t3.micro\" tags = { Name = \"learnaws-ec2-from-terraform\" } } \u9075\u5faa Terraform \u5de5\u4f5c\u6d41\u7a0b\u5b8c\u6210\u8d44\u6e90\u90e8\u7f72 \u00b6 # \u76ee\u5f55\u521d\u59cb\u5316\uff08\u4f1a\u73b0\u5728\u5fc5\u8981\u7684\u5b89\u88c5\u5305\u548cprovider\uff09 $ terraform init # \u786e\u8ba4\u63d0\u4f9b\u5546\u7ba1\u7406\u6587\u4ef6, \u8be5\u6587\u4ef6\u8bb0\u5f55\u5177\u4f53\u7684\u63d0\u4f9b\u5546\u7248\u672c\u4fe1\u606f, \u5e94\u8be5\u5305\u542b\u5230\u6e90\u4ee3\u7801\u4fe1\u606f\u5e93\u4e2d $ ls -a $ cat .terraform.lock.hcl # \u68c0\u9a8c tf \u6587\u4ef6 $ terraform validate # \u5b9e\u65bd\u8ba1\u5212, \u51c6\u5907\u8d44\u6e90 $ terraform plan ... >Plan: 1 to add, 0 to change, 0 to destroy. # \u5e94\u7528\u90e8\u7f72 $ terraform apply ... >Apply complete! Resources: 1 added, 0 changed, 0 destroyed. # \u6467\u6bc1\u7cfb\u7edf\uff0c\u5373\u628a\u5f53\u524dtf\u811a\u672c\u63cf\u8ff0\u7684\u6240\u6709\u8d44\u6e90\u5168\u90e8\u6467\u6bc1 $ terraform destroy ... >Destroy complete! Resources: 1 destroyed. \u52a8\u4f5c\u786e\u8ba4 \u00b6 Done.","title":"4\u3001\u5feb\u901f\u5efa\u7acb\u7b2c\u4e00\u4e2a EC2 \u5b9e\u4f8b   \u672c\u5730\u6388\u6743\u65b9\u5f0f"},{"location":"4%E3%80%81%E5%BF%AB%E9%80%9F%E5%BB%BA%E7%AB%8B%E7%AC%AC%E4%B8%80%E4%B8%AA%20EC2%20%E5%AE%9E%E4%BE%8B%20-%20%E6%9C%AC%E5%9C%B0%E6%8E%88%E6%9D%83%E6%96%B9%E5%BC%8F/#ec2-","text":"","title":"\u5feb\u901f\u5efa\u7acb\u7b2c\u4e00\u4e2a EC2 \u5b9e\u4f8b - \u672c\u5730\u6388\u6743\u65b9\u5f0f"},{"location":"4%E3%80%81%E5%BF%AB%E9%80%9F%E5%BB%BA%E7%AB%8B%E7%AC%AC%E4%B8%80%E4%B8%AA%20EC2%20%E5%AE%9E%E4%BE%8B%20-%20%E6%9C%AC%E5%9C%B0%E6%8E%88%E6%9D%83%E6%96%B9%E5%BC%8F/#_1","text":"\u4f7f\u7528 Terraform \u5feb\u901f\u5efa\u7acb\u7b2c\u4e00\u4e2a EC2 \u5b9e\u4f8b","title":"\u77e5\u8bc6\u70b9"},{"location":"4%E3%80%81%E5%BF%AB%E9%80%9F%E5%BB%BA%E7%AB%8B%E7%AC%AC%E4%B8%80%E4%B8%AA%20EC2%20%E5%AE%9E%E4%BE%8B%20-%20%E6%9C%AC%E5%9C%B0%E6%8E%88%E6%9D%83%E6%96%B9%E5%BC%8F/#_2","text":"https://registry.terraform.io/ Terraform Registry\u662fTerraform\u7684\u6ce8\u518c\u673a\uff0c\u76f8\u5f53\u4e8ejava\u7684maven\u3001Nodejs\u7684NPMjs\uff0c\u8fd9\u91cc\u96c6\u6210\u4e86\u6240\u4ee5Terraform\u7684\u4e2d\u95f4\u4ef6\uff0c\u4e3b\u8981\u5206\u4e3a\u4e24\u4e2a\u7c7b\u578b\uff1a Providers\uff1a\u63d0\u4f9b\u5668\uff0c\u51e0\u4e4e\u662f\u5b98\u65b9\u7ef4\u62a4\u3002\u4f8b\u5982\u8981\u5efa\u7acbAWS\u57fa\u4e8eTerraform\u7684\u5e73\u53f0\uff0c\u5c31\u9700\u8981AWS\u7684\u63d0\u4f9b\u5668\u6765\u652f\u6301\u540e\u7aef\u7684\u4e91\u5e73\u53f0\u3002 Modules\uff1a\u6a21\u5757\uff0c\u51e0\u4e4e\u662f\u4e2a\u4eba\u6216\u7ec4\u7ec7\u7ef4\u62a4\u3002\u6709\u4e86\u4e0a\u9762\u5f88\u591a\u7684\u63d0\u4f9b\u5668\uff0c\u60f3\u9ad8\u6548\u7684\u4f7f\u7528\u5c31\u9700\u8981\u7528\u5230\u6a21\u5757\u3002","title":"\u5b98\u7f51"},{"location":"4%E3%80%81%E5%BF%AB%E9%80%9F%E5%BB%BA%E7%AB%8B%E7%AC%AC%E4%B8%80%E4%B8%AA%20EC2%20%E5%AE%9E%E4%BE%8B%20-%20%E6%9C%AC%E5%9C%B0%E6%8E%88%E6%9D%83%E6%96%B9%E5%BC%8F/#_3","text":"\u5efa\u7acb\u672c\u5730 Terraform \u6587\u4ef6, (\u7b80\u79f0 tf \u6587\u4ef6) \u9075\u5faa Terraform \u5de5\u4f5c\u6d41\u7a0b\u5b8c\u6210\u8d44\u6e90\u90e8\u7f72 - init\u3001validate\u3001plan\u3001apply\u3001destroy \u52a8\u4f5c\u786e\u8ba4","title":"\u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3"},{"location":"4%E3%80%81%E5%BF%AB%E9%80%9F%E5%BB%BA%E7%AB%8B%E7%AC%AC%E4%B8%80%E4%B8%AA%20EC2%20%E5%AE%9E%E4%BE%8B%20-%20%E6%9C%AC%E5%9C%B0%E6%8E%88%E6%9D%83%E6%96%B9%E5%BC%8F/#_4","text":"","title":"\u64cd\u4f5c\u6b65\u9aa4"},{"location":"4%E3%80%81%E5%BF%AB%E9%80%9F%E5%BB%BA%E7%AB%8B%E7%AC%AC%E4%B8%80%E4%B8%AA%20EC2%20%E5%AE%9E%E4%BE%8B%20-%20%E6%9C%AC%E5%9C%B0%E6%8E%88%E6%9D%83%E6%96%B9%E5%BC%8F/#terraform-tf","text":"$ mkdir awstf $ cd awstf $ vim main.tf main.tf ########################################################### # Terraform \u57fa\u672c\u8bbe\u7f6e terraform { # \u58f0\u660eprovider required_providers { # https://registry.terraform.io/browse/providers aws = { source = \"hashicorp/aws\" version = \"~> 3.74\" } } # \u58f0\u660eTerraform\u7248\u672c required_version = \">= 1.1.4\" } ########################################################### # \u63d0\u4f9b\u5546\u8bbe\u7f6e(\u4e91\u5e73\u53f0) # \u63cf\u8ff0AWS Provider # https://registry.terraform.io/providers/hashicorp/aws/latest provider \"aws\" { # ~/.aws/credentials\u6587\u4ef6\u7684[name] profile = \"learnaws\" region = \"ap-northeast-1\" } ########################################################### # \u63cf\u8ff0\u8981\u751f\u6210\u7684\u8d44\u6e90\u8bbe\u7f6e # https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ami # https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance resource \"aws_instance\" \"myweb_server\" { ami = \"ami-0218d08a1f9dac831\" instance_type = \"t3.micro\" tags = { Name = \"learnaws-ec2-from-terraform\" } }","title":"\u5efa\u7acb\u672c\u5730 Terraform \u6587\u4ef6, (\u7b80\u79f0 tf \u6587\u4ef6)"},{"location":"4%E3%80%81%E5%BF%AB%E9%80%9F%E5%BB%BA%E7%AB%8B%E7%AC%AC%E4%B8%80%E4%B8%AA%20EC2%20%E5%AE%9E%E4%BE%8B%20-%20%E6%9C%AC%E5%9C%B0%E6%8E%88%E6%9D%83%E6%96%B9%E5%BC%8F/#terraform","text":"# \u76ee\u5f55\u521d\u59cb\u5316\uff08\u4f1a\u73b0\u5728\u5fc5\u8981\u7684\u5b89\u88c5\u5305\u548cprovider\uff09 $ terraform init # \u786e\u8ba4\u63d0\u4f9b\u5546\u7ba1\u7406\u6587\u4ef6, \u8be5\u6587\u4ef6\u8bb0\u5f55\u5177\u4f53\u7684\u63d0\u4f9b\u5546\u7248\u672c\u4fe1\u606f, \u5e94\u8be5\u5305\u542b\u5230\u6e90\u4ee3\u7801\u4fe1\u606f\u5e93\u4e2d $ ls -a $ cat .terraform.lock.hcl # \u68c0\u9a8c tf \u6587\u4ef6 $ terraform validate # \u5b9e\u65bd\u8ba1\u5212, \u51c6\u5907\u8d44\u6e90 $ terraform plan ... >Plan: 1 to add, 0 to change, 0 to destroy. # \u5e94\u7528\u90e8\u7f72 $ terraform apply ... >Apply complete! Resources: 1 added, 0 changed, 0 destroyed. # \u6467\u6bc1\u7cfb\u7edf\uff0c\u5373\u628a\u5f53\u524dtf\u811a\u672c\u63cf\u8ff0\u7684\u6240\u6709\u8d44\u6e90\u5168\u90e8\u6467\u6bc1 $ terraform destroy ... >Destroy complete! Resources: 1 destroyed.","title":"\u9075\u5faa Terraform \u5de5\u4f5c\u6d41\u7a0b\u5b8c\u6210\u8d44\u6e90\u90e8\u7f72"},{"location":"4%E3%80%81%E5%BF%AB%E9%80%9F%E5%BB%BA%E7%AB%8B%E7%AC%AC%E4%B8%80%E4%B8%AA%20EC2%20%E5%AE%9E%E4%BE%8B%20-%20%E6%9C%AC%E5%9C%B0%E6%8E%88%E6%9D%83%E6%96%B9%E5%BC%8F/#_5","text":"Done.","title":"\u52a8\u4f5c\u786e\u8ba4"},{"location":"5%E3%80%81%E5%BF%AB%E9%80%9F%E5%BB%BA%E7%AB%8B%E7%AC%AC%E4%B8%80%E4%B8%AA%20EC2%20%E5%AE%9E%E4%BE%8B%20-%20EC2%E6%8E%88%E6%9D%83%E6%96%B9%E5%BC%8F.md/","text":"\u5feb\u901f\u5efa\u7acb\u7b2c\u4e00\u4e2a EC2 \u5b9e\u4f8b - EC2\u6388\u6743\u65b9\u5f0f \u00b6 \u77e5\u8bc6\u70b9 \u00b6 \u4f7f\u7528 Terraform \u5728 Amazon Linux 2@EC2 \u4e0a\u5feb\u901f\u5efa\u7acb\u7b2c\u4e00\u4e2a EC2 \u5b9e\u4f8b \u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3 \u00b6 \u51c6\u5907 tf \u6a21\u7248 \u5728 EC2 \u4e0a\u6267\u884ctf\uff0c\u90e8\u7f72 EC2 \u5b9e\u4f8b \u52a8\u4f5c\u786e\u8ba4 \u64cd\u4f5c\u6b65\u9aa4 \u00b6 \u51c6\u5907 tf \u6a21\u7248 \u00b6 main.ts ########################################################### # Terraform \u57fa\u672c\u8bbe\u7f6e terraform { required_providers { aws = { source = \"hashicorp/aws\" version = \"~> 3.74\" } } required_version = \">= 1.1.4\" } ########################################################### # \u63d0\u4f9b\u5546\u8bbe\u7f6e(\u4e91\u5e73\u53f0) provider \"aws\" { # \u8fd9\u91cc\u5199default\u5373\u53ef\uff0c\u56e0\u4e3a\u6211\u4eec\u7684EC2\u4e0a\u6ca1\u6709\u8bbe\u7f6eaws cli\uff0c\u800c\u662f\u7ed9\u8fd9\u53f0EC2\u8fdb\u884c\u4e86\u89d2\u8272\u6388\u6743 profile = \"default\" region = \"ap-northeast-1\" } ########################################################### # \u751f\u6210\u7684\u8d44\u6e90\u8bbe\u7f6e resource \"aws_instance\" \"myweb_server\" { ami = \"ami-0218d08a1f9dac831\" instance_type = \"t2.micro\" # \u589e\u52a0\u4e00\u4e2a KeyPair \u8bbe\u7f6e key_name = \"learnaws-ssh-key\" tags = { Name = \"learnaws-ec2-from-terraform\" } } \u5728 EC2 \u4e0a\u90e8\u7f72 EC2 \u5b9e\u4f8b \u00b6 # \u76ee\u5f55\u521d\u59cb\u5316 $ terraform init # \u68c0\u9a8c tf \u6587\u4ef6 $ terraform validate # \u5b9e\u65bd\u8ba1\u5212, \u51c6\u5907\u8d44\u6e90 $ terraform plan # \u5e94\u7528\u90e8\u7f72 $ terraform apply # \u6467\u6bc1\u7cfb\u7edf $ terraform destroy \u52a8\u4f5c\u786e\u8ba4 \u00b6 Done.","title":"\u5feb\u901f\u5efa\u7acb\u7b2c\u4e00\u4e2a EC2 \u5b9e\u4f8b - EC2\u6388\u6743\u65b9\u5f0f"},{"location":"5%E3%80%81%E5%BF%AB%E9%80%9F%E5%BB%BA%E7%AB%8B%E7%AC%AC%E4%B8%80%E4%B8%AA%20EC2%20%E5%AE%9E%E4%BE%8B%20-%20EC2%E6%8E%88%E6%9D%83%E6%96%B9%E5%BC%8F.md/#ec2-ec2","text":"","title":"\u5feb\u901f\u5efa\u7acb\u7b2c\u4e00\u4e2a EC2 \u5b9e\u4f8b - EC2\u6388\u6743\u65b9\u5f0f"},{"location":"5%E3%80%81%E5%BF%AB%E9%80%9F%E5%BB%BA%E7%AB%8B%E7%AC%AC%E4%B8%80%E4%B8%AA%20EC2%20%E5%AE%9E%E4%BE%8B%20-%20EC2%E6%8E%88%E6%9D%83%E6%96%B9%E5%BC%8F.md/#_1","text":"\u4f7f\u7528 Terraform \u5728 Amazon Linux 2@EC2 \u4e0a\u5feb\u901f\u5efa\u7acb\u7b2c\u4e00\u4e2a EC2 \u5b9e\u4f8b","title":"\u77e5\u8bc6\u70b9"},{"location":"5%E3%80%81%E5%BF%AB%E9%80%9F%E5%BB%BA%E7%AB%8B%E7%AC%AC%E4%B8%80%E4%B8%AA%20EC2%20%E5%AE%9E%E4%BE%8B%20-%20EC2%E6%8E%88%E6%9D%83%E6%96%B9%E5%BC%8F.md/#_2","text":"\u51c6\u5907 tf \u6a21\u7248 \u5728 EC2 \u4e0a\u6267\u884ctf\uff0c\u90e8\u7f72 EC2 \u5b9e\u4f8b \u52a8\u4f5c\u786e\u8ba4","title":"\u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3"},{"location":"5%E3%80%81%E5%BF%AB%E9%80%9F%E5%BB%BA%E7%AB%8B%E7%AC%AC%E4%B8%80%E4%B8%AA%20EC2%20%E5%AE%9E%E4%BE%8B%20-%20EC2%E6%8E%88%E6%9D%83%E6%96%B9%E5%BC%8F.md/#_3","text":"","title":"\u64cd\u4f5c\u6b65\u9aa4"},{"location":"5%E3%80%81%E5%BF%AB%E9%80%9F%E5%BB%BA%E7%AB%8B%E7%AC%AC%E4%B8%80%E4%B8%AA%20EC2%20%E5%AE%9E%E4%BE%8B%20-%20EC2%E6%8E%88%E6%9D%83%E6%96%B9%E5%BC%8F.md/#tf","text":"main.ts ########################################################### # Terraform \u57fa\u672c\u8bbe\u7f6e terraform { required_providers { aws = { source = \"hashicorp/aws\" version = \"~> 3.74\" } } required_version = \">= 1.1.4\" } ########################################################### # \u63d0\u4f9b\u5546\u8bbe\u7f6e(\u4e91\u5e73\u53f0) provider \"aws\" { # \u8fd9\u91cc\u5199default\u5373\u53ef\uff0c\u56e0\u4e3a\u6211\u4eec\u7684EC2\u4e0a\u6ca1\u6709\u8bbe\u7f6eaws cli\uff0c\u800c\u662f\u7ed9\u8fd9\u53f0EC2\u8fdb\u884c\u4e86\u89d2\u8272\u6388\u6743 profile = \"default\" region = \"ap-northeast-1\" } ########################################################### # \u751f\u6210\u7684\u8d44\u6e90\u8bbe\u7f6e resource \"aws_instance\" \"myweb_server\" { ami = \"ami-0218d08a1f9dac831\" instance_type = \"t2.micro\" # \u589e\u52a0\u4e00\u4e2a KeyPair \u8bbe\u7f6e key_name = \"learnaws-ssh-key\" tags = { Name = \"learnaws-ec2-from-terraform\" } }","title":"\u51c6\u5907 tf \u6a21\u7248"},{"location":"5%E3%80%81%E5%BF%AB%E9%80%9F%E5%BB%BA%E7%AB%8B%E7%AC%AC%E4%B8%80%E4%B8%AA%20EC2%20%E5%AE%9E%E4%BE%8B%20-%20EC2%E6%8E%88%E6%9D%83%E6%96%B9%E5%BC%8F.md/#ec2-ec2_1","text":"# \u76ee\u5f55\u521d\u59cb\u5316 $ terraform init # \u68c0\u9a8c tf \u6587\u4ef6 $ terraform validate # \u5b9e\u65bd\u8ba1\u5212, \u51c6\u5907\u8d44\u6e90 $ terraform plan # \u5e94\u7528\u90e8\u7f72 $ terraform apply # \u6467\u6bc1\u7cfb\u7edf $ terraform destroy","title":"\u5728 EC2 \u4e0a\u90e8\u7f72 EC2 \u5b9e\u4f8b"},{"location":"5%E3%80%81%E5%BF%AB%E9%80%9F%E5%BB%BA%E7%AB%8B%E7%AC%AC%E4%B8%80%E4%B8%AA%20EC2%20%E5%AE%9E%E4%BE%8B%20-%20EC2%E6%8E%88%E6%9D%83%E6%96%B9%E5%BC%8F.md/#_4","text":"Done.","title":"\u52a8\u4f5c\u786e\u8ba4"},{"location":"6%E3%80%81%E5%88%86%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86%20Terraform%20%E8%B5%84%E6%BA%90/","text":"\u5206\u6587\u4ef6\u7ba1\u7406\u8d44\u6e90 \u00b6 \u77e5\u8bc6\u70b9 \u00b6 \u5206\u6587\u4ef6\u7ba1\u7406 Terraform \u8d44\u6e90 \u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3 \u00b6 \u62c6\u5206 EC2 \u8d44\u6e90\u63cf\u8ff0\u6587\u4ef6 \u90e8\u7f72\u786e\u8ba4 \u64cd\u4f5c\u6b65\u9aa4 \u00b6 \u4fee\u6539main.tf\u6587\u4ef6\u4ec5\u4fdd\u7559\u57fa\u7840\u8bbe\u7f6e \u00b6 main.tf ########################################################### # Terraform \u57fa\u672c\u8bbe\u7f6e terraform { required_providers { aws = { source = \"hashicorp/aws\" version = \"~> 3.74\" } } required_version = \">= 1.1.4\" } ########################################################### # \u63d0\u4f9b\u5546\u8bbe\u7f6e(\u4e91\u5e73\u53f0) provider \"aws\" { profile = \"learnaws\" region = \"ap-northeast-1\" } \u62c6\u5206 EC2 \u8d44\u6e90\u63cf\u8ff0\u6587\u4ef6 \u00b6 $ vi ec2.tf ec2.tf ########################################################### # EC2 \u8d44\u6e90\u8bbe\u7f6e resource \"aws_instance\" \"myweb_server2\" { ami = \"ami-0218d08a1f9dac831\" instance_type = \"t3.micro\" tags = { Name = \"learnaws-ec2-from-terraform2\" } } \u90e8\u7f72\u786e\u8ba4 \u00b6 Terraform\u4f1a\u628a\u5f53\u524d\u5de5\u7a0b\u76ee\u5f55\u4e0b\u6240\u6709.tf\u6587\u4ef6\u90fd\u4f1a\u83b7\u53d6\uff0c\u4e0d\u5b58\u5728\u5165\u53e3\u6587\u4ef6\u4e00\u8bf4 # \u76ee\u5f55\u521d\u59cb\u5316 $ terraform init # \u68c0\u9a8c tf \u6587\u4ef6 $ terraform validate # \u5b9e\u65bd\u8ba1\u5212, \u51c6\u5907\u8d44\u6e90 $ terraform plan # \u5e94\u7528\u90e8\u7f72 $ terraform apply # \u6467\u6bc1\u7cfb\u7edf $ terraform destroy","title":"6\u3001\u5206\u6587\u4ef6\u7ba1\u7406 Terraform \u8d44\u6e90"},{"location":"6%E3%80%81%E5%88%86%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86%20Terraform%20%E8%B5%84%E6%BA%90/#_1","text":"","title":"\u5206\u6587\u4ef6\u7ba1\u7406\u8d44\u6e90"},{"location":"6%E3%80%81%E5%88%86%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86%20Terraform%20%E8%B5%84%E6%BA%90/#_2","text":"\u5206\u6587\u4ef6\u7ba1\u7406 Terraform \u8d44\u6e90","title":"\u77e5\u8bc6\u70b9"},{"location":"6%E3%80%81%E5%88%86%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86%20Terraform%20%E8%B5%84%E6%BA%90/#_3","text":"\u62c6\u5206 EC2 \u8d44\u6e90\u63cf\u8ff0\u6587\u4ef6 \u90e8\u7f72\u786e\u8ba4","title":"\u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3"},{"location":"6%E3%80%81%E5%88%86%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86%20Terraform%20%E8%B5%84%E6%BA%90/#_4","text":"","title":"\u64cd\u4f5c\u6b65\u9aa4"},{"location":"6%E3%80%81%E5%88%86%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86%20Terraform%20%E8%B5%84%E6%BA%90/#maintf","text":"main.tf ########################################################### # Terraform \u57fa\u672c\u8bbe\u7f6e terraform { required_providers { aws = { source = \"hashicorp/aws\" version = \"~> 3.74\" } } required_version = \">= 1.1.4\" } ########################################################### # \u63d0\u4f9b\u5546\u8bbe\u7f6e(\u4e91\u5e73\u53f0) provider \"aws\" { profile = \"learnaws\" region = \"ap-northeast-1\" }","title":"\u4fee\u6539main.tf\u6587\u4ef6\u4ec5\u4fdd\u7559\u57fa\u7840\u8bbe\u7f6e"},{"location":"6%E3%80%81%E5%88%86%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86%20Terraform%20%E8%B5%84%E6%BA%90/#ec2","text":"$ vi ec2.tf ec2.tf ########################################################### # EC2 \u8d44\u6e90\u8bbe\u7f6e resource \"aws_instance\" \"myweb_server2\" { ami = \"ami-0218d08a1f9dac831\" instance_type = \"t3.micro\" tags = { Name = \"learnaws-ec2-from-terraform2\" } }","title":"\u62c6\u5206 EC2 \u8d44\u6e90\u63cf\u8ff0\u6587\u4ef6"},{"location":"6%E3%80%81%E5%88%86%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86%20Terraform%20%E8%B5%84%E6%BA%90/#_5","text":"Terraform\u4f1a\u628a\u5f53\u524d\u5de5\u7a0b\u76ee\u5f55\u4e0b\u6240\u6709.tf\u6587\u4ef6\u90fd\u4f1a\u83b7\u53d6\uff0c\u4e0d\u5b58\u5728\u5165\u53e3\u6587\u4ef6\u4e00\u8bf4 # \u76ee\u5f55\u521d\u59cb\u5316 $ terraform init # \u68c0\u9a8c tf \u6587\u4ef6 $ terraform validate # \u5b9e\u65bd\u8ba1\u5212, \u51c6\u5907\u8d44\u6e90 $ terraform plan # \u5e94\u7528\u90e8\u7f72 $ terraform apply # \u6467\u6bc1\u7cfb\u7edf $ terraform destroy","title":"\u90e8\u7f72\u786e\u8ba4"},{"location":"7%E3%80%81tf%E8%AE%BE%E7%BD%AEEC2%E8%B5%84%E6%BA%90%E7%9A%84%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE/","text":"\u4f7f\u7528 EC2 \u7528\u6237\u6570\u636e \u00b6 \u77e5\u8bc6\u70b9 \u00b6 \u542f\u52a8 EC2 \u65f6\u51c6\u5907\u7528\u6237\u6570\u636e \u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3 \u00b6 \u51c6\u5907\u7528\u6237\u6570\u636e\u6587\u4ef6 \u4fee\u6539 EC2 \u8d44\u6e90\u914d\u7f6e\u6587\u4ef6 \u90e8\u7f72\u786e\u8ba4 \u64cd\u4f5c\u6b65\u9aa4 \u00b6 \u76ee\u5f55\u7ed3\u6784 \u00b6 . \u251c\u2500\u2500 ec2.tf \u251c\u2500\u2500 main.tf \u2514\u2500\u2500 ec2-userdata.sh \u51c6\u5907\u7528\u6237\u6570\u636e\u6587\u4ef6 \u00b6 ec2-userdata.sh #!/bin/bash yum update -y # \u8bbe\u7f6eec2\u533a\u57df timedatectl set-timezone \"Asia/Tokyo\" localectl set-locale LANG = ja_JP.UTF-8 touch /home/ec2-user/.hushlogin chown ec2-user:ec2-user /home/ec2-user/.hushlogin # \u5b89\u88c5aws cli\u547d\u4ee4\u884c\u5de5\u5177 curl \"https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip\" -o \"/tmp/awscliv2.zip\" unzip /tmp/awscliv2.zip -d /tmp/awscliv2/ /tmp/awscliv2/aws/install # \u5b89\u88c5Nodejs curl -sL https://rpm.nodesource.com/setup_14.x | bash - yum install -y gcc-c++ make yum install -y nodejs # \u5b89\u88c5Apache\u5f00\u542f80 http\u670d\u52a1 yum install -y httpd systemctl enable httpd service httpd start sudo echo '<h1>Terraform EC2.</h1>' | sudo tee /var/www/html/index.html EC2 \u8d44\u6e90\u914d\u7f6e\u6587\u4ef6 \u00b6 ec2.tf ########################################################### # EC2 \u8d44\u6e90\u8bbe\u7f6e resource \"aws_instance\" \"myweb_server2\" { ami = \"ami-0218d08a1f9dac831\" instance_type = \"t3.micro\" # \u7528\u6765ssh\u5bc6\u94a5\u767b\u9646 key_name = \"learnaws-ssh-key\" # \u5f15\u7528ec2-userdata.sh\u811a\u672c\uff0c${path.module}\u662f\u5f53\u524d\u8def\u5f84 user_data = file ( \" ${ path .module } /ec2-userdata.sh\" ) tags = { Name = \"learnaws-ec2-from-terraform2\" } } \u9879\u76ee\u63cf\u8ff0\u6587\u4ef6 \u00b6 main.tf ########################################################### # Terraform \u57fa\u672c\u8bbe\u7f6e terraform { required_providers { aws = { source = \"hashicorp/aws\" version = \"~> 3.74\" } } required_version = \">= 1.1.4\" } ########################################################### # \u63d0\u4f9b\u5546\u8bbe\u7f6e(\u4e91\u5e73\u53f0) provider \"aws\" { profile = \"learnaws\" region = \"ap-northeast-1\" } \u90e8\u7f72\u786e\u8ba4 \u00b6 # \u76ee\u5f55\u521d\u59cb\u5316 $ terraform init # \u68c0\u9a8c tf \u6587\u4ef6 $ terraform validate # \u5b9e\u65bd\u8ba1\u5212, \u51c6\u5907\u8d44\u6e90 $ terraform plan # \u5e94\u7528\u90e8\u7f72 $ terraform apply $ terraform apply -auto-approve # \u81ea\u52a8\u786e\u8ba4\uff0c\u4f1a\u81ea\u52a8\u8f93\u5165yes # \u6467\u6bc1\u7cfb\u7edf $ terraform destroy -auto-approve # \u8bbf\u95eeec2\u7684ip\uff0c\u7f51\u9875\u8f93\u51fa\u201cTerraform EC2.\u201d\u5373\u6210\u529f","title":"\u4f7f\u7528 EC2 \u7528\u6237\u6570\u636e"},{"location":"7%E3%80%81tf%E8%AE%BE%E7%BD%AEEC2%E8%B5%84%E6%BA%90%E7%9A%84%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE/#ec2","text":"","title":"\u4f7f\u7528 EC2 \u7528\u6237\u6570\u636e"},{"location":"7%E3%80%81tf%E8%AE%BE%E7%BD%AEEC2%E8%B5%84%E6%BA%90%E7%9A%84%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE/#_1","text":"\u542f\u52a8 EC2 \u65f6\u51c6\u5907\u7528\u6237\u6570\u636e","title":"\u77e5\u8bc6\u70b9"},{"location":"7%E3%80%81tf%E8%AE%BE%E7%BD%AEEC2%E8%B5%84%E6%BA%90%E7%9A%84%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE/#_2","text":"\u51c6\u5907\u7528\u6237\u6570\u636e\u6587\u4ef6 \u4fee\u6539 EC2 \u8d44\u6e90\u914d\u7f6e\u6587\u4ef6 \u90e8\u7f72\u786e\u8ba4","title":"\u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3"},{"location":"7%E3%80%81tf%E8%AE%BE%E7%BD%AEEC2%E8%B5%84%E6%BA%90%E7%9A%84%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE/#_3","text":"","title":"\u64cd\u4f5c\u6b65\u9aa4"},{"location":"7%E3%80%81tf%E8%AE%BE%E7%BD%AEEC2%E8%B5%84%E6%BA%90%E7%9A%84%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE/#_4","text":". \u251c\u2500\u2500 ec2.tf \u251c\u2500\u2500 main.tf \u2514\u2500\u2500 ec2-userdata.sh","title":"\u76ee\u5f55\u7ed3\u6784"},{"location":"7%E3%80%81tf%E8%AE%BE%E7%BD%AEEC2%E8%B5%84%E6%BA%90%E7%9A%84%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE/#_5","text":"ec2-userdata.sh #!/bin/bash yum update -y # \u8bbe\u7f6eec2\u533a\u57df timedatectl set-timezone \"Asia/Tokyo\" localectl set-locale LANG = ja_JP.UTF-8 touch /home/ec2-user/.hushlogin chown ec2-user:ec2-user /home/ec2-user/.hushlogin # \u5b89\u88c5aws cli\u547d\u4ee4\u884c\u5de5\u5177 curl \"https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip\" -o \"/tmp/awscliv2.zip\" unzip /tmp/awscliv2.zip -d /tmp/awscliv2/ /tmp/awscliv2/aws/install # \u5b89\u88c5Nodejs curl -sL https://rpm.nodesource.com/setup_14.x | bash - yum install -y gcc-c++ make yum install -y nodejs # \u5b89\u88c5Apache\u5f00\u542f80 http\u670d\u52a1 yum install -y httpd systemctl enable httpd service httpd start sudo echo '<h1>Terraform EC2.</h1>' | sudo tee /var/www/html/index.html","title":"\u51c6\u5907\u7528\u6237\u6570\u636e\u6587\u4ef6"},{"location":"7%E3%80%81tf%E8%AE%BE%E7%BD%AEEC2%E8%B5%84%E6%BA%90%E7%9A%84%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE/#ec2_1","text":"ec2.tf ########################################################### # EC2 \u8d44\u6e90\u8bbe\u7f6e resource \"aws_instance\" \"myweb_server2\" { ami = \"ami-0218d08a1f9dac831\" instance_type = \"t3.micro\" # \u7528\u6765ssh\u5bc6\u94a5\u767b\u9646 key_name = \"learnaws-ssh-key\" # \u5f15\u7528ec2-userdata.sh\u811a\u672c\uff0c${path.module}\u662f\u5f53\u524d\u8def\u5f84 user_data = file ( \" ${ path .module } /ec2-userdata.sh\" ) tags = { Name = \"learnaws-ec2-from-terraform2\" } }","title":"EC2 \u8d44\u6e90\u914d\u7f6e\u6587\u4ef6"},{"location":"7%E3%80%81tf%E8%AE%BE%E7%BD%AEEC2%E8%B5%84%E6%BA%90%E7%9A%84%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE/#_6","text":"main.tf ########################################################### # Terraform \u57fa\u672c\u8bbe\u7f6e terraform { required_providers { aws = { source = \"hashicorp/aws\" version = \"~> 3.74\" } } required_version = \">= 1.1.4\" } ########################################################### # \u63d0\u4f9b\u5546\u8bbe\u7f6e(\u4e91\u5e73\u53f0) provider \"aws\" { profile = \"learnaws\" region = \"ap-northeast-1\" }","title":"\u9879\u76ee\u63cf\u8ff0\u6587\u4ef6"},{"location":"7%E3%80%81tf%E8%AE%BE%E7%BD%AEEC2%E8%B5%84%E6%BA%90%E7%9A%84%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE/#_7","text":"# \u76ee\u5f55\u521d\u59cb\u5316 $ terraform init # \u68c0\u9a8c tf \u6587\u4ef6 $ terraform validate # \u5b9e\u65bd\u8ba1\u5212, \u51c6\u5907\u8d44\u6e90 $ terraform plan # \u5e94\u7528\u90e8\u7f72 $ terraform apply $ terraform apply -auto-approve # \u81ea\u52a8\u786e\u8ba4\uff0c\u4f1a\u81ea\u52a8\u8f93\u5165yes # \u6467\u6bc1\u7cfb\u7edf $ terraform destroy -auto-approve # \u8bbf\u95eeec2\u7684ip\uff0c\u7f51\u9875\u8f93\u51fa\u201cTerraform EC2.\u201d\u5373\u6210\u529f","title":"\u90e8\u7f72\u786e\u8ba4"},{"location":"8%E3%80%81%E7%8A%B6%E6%80%81%E6%96%87%E4%BB%B6%20-%20%22terraform.tfstate%22/","text":"\u72b6\u6001\u6587\u4ef6 - terraform.tfstate \u00b6 \u77e5\u8bc6\u70b9 \u00b6 Terraform \u7684\u72b6\u6001\u6587\u4ef6 - terraform.tfstate \u5b98\u7f51 \u00b6 https://www.terraform.io/language/state \u8bf4\u660e\u8bb2\u89e3 \u00b6 tfstate \u662f\u4ec0\u4e48\uff1f \u00b6 .tfstate \u6587\u4ef6\u662f Terraform \u7ba1\u7406\u73b0\u6709\u8d44\u6e90\u72b6\u6001\u7684\u6587\u4ef6\u3002 \u4e3a\u4ec0\u4e48\u8981\u6709 tfstate \u00b6 \u6bcf\u5f53\u6267\u884c terraform plan \u7684\u65f6\u5019\uff0c Terraform \u90fd\u4f1a\u4e3a\u6211\u4eec\u6bd4\u8f83\u672c\u5730\u8d44\u6e90\u7684\u53d8\u5316\u548c\u670d\u52a1\u5668\u8d44\u6e90\u7684\u4e0d\u540c\u3002 \u8fd9\u70b9\u548c CloudFormation \u4e0d\u4e00\u6837\uff0c CloudFormation \u662f\u5b58\u5728\u4e91\u7aef\u7684\u3002 \u5927\u5bb6\u8bf7\u60f3\u4e00\u4e2a\u95ee\u9898, \u4e3a\u4ec0\u4e48\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 terraform apply \u5efa\u7acb\u51fa\u7684 EC2, \u9a6c\u4e0a\u53ef\u4ee5\u901a\u8fc7 terraform destroy \u8fdb\u884c\u9500\u6bc1\u5462\uff1f Terraform \u662f\u600e\u4e48\u77e5\u9053\u8be5\u9500\u6bc1\u54ea\u53f0 EC2 \u7684? \u4f1a\u4e0d\u4f1a\u5c06\u4e91\u4e2d\u7684\u5176\u4ed6 EC2 \u9500\u6bc1\u5462\uff1f \u5982\u679c\u6ca1\u6709\u72b6\u6001\u7ba1\u7406\uff0c \u8fd9\u5c31\u5f88\u5371\u9669\u3002 terraform.tfstate\u6587\u4ef6\u7684\u4f5c\u7528 \u00b6 terraform.tfstate \u8bb0\u5f55\u4e86 \u5f53\u524dtf\u7ba1\u7406\u7684\u8d44\u6e90\u7684\u72b6\u6001 \u3002 \u5982\u679c\u6211\u4eec\u5728\u6b64\u4e4b\u524d\u6267\u884c\u4e86 terraform destroy \u547d\u4ee4\uff0c\u628a\u8d44\u6e90\u90fd\u9500\u6bc1\u4e86\uff0c\u90a3\u4e48 terraform.tfstate \u6587\u4ef6\u91cc\u9762\u662f\u770b\u4e0d\u5230\u4efb\u4f55resources\u4fe1\u606f\u7684\uff0c\u56e0\u4e3a\u8be5\u6587\u4ef6\u8bb0\u5f55\u7684\u662f\u5f53\u524d\u7684tf\u7ba1\u7406\u8d44\u6e90\u7684\u72b6\u6001\u3002 \u4f46\u662f\uff0cTerraform\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u4e0a\u4e00\u6b21\u901a\u8fc7tf\u7ba1\u7406\u8d44\u6e90\u7684 terraform.tfstate.backup \u6587\u4ef6\u3002 \u4e00\u8d77\u6765\u770b\u4e00\u4e0b tfstate \u6587\u4ef6\u6837\u4f8b \u00b6 $ cat terraform.tfstate terraform.tfstate { \"version\" : 4 , // \u91c7\u7528\u7248\u672c \"terraform_version\" : \"1.1.4\" , // \u8fd0\u884c\u6b21\u6570 \"serial\" : 9 , // \u9879\u76ee\u552f\u4e00ID\u3002\u5982\u679c\u672c\u5730\u7528tf\u7ba1\u7406\u591a\u4e2a\u9879\u76ee\uff0c\u4f46\u662f\u56e0\u4e3aID\u662f\u552f\u4e00\u7684\uff0c\u8fd9\u4f1a\u786e\u4fdd\u4e0d\u540c\u7684tf\u4e0d\u4f1a\u5f71\u54cd\u5230\u4e91\u7aef\u7684\u540c\u4e00\u4e2a\u8d44\u6e90 \"lineage\" : \"a81e9642-ae12-9afc-ab52-1bb1ca1d5b66\" , \"outputs\" : {}, \"resources\" : [ { \"mode\" : \"managed\" , // \u8d44\u6e90\u7c7b\u578b \"type\" : \"aws_instance\" , // \u8d44\u6e90\u540d\u79f0(TF\u4f7f\u7528) \"name\" : \"myweb_server2\" , \"provider\" : \"provider[\\\"registry.terraform.io/hashicorp/aws\\\"]\" , \"instances\" : [ { \"schema_version\" : 1 , \"attributes\" : { // AMI-ID \"ami\" : \"ami-0218d08a1f9dac831\" , // EC2 ARN \"arn\" : \"arn:aws:ec2:ap-northeast-1:168571836196:instance/i-06f67dc122136c534\" , // EC2 \u5404\u79cd\u5c5e\u6027\u8bbe\u7f6e ... \"associate_public_ip_address\" : true , \"availability_zone\" : \"ap-northeast-1a\" , \"capacity_reservation_specification\" : [ { \"capacity_reservation_preference\" : \"open\" , \"capacity_reservation_target\" : [] } ], \"cpu_core_count\" : 1 , \"cpu_threads_per_core\" : 1 , \"credit_specification\" : [ { \"cpu_credits\" : \"standard\" } ], \"disable_api_termination\" : false , \"ebs_block_device\" : [], \"ebs_optimized\" : false , \"enclave_options\" : [ { \"enabled\" : false } ], \"ephemeral_block_device\" : [], \"get_password_data\" : false , \"hibernation\" : false , \"host_id\" : null , \"iam_instance_profile\" : \"\" , \"id\" : \"i-06f67dc122136c534\" , \"instance_initiated_shutdown_behavior\" : \"stop\" , \"instance_state\" : \"running\" , \"instance_type\" : \"t2.micro\" , \"ipv6_address_count\" : 0 , \"ipv6_addresses\" : [], \"key_name\" : \"\" , \"launch_template\" : [], \"metadata_options\" : [ { \"http_endpoint\" : \"enabled\" , \"http_put_response_hop_limit\" : 1 , \"http_tokens\" : \"optional\" } ], \"monitoring\" : false , \"network_interface\" : [], \"outpost_arn\" : \"\" , \"password_data\" : \"\" , \"placement_group\" : \"\" , \"placement_partition_number\" : null , \"primary_network_interface_id\" : \"eni-04777e6b3d682c7e8\" , \"private_dns\" : \"ip-172-31-45-191.ap-northeast-1.compute.internal\" , \"private_ip\" : \"172.31.45.191\" , \"public_dns\" : \"ec2-13-231-129-70.ap-northeast-1.compute.amazonaws.com\" , \"public_ip\" : \"13.231.129.70\" , \"root_block_device\" : [ { \"delete_on_termination\" : true , \"device_name\" : \"/dev/xvda\" , \"encrypted\" : false , \"iops\" : 100 , \"kms_key_id\" : \"\" , \"tags\" : {}, \"throughput\" : 0 , \"volume_id\" : \"vol-013199e72886ccebd\" , \"volume_size\" : 8 , \"volume_type\" : \"gp2\" } ], \"secondary_private_ips\" : [], \"security_groups\" : [ \"default\" ], \"source_dest_check\" : true , \"subnet_id\" : \"subnet-0647f7f6ae12f3d59\" , \"tags\" : { \"Name\" : \"learnaws-ec2-from-terraform2\" }, \"tags_all\" : { \"Name\" : \"learnaws-ec2-from-terraform2\" }, \"tenancy\" : \"default\" , \"timeouts\" : null , \"user_data\" : \"4d496b03906764122c3ddb6f8bba0bddb432ec11\" , \"user_data_base64\" : null , \"volume_tags\" : null , \"vpc_security_group_ids\" : [ \"sg-0e114289b84c9418a\" ] }, \"sensitive_attributes\" : [], \"private\" : \"eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6MTIwMDAwMDAwMDAwMCwidXBkYXRlIjo2MDAwMDAwMDAwMDB9LCJzY2hlbWFfdmVyc2lvbiI6IjEifQ==\" } ] } ] } \u5f3a\u70c8\u5efa\u8bae \u00b6 \u5728\u8fdb\u884c\u6e90\u4ee3\u7801\u7ba1\u7406\u65f6\uff0c\u52a1\u5fc5\u628a terraform.tfstate \u6587\u4ef6\u4e5f\u7ba1\u7406\u8fdb\u53bb\u3002 \u56e0\u4e3a\u4e00\u65e6 terraform.tfstate \u6587\u4ef6\u4e22\u5931\uff0ctf\u5c31\u4e0d\u77e5\u9053\u8be5\u7ba1\u7406\u54ea\u4e9b\u8d44\u6e90 terraform.tfstate \u867d\u7136\u662f\u81ea\u52a8\u751f\u6210\u81ea\u52a8\u7ef4\u62a4\uff0c\u4f46\u786e\u662f\u4f7f\u7528tf\u7ba1\u7406\u4e91\u8d44\u6e90\u6700\u6700\u91cd\u8981\u7684\u6587\u4ef6\uff0c\u4e00\u5b9a\u4e0d\u53ef\u4ee5\u4e22\u5931\u3002","title":"8\u3001\u72b6\u6001\u6587\u4ef6   \"terraform.tfstate\""},{"location":"8%E3%80%81%E7%8A%B6%E6%80%81%E6%96%87%E4%BB%B6%20-%20%22terraform.tfstate%22/#-terraformtfstate","text":"","title":"\u72b6\u6001\u6587\u4ef6 - terraform.tfstate"},{"location":"8%E3%80%81%E7%8A%B6%E6%80%81%E6%96%87%E4%BB%B6%20-%20%22terraform.tfstate%22/#_1","text":"Terraform \u7684\u72b6\u6001\u6587\u4ef6 - terraform.tfstate","title":"\u77e5\u8bc6\u70b9"},{"location":"8%E3%80%81%E7%8A%B6%E6%80%81%E6%96%87%E4%BB%B6%20-%20%22terraform.tfstate%22/#_2","text":"https://www.terraform.io/language/state","title":"\u5b98\u7f51"},{"location":"8%E3%80%81%E7%8A%B6%E6%80%81%E6%96%87%E4%BB%B6%20-%20%22terraform.tfstate%22/#_3","text":"","title":"\u8bf4\u660e\u8bb2\u89e3"},{"location":"8%E3%80%81%E7%8A%B6%E6%80%81%E6%96%87%E4%BB%B6%20-%20%22terraform.tfstate%22/#tfstate","text":".tfstate \u6587\u4ef6\u662f Terraform \u7ba1\u7406\u73b0\u6709\u8d44\u6e90\u72b6\u6001\u7684\u6587\u4ef6\u3002","title":"tfstate \u662f\u4ec0\u4e48\uff1f"},{"location":"8%E3%80%81%E7%8A%B6%E6%80%81%E6%96%87%E4%BB%B6%20-%20%22terraform.tfstate%22/#tfstate_1","text":"\u6bcf\u5f53\u6267\u884c terraform plan \u7684\u65f6\u5019\uff0c Terraform \u90fd\u4f1a\u4e3a\u6211\u4eec\u6bd4\u8f83\u672c\u5730\u8d44\u6e90\u7684\u53d8\u5316\u548c\u670d\u52a1\u5668\u8d44\u6e90\u7684\u4e0d\u540c\u3002 \u8fd9\u70b9\u548c CloudFormation \u4e0d\u4e00\u6837\uff0c CloudFormation \u662f\u5b58\u5728\u4e91\u7aef\u7684\u3002 \u5927\u5bb6\u8bf7\u60f3\u4e00\u4e2a\u95ee\u9898, \u4e3a\u4ec0\u4e48\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 terraform apply \u5efa\u7acb\u51fa\u7684 EC2, \u9a6c\u4e0a\u53ef\u4ee5\u901a\u8fc7 terraform destroy \u8fdb\u884c\u9500\u6bc1\u5462\uff1f Terraform \u662f\u600e\u4e48\u77e5\u9053\u8be5\u9500\u6bc1\u54ea\u53f0 EC2 \u7684? \u4f1a\u4e0d\u4f1a\u5c06\u4e91\u4e2d\u7684\u5176\u4ed6 EC2 \u9500\u6bc1\u5462\uff1f \u5982\u679c\u6ca1\u6709\u72b6\u6001\u7ba1\u7406\uff0c \u8fd9\u5c31\u5f88\u5371\u9669\u3002","title":"\u4e3a\u4ec0\u4e48\u8981\u6709 tfstate"},{"location":"8%E3%80%81%E7%8A%B6%E6%80%81%E6%96%87%E4%BB%B6%20-%20%22terraform.tfstate%22/#terraformtfstate","text":"terraform.tfstate \u8bb0\u5f55\u4e86 \u5f53\u524dtf\u7ba1\u7406\u7684\u8d44\u6e90\u7684\u72b6\u6001 \u3002 \u5982\u679c\u6211\u4eec\u5728\u6b64\u4e4b\u524d\u6267\u884c\u4e86 terraform destroy \u547d\u4ee4\uff0c\u628a\u8d44\u6e90\u90fd\u9500\u6bc1\u4e86\uff0c\u90a3\u4e48 terraform.tfstate \u6587\u4ef6\u91cc\u9762\u662f\u770b\u4e0d\u5230\u4efb\u4f55resources\u4fe1\u606f\u7684\uff0c\u56e0\u4e3a\u8be5\u6587\u4ef6\u8bb0\u5f55\u7684\u662f\u5f53\u524d\u7684tf\u7ba1\u7406\u8d44\u6e90\u7684\u72b6\u6001\u3002 \u4f46\u662f\uff0cTerraform\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u4e0a\u4e00\u6b21\u901a\u8fc7tf\u7ba1\u7406\u8d44\u6e90\u7684 terraform.tfstate.backup \u6587\u4ef6\u3002","title":"terraform.tfstate\u6587\u4ef6\u7684\u4f5c\u7528"},{"location":"8%E3%80%81%E7%8A%B6%E6%80%81%E6%96%87%E4%BB%B6%20-%20%22terraform.tfstate%22/#tfstate_2","text":"$ cat terraform.tfstate terraform.tfstate { \"version\" : 4 , // \u91c7\u7528\u7248\u672c \"terraform_version\" : \"1.1.4\" , // \u8fd0\u884c\u6b21\u6570 \"serial\" : 9 , // \u9879\u76ee\u552f\u4e00ID\u3002\u5982\u679c\u672c\u5730\u7528tf\u7ba1\u7406\u591a\u4e2a\u9879\u76ee\uff0c\u4f46\u662f\u56e0\u4e3aID\u662f\u552f\u4e00\u7684\uff0c\u8fd9\u4f1a\u786e\u4fdd\u4e0d\u540c\u7684tf\u4e0d\u4f1a\u5f71\u54cd\u5230\u4e91\u7aef\u7684\u540c\u4e00\u4e2a\u8d44\u6e90 \"lineage\" : \"a81e9642-ae12-9afc-ab52-1bb1ca1d5b66\" , \"outputs\" : {}, \"resources\" : [ { \"mode\" : \"managed\" , // \u8d44\u6e90\u7c7b\u578b \"type\" : \"aws_instance\" , // \u8d44\u6e90\u540d\u79f0(TF\u4f7f\u7528) \"name\" : \"myweb_server2\" , \"provider\" : \"provider[\\\"registry.terraform.io/hashicorp/aws\\\"]\" , \"instances\" : [ { \"schema_version\" : 1 , \"attributes\" : { // AMI-ID \"ami\" : \"ami-0218d08a1f9dac831\" , // EC2 ARN \"arn\" : \"arn:aws:ec2:ap-northeast-1:168571836196:instance/i-06f67dc122136c534\" , // EC2 \u5404\u79cd\u5c5e\u6027\u8bbe\u7f6e ... \"associate_public_ip_address\" : true , \"availability_zone\" : \"ap-northeast-1a\" , \"capacity_reservation_specification\" : [ { \"capacity_reservation_preference\" : \"open\" , \"capacity_reservation_target\" : [] } ], \"cpu_core_count\" : 1 , \"cpu_threads_per_core\" : 1 , \"credit_specification\" : [ { \"cpu_credits\" : \"standard\" } ], \"disable_api_termination\" : false , \"ebs_block_device\" : [], \"ebs_optimized\" : false , \"enclave_options\" : [ { \"enabled\" : false } ], \"ephemeral_block_device\" : [], \"get_password_data\" : false , \"hibernation\" : false , \"host_id\" : null , \"iam_instance_profile\" : \"\" , \"id\" : \"i-06f67dc122136c534\" , \"instance_initiated_shutdown_behavior\" : \"stop\" , \"instance_state\" : \"running\" , \"instance_type\" : \"t2.micro\" , \"ipv6_address_count\" : 0 , \"ipv6_addresses\" : [], \"key_name\" : \"\" , \"launch_template\" : [], \"metadata_options\" : [ { \"http_endpoint\" : \"enabled\" , \"http_put_response_hop_limit\" : 1 , \"http_tokens\" : \"optional\" } ], \"monitoring\" : false , \"network_interface\" : [], \"outpost_arn\" : \"\" , \"password_data\" : \"\" , \"placement_group\" : \"\" , \"placement_partition_number\" : null , \"primary_network_interface_id\" : \"eni-04777e6b3d682c7e8\" , \"private_dns\" : \"ip-172-31-45-191.ap-northeast-1.compute.internal\" , \"private_ip\" : \"172.31.45.191\" , \"public_dns\" : \"ec2-13-231-129-70.ap-northeast-1.compute.amazonaws.com\" , \"public_ip\" : \"13.231.129.70\" , \"root_block_device\" : [ { \"delete_on_termination\" : true , \"device_name\" : \"/dev/xvda\" , \"encrypted\" : false , \"iops\" : 100 , \"kms_key_id\" : \"\" , \"tags\" : {}, \"throughput\" : 0 , \"volume_id\" : \"vol-013199e72886ccebd\" , \"volume_size\" : 8 , \"volume_type\" : \"gp2\" } ], \"secondary_private_ips\" : [], \"security_groups\" : [ \"default\" ], \"source_dest_check\" : true , \"subnet_id\" : \"subnet-0647f7f6ae12f3d59\" , \"tags\" : { \"Name\" : \"learnaws-ec2-from-terraform2\" }, \"tags_all\" : { \"Name\" : \"learnaws-ec2-from-terraform2\" }, \"tenancy\" : \"default\" , \"timeouts\" : null , \"user_data\" : \"4d496b03906764122c3ddb6f8bba0bddb432ec11\" , \"user_data_base64\" : null , \"volume_tags\" : null , \"vpc_security_group_ids\" : [ \"sg-0e114289b84c9418a\" ] }, \"sensitive_attributes\" : [], \"private\" : \"eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6MTIwMDAwMDAwMDAwMCwidXBkYXRlIjo2MDAwMDAwMDAwMDB9LCJzY2hlbWFfdmVyc2lvbiI6IjEifQ==\" } ] } ] }","title":"\u4e00\u8d77\u6765\u770b\u4e00\u4e0b tfstate \u6587\u4ef6\u6837\u4f8b"},{"location":"8%E3%80%81%E7%8A%B6%E6%80%81%E6%96%87%E4%BB%B6%20-%20%22terraform.tfstate%22/#_4","text":"\u5728\u8fdb\u884c\u6e90\u4ee3\u7801\u7ba1\u7406\u65f6\uff0c\u52a1\u5fc5\u628a terraform.tfstate \u6587\u4ef6\u4e5f\u7ba1\u7406\u8fdb\u53bb\u3002 \u56e0\u4e3a\u4e00\u65e6 terraform.tfstate \u6587\u4ef6\u4e22\u5931\uff0ctf\u5c31\u4e0d\u77e5\u9053\u8be5\u7ba1\u7406\u54ea\u4e9b\u8d44\u6e90 terraform.tfstate \u867d\u7136\u662f\u81ea\u52a8\u751f\u6210\u81ea\u52a8\u7ef4\u62a4\uff0c\u4f46\u786e\u662f\u4f7f\u7528tf\u7ba1\u7406\u4e91\u8d44\u6e90\u6700\u6700\u91cd\u8981\u7684\u6587\u4ef6\uff0c\u4e00\u5b9a\u4e0d\u53ef\u4ee5\u4e22\u5931\u3002","title":"\u5f3a\u70c8\u5efa\u8bae"},{"location":"9%E3%80%81%E5%AE%9A%E4%B9%89%E5%BC%95%E7%94%A8%E5%8F%98%E9%87%8F/","text":"\u5b9a\u4e49\u5f15\u7528\u53d8\u91cf \u00b6 \u77e5\u8bc6\u70b9 \u00b6 \u5c06 TF \u63cf\u8ff0\u6587\u4ef6\u4e2d\u5171\u540c\u7684\u5185\u5bb9\u62bd\u51fa\u4e3a\u53d8\u91cf\uff0c \u5c3d\u4eab\u7edf\u4e00\u7ba1\u7406 \u4f8b\u5982\u5b9a\u4e49ec2\u65f6\u7684AMI\u662f\u4e00\u6837\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u628aAMI ID\u62bd\u8c61\u51fa\u6765\u4f5c\u4e3a\u53d8\u91cf \u5b98\u7f51 \u00b6 https://www.terraform.io/language/values \u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3 \u00b6 \u7f16\u5199\u53d8\u91cf\u5b9a\u4e49\u6587\u4ef6\uff0c \u62bd\u51fa\u5171\u540c\u7684\u8d44\u6e90\u5b9a\u4e49\u90e8\u5206 \u7f16\u5199 TF \u8d44\u6e90\u63cf\u8ff0\u6587\u4ef6\uff0c \u5f15\u7528\u53d8\u91cf\u5b9a\u4e49 \u90e8\u7f72\u786e\u8ba4 \u64cd\u4f5c\u6b65\u9aa4 \u00b6 \u76ee\u5f55\u7ed3\u6784 \u00b6 . \u251c\u2500\u2500 ec2-variables.tf \u251c\u2500\u2500 ec2.tf \u2514\u2500\u2500 main.tf \u7f16\u5199\u53d8\u91cf\u5b9a\u4e49\u6587\u4ef6\uff0c \u62bd\u51fa\u5171\u540c\u7684\u8d44\u6e90\u5b9a\u4e49\u90e8\u5206 \u00b6 ec2-variables.tf # AWS Region variable \"aws_region\" { description = \"AWS Region\" type = string default = \"ap-northeast-1\" } # AWS EC2 Instance Type variable \"instance_type\" { description = \"EC2 Instance Type\" type = string default = \"t2.small\" } # AWS EC2 Instance Key Pair variable \"ami_id\" { description = \"AMI Image ID\" type = string default = \"ami-0218d08a1f9dac831\" } \u7f16\u5199 TF \u8d44\u6e90\u63cf\u8ff0\u6587\u4ef6\uff0c \u5f15\u7528\u53d8\u91cf\u5b9a\u4e49 \u00b6 main.tf ########################################################### # Terraform \u57fa\u672c\u8bbe\u7f6e terraform { required_providers { aws = { source = \"hashicorp/aws\" version = \"~> 3.71\" } } required_version = \">= 1.1.3\" } ########################################################### # \u63d0\u4f9b\u5546\u8bbe\u7f6e(\u4e91\u5e73\u53f0) provider \"aws\" { profile = \"learnaws\" # \u5f15\u7528\u53d8\u91cf region = var.aws_region } ec2.tf ########################################################### # EC2 \u8d44\u6e90\u8bbe\u7f6e resource \"aws_instance\" \"myweb_server\" { # \u5f15\u7528\u53d8\u91cf ami = var.ami_id # \u5f15\u7528\u53d8\u91cf instance_type = var.instance_type tags = { Name = \"learnaws-ec2-from-terraform\" } } \u90e8\u7f72\u786e\u8ba4 \u00b6 # \u76ee\u5f55\u521d\u59cb\u5316 $ terraform init # \u68c0\u9a8c tf \u6587\u4ef6 $ terraform validate # \u5b9e\u65bd\u8ba1\u5212, \u51c6\u5907\u8d44\u6e90 $ terraform plan # \u5e94\u7528\u90e8\u7f72 $ terraform apply $ terraform apply -auto-approve # \u6467\u6bc1\u7cfb\u7edf $ terraform destroy","title":"9\u3001\u5b9a\u4e49\u5f15\u7528\u53d8\u91cf"},{"location":"9%E3%80%81%E5%AE%9A%E4%B9%89%E5%BC%95%E7%94%A8%E5%8F%98%E9%87%8F/#_1","text":"","title":"\u5b9a\u4e49\u5f15\u7528\u53d8\u91cf"},{"location":"9%E3%80%81%E5%AE%9A%E4%B9%89%E5%BC%95%E7%94%A8%E5%8F%98%E9%87%8F/#_2","text":"\u5c06 TF \u63cf\u8ff0\u6587\u4ef6\u4e2d\u5171\u540c\u7684\u5185\u5bb9\u62bd\u51fa\u4e3a\u53d8\u91cf\uff0c \u5c3d\u4eab\u7edf\u4e00\u7ba1\u7406 \u4f8b\u5982\u5b9a\u4e49ec2\u65f6\u7684AMI\u662f\u4e00\u6837\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u628aAMI ID\u62bd\u8c61\u51fa\u6765\u4f5c\u4e3a\u53d8\u91cf","title":"\u77e5\u8bc6\u70b9"},{"location":"9%E3%80%81%E5%AE%9A%E4%B9%89%E5%BC%95%E7%94%A8%E5%8F%98%E9%87%8F/#_3","text":"https://www.terraform.io/language/values","title":"\u5b98\u7f51"},{"location":"9%E3%80%81%E5%AE%9A%E4%B9%89%E5%BC%95%E7%94%A8%E5%8F%98%E9%87%8F/#_4","text":"\u7f16\u5199\u53d8\u91cf\u5b9a\u4e49\u6587\u4ef6\uff0c \u62bd\u51fa\u5171\u540c\u7684\u8d44\u6e90\u5b9a\u4e49\u90e8\u5206 \u7f16\u5199 TF \u8d44\u6e90\u63cf\u8ff0\u6587\u4ef6\uff0c \u5f15\u7528\u53d8\u91cf\u5b9a\u4e49 \u90e8\u7f72\u786e\u8ba4","title":"\u5b9e\u6218\u6f14\u4e60/\u8bf4\u660e\u8bb2\u89e3"},{"location":"9%E3%80%81%E5%AE%9A%E4%B9%89%E5%BC%95%E7%94%A8%E5%8F%98%E9%87%8F/#_5","text":"","title":"\u64cd\u4f5c\u6b65\u9aa4"},{"location":"9%E3%80%81%E5%AE%9A%E4%B9%89%E5%BC%95%E7%94%A8%E5%8F%98%E9%87%8F/#_6","text":". \u251c\u2500\u2500 ec2-variables.tf \u251c\u2500\u2500 ec2.tf \u2514\u2500\u2500 main.tf","title":"\u76ee\u5f55\u7ed3\u6784"},{"location":"9%E3%80%81%E5%AE%9A%E4%B9%89%E5%BC%95%E7%94%A8%E5%8F%98%E9%87%8F/#_7","text":"ec2-variables.tf # AWS Region variable \"aws_region\" { description = \"AWS Region\" type = string default = \"ap-northeast-1\" } # AWS EC2 Instance Type variable \"instance_type\" { description = \"EC2 Instance Type\" type = string default = \"t2.small\" } # AWS EC2 Instance Key Pair variable \"ami_id\" { description = \"AMI Image ID\" type = string default = \"ami-0218d08a1f9dac831\" }","title":"\u7f16\u5199\u53d8\u91cf\u5b9a\u4e49\u6587\u4ef6\uff0c \u62bd\u51fa\u5171\u540c\u7684\u8d44\u6e90\u5b9a\u4e49\u90e8\u5206"},{"location":"9%E3%80%81%E5%AE%9A%E4%B9%89%E5%BC%95%E7%94%A8%E5%8F%98%E9%87%8F/#tf","text":"main.tf ########################################################### # Terraform \u57fa\u672c\u8bbe\u7f6e terraform { required_providers { aws = { source = \"hashicorp/aws\" version = \"~> 3.71\" } } required_version = \">= 1.1.3\" } ########################################################### # \u63d0\u4f9b\u5546\u8bbe\u7f6e(\u4e91\u5e73\u53f0) provider \"aws\" { profile = \"learnaws\" # \u5f15\u7528\u53d8\u91cf region = var.aws_region } ec2.tf ########################################################### # EC2 \u8d44\u6e90\u8bbe\u7f6e resource \"aws_instance\" \"myweb_server\" { # \u5f15\u7528\u53d8\u91cf ami = var.ami_id # \u5f15\u7528\u53d8\u91cf instance_type = var.instance_type tags = { Name = \"learnaws-ec2-from-terraform\" } }","title":"\u7f16\u5199 TF \u8d44\u6e90\u63cf\u8ff0\u6587\u4ef6\uff0c \u5f15\u7528\u53d8\u91cf\u5b9a\u4e49"},{"location":"9%E3%80%81%E5%AE%9A%E4%B9%89%E5%BC%95%E7%94%A8%E5%8F%98%E9%87%8F/#_8","text":"# \u76ee\u5f55\u521d\u59cb\u5316 $ terraform init # \u68c0\u9a8c tf \u6587\u4ef6 $ terraform validate # \u5b9e\u65bd\u8ba1\u5212, \u51c6\u5907\u8d44\u6e90 $ terraform plan # \u5e94\u7528\u90e8\u7f72 $ terraform apply $ terraform apply -auto-approve # \u6467\u6bc1\u7cfb\u7edf $ terraform destroy","title":"\u90e8\u7f72\u786e\u8ba4"}]}